[buildout]
extends = 
    ../pmain.cfg
    ../versions.cfg
allow-picked-versions = false
;extensions = buildout.dumppickedversions

parts = altairticketing
        egg-scripts
        pmain
        prepare
        prepare2
        supervisord
        cancel_auth
        update_seat_status
        sej_notification

develop = 
    ../../ticketing
    ../../cms
    ../../commons
    ../../altair_gaq

versions = versions


[prepare]
recipe = z3c.recipe.mkdir
paths = 
    var/altair/cms
    var/altair/ticketing
    var/log

[prepare2]
recipe = z3c.recipe.filetemplate
files =
    cancel_auth_expired_carts.conf
    update_seat_status.conf

[altairticketing]
recipe = zc.recipe.egg
eggs = 
    ticketing
    altair_cms
    pyramid
    altair_gaq
interpreter = altairpy


[egg-scripts]
recipe = zc.recipe.egg:scripts
eggs = 
    alembic
    ticketing
    altair-cms
scripts =
    alembic

[conf]
path = ${buildout:directory}/conf

[supervisord]
recipe = collective.recipe.supervisor
port = 7001

programs = 
    10 altair.ticketing.cms ${buildout:directory}/bin/pserve [${conf:path}/cms.ini http_port=8001] ${buildout:directory}/var/altair/cms
    10 altair.ticketing.1 ${buildout:directory}/bin/pserve [${conf:path}/ticketing.ini http_port=8021] ${buildout:directory}/var/altair/ticketing
    10 altair.ticketing.2 ${buildout:directory}/bin/pserve [${conf:path}/ticketing.ini http_port=8022] ${buildout:directory}/var/altair/ticketing
    10 altair.ticketing.qrreader ${buildout:directory}/bin/pserve [${conf:path}/qrreader.ini http_port=8030] ${buildout:directory}/var/altair/ticketing
    10 altair.ticketing.sej ${buildout:directory}/bin/pserve [${conf:path}/sej.ini http_port=8061] ${buildout:directory}/var/altair/ticketing

    10 altair.ticketing.cart.1 ${buildout:directory}/bin/pserve [${conf:path}/payment.ini http_port=9021] ${buildout:directory}/var/altair/ticketing
    10 altair.ticketing.cart.2 ${buildout:directory}/bin/pserve [${conf:path}/payment.ini http_port=9022] ${buildout:directory}/var/altair/ticketing

    10 altair.cms.usersite ${buildout:directory}/bin/pserve [${conf:path}/usersite.ini http_port=9001] ${buildout:directory}/var/altair/ticketing

    10 altair.ticketing.mypage ${buildout:directory}/bin/pserve [${conf:path}/mypage.ini http_port=9041] ${buildout:directory}/var/altair/ticketing
    10 altair.ticketing.orderreview ${buildout:directory}/bin/pserve [${conf:path}/orderreview.ini http_port=9061] ${buildout:directory}/var/altair/ticketing
    10 altair.ticketing.89ers ${buildout:directory}/bin/pserve [${conf:path}/89ers.ini http_port=9081] ${buildout:directory}/var/altair/ticketing

[cancel_auth]
recipe = z3c.recipe.usercrontab
times = */10 * * * *
command = ${buildout:directory}/bin/cancel_auth_expired_carts ${conf:path}/89ers.ini ${buildout:directory}/cancel_auth_expired_carts.conf

[sej_notification]
recipe = z3c.recipe.usercrontab
times = */10 * * * *
command = ${buildout:directory}/bin/sej_notification ${conf:path}/sej.ini 

[update_seat_status]
recipe = z3c.recipe.usercrontab
times = */5 * * * *
command = ${buildout:directory}/bin/update_seat_status ${conf:path}/ticketing.ini ${buildout:directory}/update_seat_status.conf

