[buildout]
extends =
    ./versions.cfg

allow-picked-versions = false

parts =
    altairticketing
    egg-scripts
    pmain
    prepare
    prepare2

develop = 
    ../../altair_versiontools
    ../../ticketing
    ../../cms
    ../../newsletter
    ../../commons
    ../../altair_gaq
    ../../altair_findable_label
    ../../altair_log
    ../../altair_browserid
    ../../altair_auth
    ../../altair_sqla
    ../../altair_exclog
    ../../altair_now
    ../../altair_encodingfixer
    ../../altair_logicaldeleting
    ../../altair_mq
    ../../altair_pyramid_assets
    ../../altair_pyramid_boto
    ../../altair_pyramid_tz
    ../../altair_mobile
    ../../altair_cdnpath
    ../../altair_rakuten_auth
    ../../altair_grid
    ../../altair_saannotation

versions = versions

find-links =
    file:///${buildout:directory}/../../bundle/js.bootstrap_ts-2.3.2.dev1-py2.7.egg
    http://github.com/moriyoshi/collective.recipe.supervisor/archive/0.20dev-moriyoshi0.zip#egg=collective.recipe.supervisor-0.20dev-moriyoshi0
    http://github.com/moriyoshi/gunicorn/archive/0.17.4moriyoshi1.zip#egg=gunicorn-0.17.4moriyoshi1

[conf]
path = ${buildout:directory}/conf

[prepare]
recipe = z3c.recipe.mkdir
paths = 
    var/altair/cms
    var/altair/ticketing
    var/altair/newsletter
    var/tmp
    var/log

[prepare2]
recipe = z3c.recipe.filetemplate
files =
    conf/cancel_auth_expired_carts.conf
    conf/update_seat_status.conf
    conf/send_sales_reports.conf
    conf/rakuten_checkout_sales.conf

[altairticketing]
recipe = zc.recipe.egg
eggs = 
    ticketing
    altair_cms
    altair_newsletter
    pyramid
    altair_gaq
    altair.findable_label
    altair.log
    altair.browserid
    altair-commons
    altair.auth
    altair.encodingfixer
    altair.logicaldeleting
    altair.rakuten_auth
    altair.grid
    altair.mq
interpreter = altairpy

[pmain]
recipe = zc.recipe.egg
eggs = 
    ${altairticketing:eggs}
    altair-commons
scripts =
    pmain

[egg-scripts]
recipe = zc.recipe.egg:scripts
eggs = 
    alembic
    ticketing
    altair_cms
    altair_newsletter
    gunicorn
scripts =
    alembic
    gunicorn_paster

[supervisor]
recipe = collective.recipe.supervisor
programs = 
plugins = mr.laforge
rpcplugins =
    laforge mr.laforge.rpcinterface:make_laforge_rpcinterface
ctlplugins =
    laforge mr.laforge.controllerplugin:make_laforge_controllerplugin

[cancel_auth]
recipe = z3c.recipe.usercrontab
times = */10 * * * *
command = ${buildout:directory}/bin/cancel_auth_expired_carts ${conf:path}/altair.ticketing.admin.ini ${conf:path}/cancel_auth_expired_carts.conf

[sej_notification]
recipe = z3c.recipe.usercrontab
times = */10 * * * *
command = ${buildout:directory}/bin/sej_notification ${conf:path}/altair.ticketing.sej.ini 

[update_seat_status]
recipe = z3c.recipe.usercrontab
times = */5 * * * *
command = ${buildout:directory}/bin/update_seat_status ${conf:path}/altair.ticketing.admin.ini ${conf:path}/update_seat_status.conf

[send_sales_reports]
recipe = z3c.recipe.usercrontab
times = 5 * * * *
command = ${buildout:directory}/bin/send_sales_reports ${conf:path}/altair.ticketing.admin.ini ${conf:path}/send_sales_reports.conf

[rakuten_checkout_sales]
recipe = z3c.recipe.usercrontab
times = */15 * * * *
command = ${buildout:directory}/bin/rakuten_checkout_sales ${conf:path}/altair.ticketing.admin.ini ${conf:path}/rakuten_checkout_sales.conf

[multicheckout_cancel_auth]
recipe = z3c.recipe.usercrontab
times = 0 * * * *
command = ${buildout:directory}/bin/cancel_auth ${conf:path}/altair.ticketing.admin.ini 

[refund_order]
recipe = z3c.recipe.usercrontab
times = 0 1 * * *
command = ${buildout:directory}/bin/refund_order ${conf:path}/altair.ticketing.admin.ini

[altair]
altaircms.s3.utility = altaircms.filelib.s3.S3ConnectionFactory
altaircms.solr.search.utility = altaircms.solr.api.SolrSearch
altaircms.usersite.url = http://stg2.rt.ticketstar.jp/ 
altaircms.backend.url = http://localhost:8021
altaircms.logout.external.url = http://backend.stg2.rt.ticketstar.jp/api/forget_loggedin
altair.oauth.authorize_url = http://backend.stg2.rt.ticketstar.jp/api/authorize
altair.oauth.access_token_url = http://localhost:8021/api/access_token
