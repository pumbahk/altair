<%inherit file="../base.html" />

<script type="text/javascript">
    var jQueryScriptElm = document.createElement('script');
    jQueryScriptElm.src = 'https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js';
    document.head.prepend(jQueryScriptElm);

    var bootStrapScriptElm = document.createElement('script');
    bootStrapScriptElm.src = "${view_context.static_url('bootstrap/js/bootstrap.min.js')}";
    var bootStrapLinkElm = document.createElement('link');
    bootStrapLinkElm.rel = 'stylesheet';
    bootStrapLinkElm.href = "${view_context.static_url('bootstrap/css/bootstrap.min.css')}";
    document.head.prepend(bootStrapScriptElm);
    document.head.prepend(bootStrapLinkElm);
</script>

<%block name="header">
  <%include file="../../includes/mypage_header.html" />
</%block>

<div class="orderreview-list-page">
  <div class="contents">
    <section class="bg-contents">
      <div class="inner">
        <p  style= "margin-bottom:0;" class="heading-primary">${_(u'マイページ')}</p>
        % if request.organization.setting.i18n:
          <div class="locale-wrap">
            <p>${h.create_url(request) |n}</p>
          </div>
        % endif
          <form name="jump_to_qr_list" method="POST" action="${request.route_path('mypage.qrlist.show')}">
            <input type="hidden" name="order_no" value="${order.order_no}">
          </form>
          <form name="jump_to_order_qr_show" method="POST" action="${request.route_path('mypage.qrlist.show')}">
            <input type="hidden" name="order_no" value="${order.order_no}">
          </form>
         <ul class="nav nav-tabs">
            <li id="qrlist-tab"><a href="#" onclick="document.jump_to_qr_list.submit();">QR一覧</a></li>
            <li id="orderreview-tab"><a href="#" onclick="document.jump_to_order_qr_show.submit();">購入情報</a></li>
         </ul>
         <div class="tab-content" id="tabbable-tab-content">
           % if tab == 'qrlist':
             <div class="tab-pane" id="qrlist">
                <%def name="show_status_msg(msg)">
                <main>
                  <div class="login-page">
                    <div class="contents">
                      <section class="bg-contents">
                        <div class="inner wrap">
                          <table class="login-tbl">
                            <tr>
                              <td class="login-box login-fun">
                                <section>
                                  <div class="inner">
                                    <div class="sub-contents">
                                      <h4 class="sub-ttl tac" style="color:#585858">${_(u'受付番号:')}${order.order_no}</h4>
                                      <br/>
                                        ${msg or ''| n}
                                    </div>
                                  </div>
                                </section>
                              </td>
                            </tr>
                          </table>
                        </div>
                      </section>
                    </div>
                  </div>
                </main>
                </%def>
                % if order.status == 'canceled':
                    ${show_status_msg(u"この購入/予約はキャンセルされました")}
                % elif order.status != 'canceled' and order.payment_status == 'refunded':
                    ${show_status_msg(u"この購入/予約は払戻済みです")}
                % elif order.status != 'canceled' and (order.payment_status == 'unpaid' or order.payment_status == 'refunding') :
                    ${show_status_msg(u"お支払い完了後、このページにQRを表示するためのボタンが表示されます。<br/>" +
                    u"表示されたQRを印刷、あるいは、PC/携帯へメール送信の上、試合当日、指定の入場ゲートにてQR（印刷したもの、あるいは携帯画面）をお見せください。")}
                % else:
                  <%
                    from datetime import datetime
                    now = datetime.now()
                  %>
                  % if order.issuing_start_at > now:
                    ${show_status_msg(u"こちらのQRはまだ表示開始日前のため、QRを表示できません。<br/>" +
                    u"恐れ入りますが、表示開始まで今しばらくお待ちください。")}
                  % else:
                    <%include file="qr_list_show.html" args="order=order, h=h, orgid=orgid, itemdics=itemdics, sendqrmailtokenlist=sendqrmailtokenlist, sent_mail_tokens=sent_mail_tokens, sent_mailinfos=sent_mailinfos" />
                  % endif
                % endif
             </div>
           % elif tab == 'orderreview':
             <div class="tab-pane" id="orderreview">
               <p><%include file="_order_detail_qr_standard.html" args="order=order, h=h" /></p>
             </div>
           % endif
         </div>

         <script type="text/javascript">
             window.onload = function() {
                 var tab = '#${tab}';
                 $(tab + '-tab').addClass('active');
                 $(tab).addClass('active');
             }
         </script>
      </div>
    </section>
  </div>
</div>