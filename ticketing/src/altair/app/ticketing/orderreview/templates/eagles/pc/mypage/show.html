<%inherit file="../base.html" />

<script type="text/javascript">
    var jQueryScriptElm = document.createElement('script');
    jQueryScriptElm.src = 'https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js';
    document.head.append(jQueryScriptElm);

    var bootStrapScriptElm = document.createElement('script');
    bootStrapScriptElm.src = "https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js";
    var bootStrapLinkElm = document.createElement('link');
    bootStrapLinkElm.rel = 'stylesheet';
    bootStrapLinkElm.href = "${view_context.static_url('css/bootstrap.css')}";
    document.head.append(bootStrapScriptElm);
    document.head.prepend(bootStrapLinkElm);

    function toggle_my_ticket_tab() {
        document.getElementById('past-ticket-tab').classList.remove('active');
        document.getElementById('past-ticket-tab-pane').classList.remove('active');
        document.getElementById('my-ticket-tab').classList.add('active');
        document.getElementById('my-ticket-tab-pane').classList.add('active');
    }

    function toggle_past_ticket_tab() {
        document.getElementById('my-ticket-tab').classList.remove('active');
        document.getElementById('my-ticket-tab-pane').classList.remove('active');
        document.getElementById('past-ticket-tab').classList.add('active');
        document.getElementById('past-ticket-tab-pane').classList.add('active');
    }

</script>

<div class="orderreview-list-page">
  <div class="contents">
    <div class="bread-box">
      <div class="inner">
        <ul class="bread-list-box">
          <li class="bread-list"><a href="//eagles.tstar.jp/" class="bread-link">Eチケトップ</a></li>
          <li class="bread-list">購入履歴</li>
        </ul>
      </div>
    </div>

    <section class="bg-contents">
      <div class="inner">
        <h2 class="page-ttl">マイページ</h2>
          <% tab = request.params.get(h.PagingUrlGeneratorForTicketList.PARAM_NAME_TAB) %>
          <ul class="nav nav-tabs">
             <li id="my-ticket-tab" class="${'active' if tab != 'past_ticket' else ''}"><a onclick="toggle_my_ticket_tab();">マイチケット</a></li>
             <li id="past-ticket-tab" class="${'active' if tab == 'past_ticket' else ''}"><a onclick="toggle_past_ticket_tab();">過去のチケット</a></li>
          </ul>
          <%
            from datetime import datetime
            original_orders = orders.original_collection
            items_per_page = orders.items_per_page
            now = datetime.now()

            orders_of_my_ticket = [o for o in original_orders if o.performance.start_on > now]
            orders_of_past_ticket = [o for o in original_orders if o.performance.start_on <= now]

            if u'past_ticket' == request.params.get(h.PagingUrlGeneratorForTicketList.PARAM_NAME_TAB):
                page_my_ticket = 1
                page_past_ticket = request.params.get(h.PagingUrlGeneratorForTicketList.PARAM_NAME_PAGE, 1)
            else:
                page_my_ticket = request.params.get(h.PagingUrlGeneratorForTicketList.PARAM_NAME_PAGE, 1)
                page_past_ticket = 1

            orders_pager_of_my_ticket = h.make_pager_for_ticket_list(request, orders_of_my_ticket, page_my_ticket, items_per_page, tab=u'my_ticket')
            orders_pager_of_past_ticket = h.make_pager_for_ticket_list(request, orders_of_past_ticket, page_past_ticket, items_per_page, tab=u'past_ticket')
          %>
          <div class="tab-content" id="tabbable-tab-content">
              <div class="tab-pane ${'active' if tab != 'past_ticket' else ''}" id="my-ticket-tab-pane">
                <%include file="_tab_ticket_list.html" args="orders=orders_pager_of_my_ticket, lot_entries=lot_entries, shipping_address=shipping_address, magazines_to_subscribe=magazines_to_subscribe, word_enabled=word_enabled, subscribe_word=subscribe_word, h=h" />
              </div>
              <div class="tab-pane ${'active' if tab == 'past_ticket' else ''}" id="past-ticket-tab-pane">
                <%include file="_tab_ticket_list.html" args="orders=orders_pager_of_past_ticket, lot_entries=lot_entries, shipping_address=shipping_address, magazines_to_subscribe=magazines_to_subscribe, word_enabled=word_enabled, subscribe_word=subscribe_word, h=h" />
              </div>
          </div>
      </div>
    </section>
  </div>
</div>
