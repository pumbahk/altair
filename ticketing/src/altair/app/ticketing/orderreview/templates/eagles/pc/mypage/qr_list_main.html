<%inherit file="../base.html" />

<div class="orderreview-list-page">
  <div class="contents">
    <div class="bread-box">
      <div class="inner">
        <ul class="bread-list-box">
          <li class="bread-list"><a href="//eagles.tstar.jp/" class="bread-link">Eチケトップ</a></li>
          <li class="bread-list">購入履歴</li>
        </ul>
      </div>
    </div>

    <section class="bg-contents">
      <div class="inner">
        <h2 class="page-ttl">マイページ</h2>

        <!--<div class="tabbable tabs-top" id="tabbable-content">-->
          <form name="jump_to_qr_list" method="POST" action="${request.route_path('mypage.qrlist.show')}">
            <input type="hidden" name="order_no" value="${order.order_no}">
          </form>
          <form name="jump_to_order_qr_show" method="POST" action="${request.route_path('mypage.qrlist.show')}">
            <input type="hidden" name="order_no" value="${order.order_no}">
          </form>
          <ul class="nav nav-tabs">
             <li id="qrlist-tab"><a href="#" onclick="document.jump_to_qr_list.submit();">QR一覧</a></li>
             <li id="orderreview-tab"><a href="#" onclick="document.jump_to_order_qr_show.submit();">購入情報</a></li>
          </ul>
          <div class="tab-content" id="tabbable-tab-content">
            % if tab == 'qrlist':
              <div class="tab-pane" id="qrlist">
                <%def name="show_status_msg(msg)">
                    <div class="inner">
                      <div class="sub-contents">
                        <p style="font-size: 18px;" align="center"><stong>受付番号:${order.order_no}</stong></p>
                        <br/>
                        ${msg or ''| n}
                      </div>
                    </div>
                </%def>
                % if order.status == 'canceled':
                    ${show_status_msg(u"この購入/予約はキャンセルされました")}
                % elif order.status != 'canceled' and order.payment_status == 'refunded':
                    ${show_status_msg(u"この購入/予約は払戻済みです")}
                % elif order.status != 'canceled' and (order.payment_status == 'unpaid' or order.payment_status == 'refunding') :
                    ${show_status_msg(u"お支払い完了後、このページにQRを表示するためのボタンが表示されます。<br/>" +
                    u"表示されたQRを印刷、あるいは、PC/携帯へメール送信の上、試合当日、指定の入場ゲートにてQR（印刷したもの、あるいは携帯画面）をお見せください。")}
                % else:
                  <%
                    from datetime import datetime
                    now = datetime.now()
                  %>
                  % if order.issuing_start_at > now:
                    ${show_status_msg(u"こちらのQRはまだ表示開始日前のため、QRを表示できません。<br/>" +
                    u"恐れ入りますが、表示開始まで今しばらくお待ちください。")}
                  % else:
                     <%include file="qr_list_show.html" args="order=order, h=h, orgid=orgid, itemdics=itemdics, sendqrmailtokenlist=sendqrmailtokenlist, sent_mail_tokens=sent_mail_tokens, sent_mailinfos=sent_mailinfos" />
                  % endif
                % endif
              </div>
            % elif tab == 'orderreview':
              <div class="tab-pane" id="orderreview">
                <p> <%include file="_order_detail_qr_standard.html" args="order=order, h=h" /></p>
              </div>
            % endif
          </div>

          <script type="text/javascript">
            $(function() {
              tab = '#${tab}';
              $(tab + '-tab').addClass('active');
              $(tab).addClass('active');
          });
          </script>

        <!--</div>-->
      </div>
    </section>
  </div>
</div>
