<%inherit file="./base.html"/>
<% from altair.app.ticketing.core.models import PointUseTypeEnum %>

<%block name="javascript">
  <script type="text/javascript" src="${request.static_url('altair.app.ticketing.cart:static/js/disable_on_submit.js')}"></script>
  <script type="text/javascript">
    $(function() {
      $('#form1').disableOnSubmit('input[type=submit][name!="back"]');
    });
    function click_input_point_form() {
      $('#partial_use').prop('checked', true)
    }
  </script>
</%block>
<%block name='css'>
<style type="text/css">
  .point-use-table {
    margin: 20px auto 0 auto;
    width: 95%;
    border: 1px solid #ccc;
  }
  .point-use-table-header {
    font-size: 13px;
  }
  .point-use-table td {
    padding: 5px;
  }
  .point-use-notice {
    margin: 20px auto 0 25px;
    line-height: 1.7;
  }
  .point-use-notice ul {
    padding-left: 20px;
  }
  .point-use-notice ul li {
    list-style-type: disc;
  }
  .crimson {
    color: #DC143C;
  }
  a:link {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>
</%block>

<link rel="stylesheet"
	  href="${request.static_url('altair.app.ticketing.cart:static/eagles/pc/css/cart_order.css')}"
	  type="text/css" media="all"/>

${self.widget.flow_widget(2)}

<form id="form1" action="${request.url}" method="post">
  <div class="confirmBox">
	  <div class="confirmBoxInner">
	    <h2><img src="${request.static_url('altair.app.ticketing.cart:static/eagles/pc/images/title_shopping.gif')}" alt="お買い物内容" width="114" height="30" /></h2>
        <h3 id="name">${cart.performance.event.title} ${cart.performance.name} ${h.performance_datetime(cart.performance)} ${cart.performance.venue.name}</h3>
	    <table id="contentsOfShopping" summary="席種、金額などのお買い物内容">
      % for product in cart.items:
	  	<tr>
	  	  % if len(product.items) == 1:
              <th scope="row"><img src="${request.static_url('altair.app.ticketing.cart:static/eagles/pc/images/icon_dummy.gif')}" alt="" width="21" height="21" /> ${product.product.name}</th>
	  	      <td><strong>${product.seat_quantity}</strong>枚</td>
            % else:
	  	    <th scope="row"><img src="${request.static_url('altair.app.ticketing.cart:static/eagles/pc/images/icon_dummy.gif')}" alt="" width="21" height="21" /> ${product.product.name}</th>
	  		  <td>×<strong>${product.quantity}</strong></td>
	  	  % endif
	  	  <td>
          % if product.product.sales_segment.setting.display_seat_no:
            % for seat in product.seats:
              ${seat['name']}<br/>
            % endfor
          % endif
	  	  </td>
	  	  <td class="align1">￥${h.format_number(product.product.price * product.quantity)}</td>
	  	</tr>
      % endfor
        <%include file="../../__commons__/discount_code/pc_spa.html" args="cart=cart"/>
	  	  <tr id="commission">
	  	  <th scope="row">決済手数料</th>
	  	  <td>&nbsp;</td>
	  	  <td>&nbsp;</td>
	  	  <td class="align1">￥${h.format_number(cart.transaction_fee)}</td>
	  	</tr>
	  	<tr id="commission">
	  	  <th scope="row">発券/引取手数料</th>
	  	  <td>&nbsp;</td>
	  	  <td>&nbsp;</td>
	  	  <td class="align1">￥${h.format_number(cart.delivery_fee)}</td>
	  	</tr>
	  	<tr id="commission">
	  	  <th scope="row">システム利用料</th>
	  	  <td>&nbsp;</td>
	  	  <td>&nbsp;</td>
	  	  <td class="align1">￥${h.format_number(cart.system_fee)}</td>
	  	</tr>
          %if cart.special_fee > 0:
	  	<tr id="commission">
	  	  <th scope="row">${cart.special_fee_name}</th>
	  	  <td>&nbsp;</td>
	  	  <td>&nbsp;</td>
	  	  <td class="align1">￥${h.format_number(cart.special_fee)}</td>
	  	</tr>
          %endif
	  	<tr id="total">
            <th scope="row"><img src="${request.static_url('altair.app.ticketing.cart:static/eagles/pc/images/total.gif')}" alt="合計金額" width="67" height="16" /></th>
	  	  <td>&nbsp;</td>
	  	  <td>&nbsp;</td>
	  	  <td class="align1">￥${h.format_number(cart.total_amount)}</td>
	  	</tr>
	    </table>
	  </div>
  </div>

  <div class="confirmBox">
	  <div class="confirmBoxInner">
      <h2><img src="${request.static_url('altair.app.ticketing.cart:static/eagles/pc/images/title_point_use.gif')}" alt="ポイント入力" width="122" height="25" /></h2>
        <table class="point-use-table">
          <tr>
            <td class="point-use-table-header">ポイント残高</td>
          </tr>
		      <tr>
			      <td>
				      <table>
					      <tr>
						      <td>${cart.shipping_address.last_name} ${cart.shipping_address.first_name} さんの通常ポイント残高	</td>
						      <td>：</td>
						      <td><span class="crimson">${h.format_number(fix_point)}</span> ポイント（円）</td>
					      </tr>
							</table>
            </td>
          </tr>
        </table>
        <table class="point-use-table">
		      <tr>
			      <td class="point-use-table-header">利用方法</td>
		      </tr>
		      <tr>
			      <td>
              <% label_style = '' if is_point_available else 'style="opacity: 0.5;"' %>
			      	<table>
                <% errors = h.error_list(request, form, 'input_point') %>
                % if errors:
                <tr>
                  <td colspan="3">${errors}</td>
                </tr>
                % endif
			      		<tr>
			      			<td>
                    % if is_point_available and not errors:
                      <input id="partial_use" name="point_use_type" type="radio" value="${PointUseTypeEnum.PartialUse.v}">
                    % elif is_point_available:
                      <input id="partial_use" name="point_use_type" type="radio" value="${PointUseTypeEnum.PartialUse.v}" checked>
                    % else:
                      <input id="partial_use" name="point_use_type" type="radio" value="${PointUseTypeEnum.PartialUse.v}" disabled>
                    % endif
			      			</td>
                  <td>
                    <label for="partial_use" ${label_style|n}>一部のポイントを使う</label>
                  </td>
                  <td>
                    % if is_point_available:
                      ${form.input_point(size='10', maxlength='6', onclick='click_input_point_form()')}
                    % else:
                      ${form.input_point(size='10', maxlength='6', disabled='')}
                    % endif
                    <label for="input_point" ${label_style|n}>&nbsp;ポイント</label>
                    % if cart.transaction_fee > 0:
                    （利用上限ポイント：${h.format_number(cart.max_available_point)}）
                    % endif
                    <span class="crimson">※50ポイント以上よりご利用可能です</span>
                  </td>
			      		</tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td style="padding-top: 0;">
			      				<ul class="crimson" style="line-height: 1.7">
                      <li>( 例 ) 1000 &lt;半角数字&gt;</li>
                      <li>※決済手数料を除いた合計金額がポイントの利用上限となります。</li>
                      <li>　決済手数料を除いた合計金額分のポイントをご利用の場合、決済手数料は0円となります。</li>
                    </ul>
                  </td>
                </tr>
			      		<tr>
			      			<td>
                    <input id="all_use" name="point_use_type" type="radio" value="${PointUseTypeEnum.AllUse.v}" ${'' if is_point_available else 'disabled'}>
			      			</td>
                  <td>
                    <label for="all_use" id="point-use-label" ${label_style|n}>全てのポイントを使う</label><br>
                  </td>
			      		</tr>
			      		<tr>
			      			<td>
			      				<input id="no_use" name="point_use_type" type="radio" value="${PointUseTypeEnum.NoUse.v}" ${'' if errors else 'checked'}>
			      			</td>
                  <td>
                    <label for="no_use">ポイントを利用しない</label>
                  </td>
			      		</tr>
			      	</table>
			      </td>
          </tr>
        </table>

		    <div class="point-use-notice">
		      ＜ご注意＞
          <ul>
            <li class="crimson">全てのポイントを使う」を選択した場合、ご注文時点の利用可能な全てのポイントが利用ポイントとして確定いたします。</li>
            <li>1回のお支払い上限、1ヶ月のご利用上限については&nbsp;<a href="https://point.rakuten.co.jp/guidance/usemethod/" target="_blank">ポイント利用方法</a>&nbsp;をご確認ください。</li>
            <li>利用ポイント以外に不足金額が発生する場合は、選択されたお支払い方法でのお買い物になります。</li>
          </ul>
        </div>
      </div>
    </div>

    ${form.fix_point}
    ${form.sec_able_point}
    ${form.order_max_point}
  <p class="align2"><image onclick="document.getElementById('form1').submit()" src="${request.static_url('altair.app.ticketing.cart:static/eagles/pc/images/btn_next.gif')}" alt="次へ" width="226" height="46" /></p>
</form>

% if request.organization.setting.sitecatalyst_use:
<!--SiteCatalyst-->
<%
    sc = {"pagename": "point_use"}
%>
<%include file="../common/sc_basic.html" args="sc=sc" />
<!--/SiteCatalyst-->
% endif