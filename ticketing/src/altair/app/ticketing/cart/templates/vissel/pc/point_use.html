<%inherit file="./base.html"/>

<%block name="javascript">
  <script type="text/javascript" src="${request.static_url('altair.app.ticketing.cart:static/js/disable_on_submit.js')}"></script>
  <script type="text/javascript">
    $(function() {
      $('#form1').disableOnSubmit('input[type=submit][name!="back"]');
    });

    % if maximum_usable_point < 50 or not is_point_available:
    $(document).ready(function () {
      $('label').each(function () {
        let labelElement = $(this).attr('for');if (labelElement !== 'no_use') {
          $(this).css('opacity', '0.5');
          $('input#' + labelElement).prop('disabled', true);
        }
      });
    });
    % endif
  </script>
</%block>
<%block name='css'>
<style type="text/css">
  .point-use-table {
    margin: 20px auto 0 auto;
    border: 1px solid #ccc;
  }
  .point-use-table-header {
    font-size: 16px;
  }
  .point-use-table td {
    padding: 5px;
    border-top: none;
  }
  .point-use-notice {
    margin: 20px auto 0 25px;
    line-height: 1.7;
    font-size: 13px;
  }
  .crimson {
    color: #DC143C;
  }
  a:link {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
  input[type='radio'] {
    position: relative;
    bottom: 1px;
  }
  input[type='text'] {
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
    border: 1px solid #CCC;
    background: #f4f3f1;
    padding: 5px;
    margin: 3px;
  }
</style>
</%block>

<form id="form1" action="${request.url}" method="post">
  <div class="confirmBox">
    <h2>${__(u'お買い物内容')}</h2>
    <p class="purchase-title">${cart.performance.event.title} ${cart.performance.name} ${h.performance_datetime(cart.performance, i18n)}(${__(u'予定')}) ${cart.performance.venue.name}</p>
    <div class="confirmBoxInner">
      <table id="contentsOfShopping" summary="${__(u'席種、金額などのお買い物内容')}">
        <tbody>
            % for product in cart.items:
            <tr>
                % if len(product.items) == 1:
                <th scope="row"><img src="${view_context.static_url('pc/images/icon_dummy.gif')}" alt="" width="21" height="21" /> ${product.product.name}</th>
                <td><strong>${product.seat_quantity}</strong>${__(u'枚')}</td>
                % else:
                <th scope="row"><img src="${view_context.static_url('pc/images/icon_dummy.gif')}" alt="" width="21" height="21" /> ${product.product.name}</th>
                <td>×<strong>${product.quantity}</strong></td>
                % endif
                <td>
                    % if product.product.sales_segment.setting.display_seat_no:
                    % for seat in product.seats:
                    ${seat['name']}<br/>
                    % endfor
                    % endif
                </td>
                <td class="align1">￥${h.format_number(product.product.price * product.quantity)}</td>
            </tr>
            % endfor
            <tr>
                <th scope="row">${__(u'決済手数料')}</th>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td class="align1">￥${h.format_number(cart.transaction_fee)}</td>
            </tr>
            <tr>
                <th scope="row">${__(u'発券/引取手数料')}</th>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td class="align1">￥${h.format_number(cart.delivery_fee)}</td>
            </tr>
            <tr>
              <th scope="row">${__(u'システム利用料')}</th>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td class="align1">￥${h.format_number(cart.system_fee)}</td>
            </tr>
            %if cart.special_fee > 0:
            <tr>
                <th scope="row">${cart.special_fee_name}</th>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td class="align1">￥${h.format_number(cart.special_fee)}</td>
            </tr>
            %endif
            <tr class="purchase-table-total">
                <th scope="row" class="fs14">${__(u'合計金額')}</th>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td class="align1">￥${h.format_number(cart.total_amount)}</td>
            </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="confirmBox">
    <h2>${__(u'ポイント入力')}</h2>
    <div class="confirmBoxInner">

      <table class="point-use-table">
        <tr>
          <td class="point-use-table-header">ポイント残高</td>
        </tr>
		    <tr>
		      <td>
			      <table>
				      <tr>
					      <td>${cart.shipping_address.last_name} ${cart.shipping_address.first_name} さんの通常ポイント残高	</td>
					      <td><span class="crimson">${h.format_number(usable_standard_point)}</span> ポイント（円）</td>
				      </tr>
						</table>
          </td>
        </tr>
      </table>
      <table class="point-use-table">
		    <tr>
		      <td class="point-use-table-header">利用方法</td>
		    </tr>
		    <tr>
		      <td>
		      	<table>
              <% errors = h.error_list(request, form, 'input_point') %>
              % if errors:
              <tr>
                <td colspan="3">${errors}</td>
              </tr>
              % endif
		      		<tr>
		      			<td>
		      				<input id="partial_use" name="point_use" type="radio" value="1">
		      			</td>
                <td>
                  <label for="partial_use">一部のポイントを使う</label>
                </td>
                <td>
                  ${form.input_point(size='10', maxlength='6')}
                  <label for="input_point">ポイント</label>
                  % if maximum_usable_point > 0:
                  （利用上限ポイント：${h.format_number(maximum_usable_point)}）
                  % endif
                  <span class="crimson">※50ポイント以上よりご利用可能です</span>
                </td>
		      		</tr>
              <tr>
                <td></td>
                <td></td>
                <td style="padding-top: 0;">
		      				<div class="crimson">
                    ( 例 ) 1000 &lt;半角数字&gt;<br>
                    <span style="line-height: 1.7">
                      ※決済手数料を除いた合計金額がポイントの利用上限となります。<br>
                      　決済手数料を除いた合計金額分のポイントをご利用の場合、決済手数料は0円となります。<br>
                    </span>
                  </div>
                </td>
              </tr>
		      		<tr>
		      			<td>
		      				<input id="all_use" name="point_use" type="radio" value="0">
		      			</td>
                <td>
                  <label for="all_use">全てのポイントを使う</label><br>
                </td>
		      		</tr>
		      		<tr>
		      			<td>
		      				<input id="no_use" name="point_use" type="radio" value="-1" checked>
		      			</td>
                <td>
                  <label for="no_use">ポイントを利用しない</label>
                </td>
		      		</tr>
		      	</table>
		      </td>
        </tr>
      </table>

		  <div class="point-use-notice">
		    ＜ご注意＞<br>
		    <span class="crimson">
		    ・「全てのポイントを使う」を選択した場合、ご注文時点の利用可能な全てのポイントが利用ポイントとして確定いたします。<br>
		    </span>
        ・1回のお支払い上限、1ヶ月のご利用上限については&nbsp;<a href="https://point.rakuten.co.jp/guidance/usemethod/" target="_blank">ポイント利用方法</a>&nbsp;をご確認ください。<br>
		    ・利用ポイント以外に不足金額が発生する場合は、選択されたお支払い方法でのお買い物になります。<br>
      </div>
    </div>
  </div>

  <input type="hidden" name="usable_standard_point" value="${usable_standard_point}">
  <input type="hidden" name="maximum_usable_point" value="${maximum_usable_point}">
  <p class="align2" onclick="$('#form1').submit()">次へ</p>
</form>

% if request.organization.setting.sitecatalyst_use:
<!--SiteCatalyst-->
<%
    sc = {"pagename": "point_use"}
%>
<%include file="../includes/sc_basic.html" args="sc=sc" />
<!--/SiteCatalyst-->
% endif