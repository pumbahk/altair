***************
*** 449,457 ****
      return request.altair_auth_info
  
  def get_membership(d):
-     q = u_models.Membership.query \
-         .filter(u_models.Membership.name==d['membership']) \
-         .filter(u_models.Membership.organization_id == d['organization_id'])
      return q.first()
  
  def get_member_group(request, info):
--- 435,452 ----
      return request.altair_auth_info
  
  def get_membership(d):
+     membership_name = d.get('membership') if d is not None else None
+     if membership_name is None:
+         # XXX: membership の名前が与えられていないときは
+         # primary key が一番若いものを使う
+         # ここのロジックを fc_auth と同じくする必要がある
+         q = u_models.Membership.query \
+             .filter_by(organization_id=d['organization_id']) \
+             .order_by(u_models.Membership.id)
+     else:
+         q = u_models.Membership.query \
+             .filter(u_models.Membership.name==d['membership']) \
+             .filter(u_models.Membership.organization_id == d['organization_id'])
      return q.first()
  
  def get_member_group(request, info):
