<%page args="sales_segments" />
<% from altair.app.ticketing.core.models import SalesSegment %>
<%namespace file="/common/helpers.html" name="ch" />
% if sales_segments:
<div class="row-fluid">
  <div class="span12">
    <table class="table table-striped table-bordered table-condensed" style="margin-bottom: 10px;">
      <thead>
        <tr>
          <th class="minwidth"></th>
          <th>名称</th>
          <th>${ch.sortable(SalesSegment.start_at)}</a></th>
          <th>${ch.sortable(SalesSegment.end_at)}</a></th>
          % if not performance:
          <th>公演名</th>
          % endif
          <th>${ch.sortable(SalesSegment.account_id)}</a></th>
          <th>${ch.sortable(SalesSegment.upper_limit)}</a></th>
          <%doc><th>${ch.sortable(SalesSegment.order_limit)}</a></th></%doc>
          <th>${ch.sortable(SalesSegment.seat_choice)}</a></th>
          <th>${ch.sortable(SalesSegment.public)}</a></th>
          <th>${ch.sortable(SalesSegment.reporting)}</a></th>
          <th>決済方法</th>
          <th>引取方法</th>
        </tr>
      </thead>
      <tbody>
      % for i, sales_segment in enumerate(sales_segments):
        <tr>
          <% count = len(sales_segment.payment_delivery_method_pairs) %>
          <% rowspan = 'rowspan=%s' % (count) if count else '' %>
          <td ${rowspan}>
            <input type="radio" name="sales_segment_id" value="${sales_segment.id}" />
            <input type="hidden" id="kind" value="${sales_segment.kind}" />
          </td>
          <td ${rowspan}><a href="${request.route_path('sales_segments.show', sales_segment_id=sales_segment.id)}">${sales_segment.sales_segment_group.name}</a></td>
          <td ${rowspan}>${vh.datetime(sales_segment.start_at)}</td>
          <td ${rowspan}>${vh.datetime(sales_segment.end_at)}</td>
          % if not performance:
          <td ${rowspan}>
            % if sales_segment.performance:
              <a href="${request.route_path('performances.show', event_id=sales_segment.performance.event_id, performance_id=sales_segment.performance.id)}">${sales_segment.performance.name}</a>
            % endif
          </td>
          % endif
          <td ${rowspan}>${sales_segment.account.name}</td>
          <td ${rowspan}>${sales_segment.upper_limit or u''}</td>
          <%doc><td ${rowspan}>${sales_segment.order_limit or u''}</td></%doc>
          <td ${rowspan}>${u'選択可' if sales_segment.seat_choice else u'×選択不可'}</td>
          <td ${rowspan}>${u'公開' if sales_segment.public else u'非公開'}</td>
          <td ${rowspan}>${u'対象' if sales_segment.reporting else u'×対象外'}</td>
          % if count == 0:
          <td></td>
          <td></td>
          % endif
          % for i, payment_delivery_method_pair in enumerate(sales_segment.payment_delivery_method_pairs):
            % if i != 0:
        <tr>
            % endif
          <td style="border-left: 1px solid #ddd;">${payment_delivery_method_pair.payment_method.name}</td>
          <td>${payment_delivery_method_pair.delivery_method.name}</td>
        </tr>
          % endfor
      % endfor
      </tbody>
    </table>
  </div>
</div>
<script type="text/javascript">
(function (form) {
  get_selected_sales_segment_id = function get_selected_sales_segment_id() {
    return form.find('input:radio[name="sales_segment_id"]:checked').val();
  }
})($('script:last').closest('form'));
</script>
% endif
