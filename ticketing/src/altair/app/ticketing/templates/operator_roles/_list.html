<%page args="form, roles, permission_categories" />
<%namespace file="/common/helpers.html" name="ch"/>
<%namespace file="/common/modal.html" import="delete_modal" />

<script type="text/javascript">
  function delete_role(id) {
    var modal = $('#modal-delete');
    modal.find('#delete').attr('href', '/operators/roles/delete/' + id);
    modal.find('#message').text('選択したロールを削除します。よろしいですか？');
    modal.modal('toggle');
  }
</script>

<form>
  <div class="float-left">
    <div class="btn-group">
      <a href="${request.route_path('operator_roles.new')}" class="btn"><i class="icon-plus"></i> 新規</a>
    </div>
  </div>
  <div class="clearfix"></div>

  <table class="table table-bordered" style="margin-top: 10px;">
    <thead>
    <tr>
      <th class="span4"></th>
      <th colspan="${len(roles)}">ロール名</th>
    </tr>
    <tr>
      <th>権限</th>
      % for role in roles.items:
      <th class="span2">
        ${role.name_kana}
        <div class="btn-group">
          <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#">
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
            <li><a href="${request.route_path('operator_roles.edit', operator_role_id=role.id)}"><i class="icon-pencil"></i> 編集</a></li>
            <li><a href="javascript:delete_role(${role.id});"><i class="icon-minus"></i> 削除</a></li>
          </ul>
        </div>
      </th>
      % endfor
    </tr>
    </thead>
    <tbody>
    % for category in permission_categories:
    <tr>
      <td>${category.name_kana}</td>
      % for role in roles.items:
      <td>
        % if category.id in [p.category_id for p in role.permissions]:
        <i class="icon-ok"></i>
        % endif
      </td>
      % endfor
    </tr>
    % endfor
    </tbody>
  </table>
  ${ch.pager(roles)}
</form>

${delete_modal()}
