<%page args="form" />
<%namespace file="/common/helpers.html" name="ch" />

<script type="text/javascript">
  $(function() {
    $('#modal-refund').find("input[type='checkbox']").change(function() {
      if ($(this).attr('checked')) {
        $(this).val(1);
      } else {
        $(this).val(0);
      }
    }).change();
    $('.draggable').draggable({scroll: true, handle:$('.draggable .modal-header')});
    $('#modal-refund').disableOnSubmit();
  });
</script>

<div id="modal-refund" class="modal hide draggable">
  <div class="modal-header">
    <h3>払戻する</h3>
  </div>

  <div class="modal-body">
    ${ch.flash_messages(request, type='alert-error')}
    ${ch.alert_message(form)}
    <form class="form-horizontal" action="javascript:refund_order();">
      ${ch.form_item(form.payment_method_id)}
      <label class="required control-label">払戻対象</label>
      ${ch.form_item(form.include_item)}
      ${ch.form_item(form.include_system_fee)}
      ${ch.form_item(form.include_transaction_fee)}
      ${ch.form_item(form.include_delivery_fee)}
      ${ch.form_item(form.cancel_reason)}
      <div class="control-group">
        <label class="control-label">コンビニでの払戻期間</label>
        <div class="controls">
          ${form.start_at} 〜 ${form.end_at}
          ${ch.validate_errors(form.start_at)}
          ${ch.validate_errors(form.end_at)}
        </div>
      </div>
    </form>
  </div>

  <div class="modal-footer">
    <button class="btn secondary btn-close" data-dismiss="modal">戻る</button>
    <button onclick="$('#modal-refund').find('form').submit(); return false;" class="btn danger">払戻</button>
  </div>
</div>
