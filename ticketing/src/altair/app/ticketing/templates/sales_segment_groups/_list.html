<%page args="sales_segment_groups, limit=None" />
<%namespace file="/common/helpers.html" name="ch" />
<% paging = False if limit else True %>
<% from altair.app.ticketing.core.models import SalesSegmentGroup, SalesSegmentGroupSetting %>
% if sales_segment_groups:
<div class="row-fluid">
  <div class="span12">
    <table class="table table-striped table-bordered table-condensed" style="margin-bottom: 10px;">
      <thead>
        <tr>
          <th class="minwidth"></th>
          <th>${ch.sortable(SalesSegmentGroup.name, paging)}</th>
          <th>${ch.sortable(SalesSegmentGroup.start_at, paging)}</th>
          <th>${ch.sortable(SalesSegmentGroup.end_at, paging)}</th>
          <th>${ch.sortable(SalesSegmentGroup.account_id, paging)}</th>
          <th>${ch.sortable(SalesSegmentGroup.max_quantity, paging)}</th>
          <%doc><th>${ch.sortable(SalesSegmentGroup.order_limit, paging)}</th></%doc>
          <th>${ch.sortable(SalesSegmentGroup.seat_choice, paging)}</th>
          <th>${ch.sortable(SalesSegmentGroupSetting.display_seat_no, paging)}</th>
          <th>${ch.sortable(SalesSegmentGroup.public, paging)}</th>
          <th>${ch.sortable(SalesSegmentGroup.reporting, paging)}</th>
          <th>決済方法</th>
          <th>引取方法</th>
        </tr>
      </thead>
      <tbody>
      % for i, sales_segment_group in enumerate(sales_segment_groups):
        <% if limit and i >= limit: break %>
        <tr>
          <% count = len(sales_segment_group.payment_delivery_method_pairs) %>
          <% rowspan = 'rowspan=%s' % (count) if count else '' %>
          <td ${rowspan}>
            <input type="radio" name="sales_segment_group_id" value="${sales_segment_group.id}" />
            <input type="hidden" id="kind" value="${sales_segment_group.kind}" />
          </td>
          <td ${rowspan}><a href="${request.route_path('sales_segment_groups.show', sales_segment_group_id=sales_segment_group.id)}">${sales_segment_group.name}</a></td>
          <td ${rowspan}>${vh.datetime(sales_segment_group.start_at, with_weekday=True)}</td>
          <td ${rowspan}>${vh.datetime(sales_segment_group.end_at, with_weekday=True)}</td>
          <td ${rowspan}>${sales_segment_group.account.name}</td>
          <td ${rowspan}>
            ${u'%s枚' % sales_segment_group.max_quantity if sales_segment_group.max_quantity else u'-'} / ${u'%s個' % sales_segment_group.max_product_quatity if sales_segment_group.max_product_quatity else u'-'}
          </td>
          <%doc><td ${rowspan}>${sales_segment_group.order_limit or u''}</td></%doc>
          <td ${rowspan}>${u'選択可' if sales_segment_group.seat_choice else u'×選択不可'}</td>
          <td ${rowspan}>${u'表示' if sales_segment_group.setting.display_seat_no else u'非表示'}</td>
          <td ${rowspan}>${u'公開' if sales_segment_group.public else u'非公開'}</td>
          <td ${rowspan}>${u'対象' if sales_segment_group.reporting else u'×対象外'}</td>
          % if count == 0:
          <td></td>
          <td></td>
          % endif
          % for i, payment_delivery_method_pair in enumerate(sales_segment_group.payment_delivery_method_pairs):
            % if i != 0:
        <tr>
            % endif
          <td style="border-left: 1px solid #ddd;">${payment_delivery_method_pair.payment_method.name}</td>
          <td>${payment_delivery_method_pair.delivery_method.name}</td>
        </tr>
          % endfor
      % endfor
      </tbody>
    </table>
    % if limit and len(sales_segment_groups) > limit:
    <div class="pull-right">
      ${len(sales_segment_groups)}件中${limit}件を表示
      <a href="${request.route_path('sales_segment_groups.index', event_id=event.id)}">もっと見る</a>
    </div>
    % endif
  </div>
</div>
% if paging:
${ch.pager(sales_segment_groups)}
% endif
<script type="text/javascript">
(function (form) {
  get_selected_sales_segment_group_id = function get_selected_sales_segment_group_id() {
    return form.find('input:radio[name="sales_segment_group_id"]:checked').val();
  };
})($('script:last').closest('form'));
</script>
% endif
