<%page args="expanded=True, show_op_and_sales=False" />
<table class="table table-bordered table-condensed ">
  <tbody>
    <tr>
      <th width="8%">会場</th>
      <td width="28%" colspan="1">
        ${performance.venue.name}
        %if performance.venue.sub_name != None:
          <div class="sub_name">${performance.venue.sub_name}</div>
        %endif
      </td>
      <th width="8%">公演コード</th>
      <td width="12%">${performance.code}</td>
      <th width="8%">開場</th>
      <td width="12%">${vh.datetime(performance.open_on, with_weekday=True)}</td>
    </tr>
    <tr>
      <th rowspan="2">公演名略称</th>
      <td rowspan="2">${performance.abbreviated_title or u"-"}</td>
      <th rowspan="2">公演名備考</th>
      <td rowspan="2">${performance.note or u"-"}</td>
      <th>開演</th>
      <td>${vh.datetime(performance.start_on, with_weekday=True)}</td>
    </tr>
    <tr>
      <th>終演</th>
      ## styleを指定しないと下部の枠線だけ消えた状態になってしまう
      <td style="border-bottom: 1px solid #dcdcdc;">${vh.datetime(performance.end_on, with_weekday=True)}</td>
    </tr>
    <tr>
      <th>配券元</th>
      <td>${performance.account.name if performance.account else performance.event.account.name}</td>
    </tr>
    <tr>
      <th>公演名副題</th>
      <td colspan="7">${performance.subtitle or u"-"}</td>
    </tr>
      <th>公演名副題2</th>
      <td colspan="7">${performance.subtitle2 or u"-"}</td>
    </tr>
    <tr>
      <th>公演名副題3</th>
      <td colspan="7">${performance.subtitle3 or u"-"}</td>
    </tr>
    <tr>
      <th>公演名副題4</th>
      <td colspan="7">${performance.subtitle4 or u"-"}</td>
    </tr>

% if expanded:
    <tr>
      <th rowspan="2">リダイレクト先</th>
      <td colspan="7">
        <span class="label" style="background-color:#040">PC</span>${performance.redirect_url_pc or u'未設定'}
      </td>
    </tr>
    <tr>
      <td colspan="7"><span class="label" style="background-color:#008">モバイル</span>${performance.redirect_url_mobile or u'未設定'}</td>
    </tr>
    <tr>
      <th>
        カートURL
        <span class="help-inline">
          <a rel="popover" data-original-title="カートURL" data-content="購入カートのURL">
            <i class="icon-question-sign"></i>
          </a>
        </span>
      </th>
      <td colspan="7">
        <% from altair.app.ticketing.authentication.plugins.externalmember import EXTERNALMEMBER_AUTH_IDENTIFIER_NAME %>
        <% from altair.app.ticketing.authentication.plugins.privatekey import PRIVATEKEY_AUTH_IDENTIFIER_NAME %>
        %if EXTERNALMEMBER_AUTH_IDENTIFIER_NAME in performance.event.setting.cart_setting.auth_types:
          <div>
            <form action="${cart_url}" method="post" id="externalMemberAuthForm" class="form-inline">
              <div>
                <a href="#" onclick="$(this).closest('form').submit()">${cart_url}</a>  (<a href="${cart_now_cart_url}">時間指定してカート購入</a>)
              </div>
              <br/>
              <input type="hidden" name="raw_keyword" value="${performance.event.setting.cart_setting.ticketing_auth_key}">
              <input type="hidden" name="enc_url" value="${request.route_url('externalmember.auth.internal_encryption')}">
              <div class="form-group">
                <label for="raw_member_id" class="sr-only">会員番号</label>
                <input id="raw_member_id" name="raw_member_id" class="form-control" type="text" placeholder="会員番号" required>
              </div>
              <div class="form-group">
                <label for="raw_email_address" class="sr-only">メールアドレス</label>
                <input id="raw_email_address" name="raw_email_address" class="form-control" type="email" placeholder="メールアドレス" required>
              </div>
              <div class="form-group">
                <label for="externalmemberCheckbox">
                  <input id="externalmemberCheckbox" type="checkbox" onchange="encrypt_externalmember_data(this)">
                  外部会員でアクセスする
                </label>
              </div>
            </form>
          </div>
        % elif PRIVATEKEY_AUTH_IDENTIFIER_NAME in performance.event.setting.cart_setting.auth_types:
          <div>
            <form action="${cart_url}" method="post" id="keyAuthForm" class="form-inline">
              <div>
                <a href="#" onclick="$(this).closest('form').submit()">${cart_url}</a>  (<a href="${cart_now_cart_url}">時間指定してカート購入</a>)
              </div>
              <br/>
              <input type="hidden" name="keyword" value="${performance.event.setting.cart_setting.ticketing_auth_key}" disabled>
              <div class="form-group">
                <label for="externalmemberCheckbox">
                  <input id="externalmemberCheckbox" type="checkbox" onchange="$('input[name=keyword]').attr('disabled', !$(this).is(':checked'))">
                  キーワード認証でアクセスする
                </label>
              </div>
            </form>
          </div>
        % else:
          <a href="${cart_url}">${cart_url}</a>  (<a href="${cart_now_cart_url}">時間指定してカート購入</a>)
        %endif
      </td>
    </tr>
    %if request.context.organization.setting.enable_spa_cart and performance.event.setting.cart_setting.use_spa_cart:
    <tr>
      <th>
        SPAカートURL
        <span class="help-inline">
          <a rel="popover" data-original-title="SPAカートURL" data-content="SPA購入カートのURL">
            <i class="icon-question-sign"></i>
          </a>
        </span>
      </th>
      <td colspan="7">
        <% from altair.app.ticketing.authentication.plugins.externalmember import EXTERNALMEMBER_AUTH_IDENTIFIER_NAME %>
        <% from altair.app.ticketing.authentication.plugins.privatekey import PRIVATEKEY_AUTH_IDENTIFIER_NAME %>
        %if EXTERNALMEMBER_AUTH_IDENTIFIER_NAME in performance.event.setting.cart_setting.auth_types:
          <div>
            <form action="${spa_cart_url}" method="post" id="externalMemberAuthForm" class="form-inline">
              <div>
                <a href="#" onclick="$(this).closest('form').submit()">${spa_cart_url}</a>  (<a href="${cart_now_spa_cart_url}">時間指定してカート購入</a>)
              </div>
              <br/>
              <input type="hidden" name="raw_keyword" value="${performance.event.setting.cart_setting.ticketing_auth_key}">
              <input type="hidden" name="enc_url" value="${request.route_url('externalmember.auth.internal_encryption')}">
              <div class="form-group">
                <label for="raw_member_id_spa" class="sr-only">会員番号</label>
                <input id="raw_member_id_spa" name="raw_member_id" class="form-control" type="text" placeholder="会員番号" required>
              </div>
              <div class="form-group">
                <label for="raw_email_address_spa" class="sr-only">メールアドレス</label>
                <input id="raw_email_address_spa" name="raw_email_address" class="form-control" type="email" placeholder="メールアドレス" required>
              </div>
              <div class="form-group">
                <label for="externalmemberSpaCheckbox">
                  <input id="externalmemberSpaCheckbox" type="checkbox" onchange="encrypt_externalmember_data(this)">
                  外部会員でアクセスする
                </label>
              </div>
            </form>
          </div>
        % elif PRIVATEKEY_AUTH_IDENTIFIER_NAME in performance.event.setting.cart_setting.auth_types:
          <div>
            <form action="${spa_cart_url}" method="post" id="keyAuthForm" class="form-inline">
              <div>
                <a href="#" onclick="$(this).closest('form').submit()">${spa_cart_url}</a>  (<a href="${cart_now_spa_cart_url}">時間指定してカート購入</a>)
              </div>
              <br/>
              <input type="hidden" name="keyword" value="${performance.event.setting.cart_setting.ticketing_auth_key}" disabled>
              <div class="form-group">
                <label for="externalmemberSpaCheckbox">
                  <input id="externalmemberSpaCheckbox" type="checkbox" onchange="$('input[name=keyword]').attr('disabled', !$(this).is(':checked'))">
                  キーワード認証でアクセスする
                </label>
              </div>
            </form>
          </div>
        % else:
          <a href="${spa_cart_url}">${spa_cart_url}</a>  (<a href="${cart_now_spa_cart_url}">時間指定してカート購入</a>)
        %endif
      </td>
    </tr>
    <tr>
      <th>
        SPA同意カートURL
        <span class="help-inline">
          <a rel="popover" data-original-title="SPA同意カートURL" data-content="同意SPA購入カートのURL">
            <i class="icon-question-sign"></i>
          </a>
        </span>
      </th>
      <td colspan="7">
        <a href="${agreement_spa_cart_url}">${agreement_spa_cart_url}</a>  (<a href="${agreement_spa_cart_url}">時間指定してカート購入</a>)
      </td>
    </tr>
    % endif
    %if performance.setting:
      %for (k, _), (label, v) in HH.describe_iter(performance.setting):
        <tr>
          <th>${label}</th>
          <td colspan="7">${v or u'-'}</td>
        </tr>
      %endfor
      % if show_op_and_sales:
        <tr>
          <th>登録担当者</th>
          <td colspan="7">${performance.setting.performance_operator}</td>
        </tr>
        <tr>
          <th>営業担当者</th>
          <td colspan="7">${performance.setting.sales_person}</td>
        </tr>
      % endif
    %endif
% endif
  </tbody>
% if expanded:
  <tfoot>
    <tr>
      <td colspan="8">
        <div class="pull-right">
          <%include file="/performances/_action_button.html" args="event=performance.event,
                                                                    performance_id=performance.id,
                                                                    order=['edit', 'copy', 'manycopy', 'mail', 'report', 'delete'],
                                                                    split=True" />
        </div>
      </td>
    </tr>
  </tfoot>
% endif
</table>
