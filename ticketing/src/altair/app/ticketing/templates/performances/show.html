<%inherit file="/layout_2cols.html" />
<%namespace file="/common/helpers.html" name="ch" />
<% route_path = request.route_path('performances.show', performance_id=performance.id) %>
<%block name="style">
<link rel="stylesheet" type="text/css" href="/static/css/decentcolorpicker.css" />
<link rel="stylesheet" type="text/css" href="/static/css/performance.css" />
</%block>

<%block name="fulltitle">
${performance.code} | ${performance.name}
</%block>

<%block name="javascript">
<script type="text/javascript" src="/static/js/fashion.js"></script>
<![if !(lt IE 9)]>
<script type="text/javascript" src="/static/js/fashion.svg.js"></script>
<![endif]>
<!--[if (lt IE 9)]> 
<script type="text/javascript" src="/static/js/fashion.vml.js"></script>
<![endif]-->
<script type="text/javascript" src="/static/js/jquery.decentcolorpicker.js"></script>
<script type="text/javascript" src="/static/js/ticketing.performance.js"></script>
<script type="text/javascript" src="/static/js/ticketing.venue-editor.js"></script>
</%block>
<%block name="breadcrumbs">
  ${ch.breadcrumbs(
      names=[u'イベント', performance.event.title, u'パフォーマンス', performance.name],
      urls=[
        request.route_path('events.index'),
        request.route_path('events.show', event_id=performance.event.id),
        request.route_path('performances.index', event_id=performance.event.id),
      ]
  )}
</%block>

<script>
  $(function() {
    $('[rel=popover]').popover();
  });
</script>

<h2>${performance.name}</h2>

<div class="tabbable tabs-top" id="tabbable-content">
  <ul class="nav nav-tabs">
    % if HH.has_permission('event_editor'):
    <li id="summary-tab"><a href="${route_path}/summary">概要</a></li>
    <li id="seat-allocation-tab"><a href="${route_path}/seat-allocation">席種／配券</a></li>
    <li id="product-tab"><a href="${route_path}/product">商品</a></li>
    % endif
    <li id="reservation-tab"><a href="${route_path}/reservation">予約</a></li>
    <li id="order-tab"><a href="${route_path}/order">購入情報</a></li>
    <li id="import_orders-tab"><a href="${request.route_path('performances.import_orders.index', performance_id=performance.id)}">予約インポート</a></li>
  </ul>
  <div class="tab-content" id="tabbable-tab-content">
    % if tab == 'summary':
    <div class="tab-pane" id="summary">
      <%include file="./_summary.html" args="sales_segments=sales_segments" />
    </div>
    % elif tab == 'product' and HH.has_permission('event_editor'):
    <div class="tab-pane" id="product">
      <%include file="./_product.html" args="performance=performance, sales_segments=performance.sales_segments, form_product=form_product" />
    </div>
    % elif tab == 'reservation':
    <div class="tab-pane" id="reservation">
      <%include file="./_reservation.html" args="performance=performance" />
    </div>
    % elif tab == 'order':
    <div class="tab-pane" id="order">
      <%include file="./_order.html" args="form=form_order, form_search=form_search, orders=orders" />
    </div>
    % elif tab == 'import_orders':
    <div class="tab-pane" id="import_orders">
      % if action == 'show':
        <%include file="./import_orders/_show.html" args="performance=performance, stats=stats" />
      % elif action == 'confirm':
        <%include file="./import_orders/_confirm.html" args="performance=performance, stats=stats" />
      % else:
        <%include file="./import_orders/_index.html" args="performance=performance, form=form, order_import_tasks=order_import_tasks" />
      % endif
    </div>
    % elif HH.has_permission('event_editor'):
    <div class="tab-pane" id="seat-allocation">
      <%include file="./_seat_allocation.html" args="performance=performance, sales_summary=sales_summary" />
    </div>
    % endif
  </div>

  <script type="text/javascript">
  $(function() {
    tab = '#${tab}';
    $(tab + '-tab').addClass('active');
    $(tab).addClass('active');
  });
  </script>
</div>
