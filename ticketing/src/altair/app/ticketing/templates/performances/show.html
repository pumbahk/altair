<%inherit file="/layout_2cols.html" />
<%namespace file="/common/helpers.html" name="ch" />
<% route_path = request.route_path('performances.show', performance_id=performance.id) %>
<%block name="style">
<link rel="stylesheet" type="text/css" href="/static/css/decentcolorpicker.css" />
<link rel="stylesheet" type="text/css" href="/static/css/performance.css" />
</%block>

<%block name="fulltitle">
${performance.code} | ${performance.name}
</%block>

<%block name="javascript">
<script type="text/javascript" src="/static/js/fashion.js"></script>
<![if !(lt IE 9)]>
<script type="text/javascript" src="/static/js/fashion.svg.js"></script>
<![endif]>
<!--[if (lt IE 9)]> 
<script type="text/javascript" src="/static/js/fashion.vml.js"></script>
<![endif]-->
<script type="text/javascript" src="/static/js/jquery.decentcolorpicker.js"></script>
<script type="text/javascript" src="/static/js/ticketing.performance.js"></script>
<script type="text/javascript" src="/static/js/ticketing.venue-editor.js"></script>
</%block>
<%block name="breadcrumbs">
  ${ch.breadcrumbs(
      names=[u'イベント', performance.event.title, u'パフォーマンス', performance.name],
      urls=[
        request.route_path('events.index'),
        request.route_path('events.show', event_id=performance.event.id),
        request.route_path('performances.index', event_id=performance.event.id),
      ]
  )}
</%block>

<script>
  $(function() {
    $('[rel=popover]').popover();
  });
</script>

<div class="page-header">
  <h1>
    ${performance.event.title}<br />
    <small>${performance.name}</small>
  </h1>
</div>

<div class="row-fluid">
  <div class="span9">
    <table class="table table-bordered table-condensed">
      <tbody>
        <tr>
          <th>開場</th>
          <td>${vh.datetime(performance.open_on)}</td>
          <th>公演コード</th>
          <td>${performance.code}</td>
        </tr>
        <tr>
          <th>開演</th>
          <td>${vh.datetime(performance.start_on)}</td>
          <th>会場</th>
          <td>
            ${performance.venue.name}
            %if performance.venue.sub_name != None:
              <div class="sub_name">${performance.venue.sub_name}</div>
            %endif
          </td>
        </tr>
        <tr>
          <th>リダイレクト先URL (PC)</th>
          <td colspan="3">${performance.redirect_url_pc or u'未設定'}</td>
        </tr>
        <tr>
          <th>リダイレクト先URL (モバイル)</th>
          <td colspan="3">${performance.redirect_url_mobile or u'未設定'}</td>
        </tr>
        <tr>
          <th>
            カートURL
            <span class="help-inline">
              <a rel="popover" data-original-title="カートURL" data-content="購入カートのURL">
                <i class="icon-question-sign"></i>
              </a>
            </span>
          </th>
          <td colspan="3">
            <a href="${cart_url}">${cart_url}</a>  (<a href="${cart_now_cart_url}">時間指定してカート購入</a>)
          </td>
        </tr>
        %if performance.settings:
          %for k, v, doc in performance.settings[0].describe_iter():
            <tr>
              <th>${doc}</th>
              <td colspan="3">${v}</td>
            </tr>
          %endfor
        %endif
      </tbody>
    </table>
  </div>
  <input type="hidden" id="performance_id" value="${performance.id}"></input>
  <div class="span3">
    <%include file="/performances/_action_button.html" args="event=performance.event, order=['edit', 'delete', 'copy', 'mail']" />
  </div>
</div>

<div class="tabbable tabs-top" id="tabbable-content">
  <ul class="nav nav-tabs">
    % if HH.has_permission('event_editor'):
    <li id="seat-allocation-tab"><a href="${route_path}/seat-allocation">席種／配券</a></li>
    <li id="sales_segment-tab"><a href="${route_path}/sales_segment">販売区分</a></li>
    <li id="product-tab"><a href="${route_path}/product">商品</a></li>
    % endif
    <li id="order-tab"><a href="${route_path}/order">購入情報</a></li>
    <li id="reservation-tab"><a href="${route_path}/reservation">予約</a></li>
    <li id="import_orders-tab"><a href="${request.route_path('performances.import_orders.index', performance_id=performance.id)}">予約インポート</a></li>
  </ul>
  <div class="tab-content" id="tabbable-tab-content">
    % if tab == 'product' and HH.has_permission('event_editor'):
    <div class="tab-pane" id="product">
      <%include file="./_product.html" args="performance=performance, sales_segments=performance.sales_segments, form_product=form_product" />
    </div>
    % elif tab == 'order':
    <div class="tab-pane" id="order">
      <%include file="./_order.html" args="form=form_order, form_search=form_search, orders=orders" />
    </div>
    % elif tab == 'reservation':
    <div class="tab-pane" id="reservation">
      <%include file="./_reservation.html" args="performance=performance" />
    </div>
    % elif tab == 'sales_segment':
    <div class="tab-pane" id="sales_segment">
      <%include file="./_sales_segment.html" args="sales_segments=sales_segments" />
    </div>
    % elif tab == 'import_orders':
    <div class="tab-pane" id="import_orders">
      % if action == 'show':
        <%include file="./import_orders/_show.html" args="performance=performance, stats=stats" />
      % elif action == 'confirm':
        <%include file="./import_orders/_confirm.html" args="performance=performance, stats=stats" />
      % else:
        <%include file="./import_orders/_index.html" args="performance=performance, form=form, order_import_tasks=order_import_tasks" />
      % endif
    </div>
    % elif HH.has_permission('event_editor'):
    <div class="tab-pane" id="seat-allocation">
      <%include file="./_seat_allocation.html" args="performance=performance, sales_summary=sales_summary" />
    </div>
    % endif
  </div>

  <script type="text/javascript">
  $(function() {
    tab = '#${tab}';
    $(tab + '-tab').addClass('active');
    $(tab).addClass('active');
  });
  </script>
</div>
