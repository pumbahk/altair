<%inherit file="/layout_2cols.html" />
<%namespace file="/common/helpers.html" name="ch" />
<%namespace file="_entries_tabs.html" name="tabs" />
<%
from altair.app.ticketing.cart.helpers import format_currency
%>
<%block name="style">
<link rel="stylesheet" type="text/css" href="/static/css/decentcolorpicker.css" />
<link rel="stylesheet" type="text/css" href="/static/css/performance.css" />
</%block>
<%block name="fulltitle">
Altair Backend -- ${lot.event.title}[${lot.name}]
</%block>
<%block name="javascript">
</%block>
<%block name="breadcrumbs">
  ${ch.breadcrumbs(
      names=[u'イベント', lot.event.title, u'抽選', lot.name, u'申し込み状況'],
      urls=[
        request.route_path('events.index'),
        request.route_path('events.show', event_id=lot.event.id),
        request.route_path('lots.index', event_id=lot.event.id),
        request.route_path('lots.show', lot_id=lot.id),
      ]
  )}
</%block>
<div class="page-header">
  <h1>
    ${lot.event.title}<br />
    <small>${lot.name}</small>
  </h1>
</div>
${tabs.tabs(request)}
<div>

<%include file="electing_statuses.html"/>
<h3>当落確定処理</h3>
%if lot.is_finished():
この抽選は終了済みです。
%else:
<p>
<ul>
%for blocker in electing.blockers:
<li>${blocker}</li>
%endfor
</ul>
</p>
<form method="POST" action="${request.route_url('lots.entries.elect', lot_id=lot.id)}">
    <button ${"disabled" if electing.blockers else ""} class="btn btn-primary btn-large">当選確定処理を実行する</button>
</form>
<form method="POST" action="${request.route_url('lots.entries.reject', lot_id=lot.id)}">
    <button ${"disabled" if electing.blockers else ""} class="btn btn-large btn-danger">落選確定処理を実行する</button>
</form>
%if closer.can_close():
<form method="POST" action="${request.route_url('lots.entries.close', lot_id=lot.id)}">
    <button class="btn btn-large btn-danger">オーソリ開放処理を実行する</button>
</form>
%else:
    <span class="btn btn-large btn-inverse">オーソリ開放処理を実行する<br>当落の確定していない申込があります。</span>

%endif
%endif
</div>

<div>
<h3>ファイル</h3>
<fieldset>
<legend>抽選申込情報のエクスポート</legend>
<a href="${request.route_url('lots.entries.export', lot_id=lot.id)}" class="btn">エクスポート</a>
</fieldset>

<form enctype="multipart/form-data" method="POST" action="${request.route_url('lots.entries.import', lot_id=lot.id)}">
  <fieldset>
    <legend>当選予定情報のインポート</legend>

    <input type="file" name="entries"/><br/>
    <button type="submit" class="btn">当選データインポート</button>
  </fieldset>
</form>

</div>
