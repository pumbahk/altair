<%page args="form, settings" />
<%namespace file="/common/helpers.html" name="ch" />
<%! from altair.app.ticketing.discount_code.models import CodeOrganizerEnum %>

<p>※ 状態が「無効」になっている場合は、アイコンにカーソルを乗せると理由が表示されます。</p>
<div style="margin-right: 10px;">
    <div class="btn-group ">
        <a href="javascript:new_setting();" class="btn">
            <i class="icon-plus"></i>新規
        </a>
    </div>
</div>

<div class="row-fluid" style="margin-top: 30px;">
    <div class="span6" style="width:1500px;">

        <table class="table table-striped table-bordered">
            <thead>
            <tr>
                <th class="span1">
                    ${form.id.label}
                </th>
                <th class="span1" style="text-align:center;">
                    ${ch.sortable(form.status)}
                    ${ch.help(form.status, u"「有効」にならない限り、チケット購入時にクーポン・割引コード入力画面は表示されません。")|n}
                </th>
                <th class="span1" style="text-align: center">
                    ${form.first_4_digits.label}
                </th>
                <th class="span4">
                    ${ch.sortable(form.name)}
                </th>
                <th class="span3">
                    ${form.valid_term.label}
                </th>
                <th class="span1">
                    ${ch.sortable(form.issued_by)}
                    ${ch.help(form.issued_by, u"「自社」の場合は「コード一覧」機能でコードの生成や管理が可能です。")|n}
                </th>
                <th class="span2"></th>
            </tr>
            </thead>
            <tbody>
            % for setting in settings.items:
            <tr id="code-${setting.id}">
                <td>${setting.id}</td>
                <td style="text-align: center;">
                    <div>
                        <button class="btn btn-info btn-mini" type="button"
                                onclick="confirm_open_performance(48594);">有　効
                        </button>
                    </div>
                </td>
                <td style="text-align: center;">
                    ${setting.first_4_digits if setting.first_4_digits else '-'}
                </td>
                <td>${setting.name}</td>
                <td>
                    %if setting.start_at:
                    ${vh.datetime(setting.start_at, with_weekday=True)}
                    %endif
                    〜
                    %if setting.end_at:
                    ${vh.datetime(setting.end_at, with_weekday=True)}
                    %endif
                </td>
                <td>${''.join([enum.v[1] for enum in CodeOrganizerEnum if enum.v[0] == setting.issued_by])}</td>
                <td style="width: 1%; white-space: nowrap;">
                  <%include file="/discount_code/settings/_action_button.html" args="setting=setting, order=['edit', 'target', 'delete'], small=True, split=True"/>
                </td>
            </tr>
            % endfor
            </tbody>
        </table>
        ${ch.pager(settings)}
    </div>
</div>

