% if ticket_hub_order is not None:
    % if ticket_hub_order.completed_at is not None:
        <%
           from datetime import datetime
           tickets=ticket_hub_order.tickets
        %>
        % if tickets:
            <%
              start_date_list = [t for t in tickets if t.usage_valid_start_date and t.usage_valid_start_date > datetime.now()]
              end_date_list = [t for t in tickets if t.usage_valid_end_date and t.usage_valid_end_date < datetime.now()]
            %>
            % if len(start_date_list) == len(tickets):
                [MSG][All]恐れ入りますが、発行開始まで今しばらくお待ちください。
            % elif len(end_date_list) == len(tickets):
                [MSG][All]こちらは発行期限を過ぎています。
            % else:
                以下のQRコードをゲートにかざして入場可能です。 </br></br>
                % for t in tickets:
                      % if t.usage_valid_start_date and t.usage_valid_start_date > datetime.now():
                        [MSG][One]恐れ入りますが、発行開始まで今しばらくお待ちください。<br />
                      % elif t.usage_valid_end_date and t.usage_valid_end_date < datetime.now() :
                        [MSG][One]こちらは発行期限を過ぎています。<br/>
                      % else:
                        <p style="text-align: center">
                        <img src="data:image/png;base64,${t.qr_binary}" height="100px" width="100px"/> </br>
                        チケットID: ${t.display_ticket_id} </br></br></br></br>
                        </p>
                      % endif
                % endfor
            % endif
        % endif
    % else:
        [MSG]completed_at is None
    % endif
% endif
${description}