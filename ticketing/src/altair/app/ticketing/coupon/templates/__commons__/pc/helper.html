<%def name="render_coupon(order)">
    % for item in order.items:
      <tr>
        <td class="textR coupon_name" colspan="2">${item.product.seat_stock_type.name}<br/>
        ${item.product.name} × ${item.quantity}枚</td>
      </tr>
      % for element in item.elements:
        % for token in element.tokens:
        <tr>
          <td class="textR ticket_col">${element.product_item.name}</td>
          <td class="textR">
            % if order.is_canceled():
              キャンセル済みです
            % elif order.payment_status == 'refunding':
              払い戻し予定です
            % elif order.payment_status == 'refunded':
              払い戻し済みです
            % elif order.payment_status == 'unpaid':
              ご入金後、利用が可能となります
            % elif token.printed_at is not None:
              利用済みです<br/>
              ${token.printed_at}
            % elif order.payment_status == 'paid':
              <div class="confirm_not_exist">
                <form method="POST" action="${request.route_path('coupon.admission', reserved_number=reserved_number.number, token_id=token.id)}">
                  <input class="btnCoupon" type="submit" value="利用する" />
                </form>
              </div>
              <div class="confirm_exist">
                <input class="btnCoupon coupon_button" type="button" value="利用する" next_url=${request.route_path('coupon.admission', reserved_number=reserved_number.number, token_id=token.id)} />
              </div>
            % endif
          </td>
        </tr>
        % endfor
      % endfor
    % endfor
</%def>
