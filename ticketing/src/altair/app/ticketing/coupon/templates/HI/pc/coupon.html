<%inherit file="layout.html" />
<div id="modal-content">
  <h2>チケット情報</h2>
  <form id="coupon_form" action="" method="POST">
    <input class="btnCoupon" type="submit" value="利用する"/>
    <input id="modal-close" class="btnCouponClose" type="button" value="やめる"/><br/><br/><br/>
    <input id="disp_dialog" name="disp_dialog" class="coupon_check" type="checkbox">
    <label for="disp_dialog" class="large">次回からダイアログを表示しない</label>
  </form>
  <br/>
  <div class="attention">
※本当に利用しますか？<br/>
この操作は、施設（または店舗）の方が行います。
お客様ご自身が、押してしまった場合は無効になります。
  </div>
</div>

<div class="purchased">
  <h2>チケット情報</h2>

  <table class="purchasedContents">
    <tbody>
      <tr>
        <thead>
          <th colspan="4">${order.performance.event.title} <br />${order.performance.name}</th>
        </thead>
      </tr>
    </tbody>
  </table>
  <p/>

  <table class="purchasedContents">
    <tbody>
      <tr>
        <thead>
          <th colspan="4">受付番号</th>
        </thead>
      </tr>
    </tbody>
    <tr>
      <td class="textR">${order.order_no}</td>
    </tr>
  </table>
  <p/>

  <table class="purchasedContents">
    <tbody>
      <tr>
        <thead>
          <th colspan="2">ご購入チケット</th>
        </thead>
      </tr>
    </tbody>

    % for item in order.items:
      <tr>
        <td class="textR" colspan="2">${item.product.seat_stock_type.name}<br/>
        ${item.product.name} × ${item.quantity}枚</td>
      </tr>
      % for element in item.elements:
        % for token in element.tokens:
        <tr>
          <td class="textR ticket_col">${element.product_item.name}</td>
          <td class="textR">
            % if order.payment_status != 'paid':
              ご入金後、利用が可能となります
            % elif token.printed_at is not None:
              利用済みです
            % else:
              <div class="confirm_not_exist">
                <form method="POST" action="${request.route_path('coupon.admission', reserved_number=reserved_number.number, token_id=token.id)}">
                  <input class="btnCoupon" type="submit" value="利用する" />
                </form>
              </div>
              <div class="confirm_exist">
                <input class="btnCoupon coupon_button" type="button" value="利用する" next_url=${request.route_path('coupon.admission', reserved_number=reserved_number.number, token_id=token.id)} />
              </div>
            % endif
          </td>
        </tr>
        % endfor
      % endfor
    % endfor
  </table>
  <p/>
</div>

<script>
<% from altair.app.ticketing.coupon import COUPON_COOKIE_NAME %>
var required_confirm = null;
if(document.cookie.indexOf("${COUPON_COOKIE_NAME}") > -1){
  $(".confirm_exist").hide();
  $(".confirm_not_exist").show();
} else {
  $(".confirm_exist").show();
  $(".confirm_not_exist").hide();
}
</script>
