<%def name="render_passport(order)">
<% from altair.app.ticketing.passport.api import get_passport_datas, can_use_passport
infos = get_passport_datas(order)
passport_users = sorted(order.users, key=lambda user: user.order_attribute_num)
%>
% for num, user in enumerate(passport_users):
<% index = num+1 %>
<tr>
    <td class="textR ticket_col">
        % if user.image_path:
        <img width="100%"
              src="${request.static_url('altair.app.ticketing.passport:static/{}'.format(user.image_path.replace('passport/static/', '')))}"/>
        % endif
        ${user.ordered_product.product.name}<br/>
        % if index == 1:
        ${order.shipping_address.last_name} ${order.shipping_address.first_name}様<br/>
        % else:
        ${infos[num]._last_name} ${infos[num]._first_name}様<br/>
        % endif
        ${u"男性" if infos[num]._sex == "1" else u"女性"} ${infos[num]._birthdaty}生まれ

        <br/>
        % if order.is_canceled():
        キャンセル済みです
        % elif not user.image_path:
        本人確認用の画像を設定してください
        % elif order.payment_status == 'refunding':
        払い戻し予定です
        % elif order.payment_status == 'refunded':
        払い戻し済みです
        % elif not can_use_passport(request, user):
        <div>入場不可</div>
        % else:
        <div class="confirm_not_exist">
            <form method="POST"
                  action="${request.route_path('passport.admission', passport_user_id=user.id, reserved_number=reserved_number.number)}">
                <input class="btnPassport" type="submit" value="入場する"/>
            </form>
        </div>
        <div class="confirm_exist">
            <input class="btnPassport passport_button" type="button" value="入場する"
                   next_url=${request.route_path('passport.admission', passport_user_id=user.id, reserved_number=reserved_number.number)}
                   check_url=${request.route_path('passport.check_can_use', passport_user_id=user.id)}
            />
        </div>
        % endif

    </td>
</tr>
% endfor
</%def>

<%def name="render_all_passport_button(order)">
<% from altair.app.ticketing.passport.api import can_use_passport_order %>

  % if not order.printed_at:
    % if order.is_canceled():
      キャンセル済みです
    % elif order.payment_status == 'refunding':
      払い戻し予定です
    % elif order.payment_status == 'refunded':
      払い戻し済みです
    % elif not can_use_passport_order(request, order):
      入場不可
    % else:
      <input class="btnAllPassport passport_button" type="button" value="全てのチケットを使用する"
        check_url=${request.route_path('passport.check_can_use_order', reserved_number=reserved_number.number)}
        next_url=${request.route_path('passport.order_admission', reserved_number=reserved_number.number)}>
    % endif
  % endif
</%def>
