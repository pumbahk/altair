<%inherit file="review_base.html" />
<section class="main lotsreview">
  <div class="kadomaru">
    <div class="tac mgb20">
      % if error_msg:
        <p>${error_msg}</p>
      % else:
        <h1 class="fs30">以下の抽選申込を取消いたしました</h1>
      % endif
    </div>
    <div class="tac">
      <% top_page_url = request.route_path('lots.review.index') %>
      <button type="button" class="btnA smallBtn" onclick="location.href='${top_page_url}'">ログイン画面に戻る</button>
    </div>
  </div>

  <div class="kadomaru">
    <h2>申込履歴確認 検索結果</h2>
    <h3>受付番号</h3>
    <p style="font-size: 1.5em; margin-bottom: 1em">${entry.entry_no}</p>
  </div>

  <div class="kadomaru">
    <h2>抽選申込結果</h2>
    % if h.lot_entry_display_status(entry, now) == u'抽選申込取消':
      <h3>抽選申込取消</h3>
      <p>お申込みいただいておりました以下の抽選受付を${h.withdraw_time_label(entry)}に取消いたしました。</p>
    % else:
      % if h.lot_entry_display_status(entry, now) == u'当選表示':
        <p>抽選の結果、お客様はご当選されました。</p>
        <p>払込票番号や引換票番号は、下記の購入履歴よりご確認いただけます。</p>
        <p><a href="/orderreview/guest" target="_blank">■購入履歴確認ページ</a>をご確認ください。</p>
      % elif h.lot_entry_display_status(entry, now) == u'落選表示':
        <p>抽選の結果、お客様は残念ながら落選となりました。</p>
      % elif h.lot_entry_display_status(entry, now) == u'抽選待ち表示':
        <p>抽選結果発表は、${h.announce_time_label(entry.lot)}を予定しております。抽選結果発表後、抽選結果確認ページにて当選・落選をご確認下さい。</p>
      % endif
    % endif
  </div>

  <div class="kadomaru">
    <h2>お申込内容</h2>
    <h3>決済方法</h3>
    <p style="font-size: 1.2em; margin-bottom: 1em">${entry.payment_delivery_method_pair.payment_method.name}</p>
    <h3>引取方法</h3>
    <p style="font-size: 1.2em; margin-bottom: 1em">${entry.payment_delivery_method_pair.delivery_method.name}</p>
    <hr />
    % for wish in wishes:
      <h3 style="font-size: 1.5em"><strong>第${wish.wish_order + 1}希望</strong><span>${wish.performance.name}</span></h3>
      <table class="purchasedContents">
        <tbody>
          <tr>
            <th>抽選結果</th>
              <td>
                %if h.lot_entry_display_status(entry, now) == u'当選表示':
                  %if wish.elected_at:
                    ご用意できました
                  %else:
                    ご用意できませんでした
                  %endif
                %elif h.lot_entry_display_status(entry, now) == u'落選表示':
                  ご用意できませんでした
                %elif h.lot_entry_display_status(entry, now) == u'抽選待ち表示':
                  抽選処理前です
                %endif
              </td>
          </tr>
          <tr>
            <th>公演日・会場</th>
            <td>${h.japanese_datetime(wish.performance.start_on)}　${wish.performance.venue.name}</td>
          </tr>
          <tr>
            <th>希望内容と手数料</th>
            <td>
              <dl class="cost-summary">
              %for lot_product in wish.products:
                <dt class="product-name">${lot_product.product.name}</dt>
                <dd class="product-price-and-quantity">${h.format_currency(lot_product.product.price)}×${lot_product.quantity}枚=${h.format_currency(lot_product.subtotal)} (税込)</dd>
              %endfor
                <dt class="payment-method">決済手数料 (${wish.lot_entry.payment_delivery_method_pair.payment_method.name})</dt>
                <dd class="payment-fee">${h.format_currency(wish.transaction_fee)}</dd>
                <dt class="delivery-method">引取手数料 (${wish.lot_entry.payment_delivery_method_pair.delivery_method.name})</dt>
                <dd class="delivery-fee">${h.format_currency(wish.delivery_fee)}</dd>
                <dt class="delivery-method">システム利用料</dt>
                <dd class="delivery-fee">${h.format_currency(wish.system_fee)}</dd>
                %if wish.special_fee > 0:
                <dt class="delivery-method">${wish.special_fee_name}</dt>
                <dd class="delivery-fee">${h.format_currency(wish.special_fee)}</dd>
                %endif
                <dt class="total-amount">合計</dt>
                <dd class="total-amount">${h.format_currency(wish.total_amount)} (税込)</dd>
              </dl>
            </td>
          </tr>
        </tbody>
      </table>
    % endfor
  </div>

  <div class="kadomaru">
    <h2>購入者情報</h2>
    <table class="purchasedContents">
      <tbody>
        <tr>
          <th>購入者氏名</th>
          <td>${shipping_address.last_name} ${shipping_address.first_name}</td>
        </tr>
        <tr>
          <th>購入者氏名（カナ）</th>
          <td>${shipping_address.last_name_kana} ${shipping_address.first_name_kana}</td>
        </tr>
        <tr>
          <th>メールアドレス</th>
          <td>${shipping_address.email_1}</td>
        </tr>
        <tr>
          <th>電話番号</th>
          <td>${shipping_address.tel_1}</td>
        </tr>
        <tr>
          <th>住所</th>
          <td>
            〒${shipping_address.zip}<br />
            ${shipping_address.prefecture}${shipping_address.city}${shipping_address.address_1}<br />
            ${shipping_address.address_2}</td>
        </tr>
        <tr>
          <th>生年月日</th>
          <td>${u"{0.year} 年 {0.month}月 {0.day}日".format(birthday)}</td>
        </tr>
        <tr>
          <th>性別</th>
          <td>${h.format_gender(request, gender)}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <% extra_form_data = entry.get_lot_entry_attribute_pair_pairs(request) %>
  % if extra_form_data:
  <div class="kadomaru">
    <h2>追加情報</h2>
    <table class="purchasedContents">
      <tbody>
        % for _, (display_name, display_value) in extra_form_data:
          <tr>
            <th>${display_name}</th>
            <td>${h.sensible_coerce(request, display_value)}</td>
          </tr>
        % endfor
      </tbody>
    </table>
  </div>
  % endif
</section>