<%inherit file="/layout_2cols.html"/>
<% from ticketing.mailmags.models import MailSubscriptionStatus %>
<%namespace file="/common/helpers.html" import="pager"/>
<%namespace file="/common/helpers.html" import="flash_messages" />
<%namespace file="/common/helpers.html" import="breadcrumbs" />

<div class="breadcrumbs">
  ${breadcrumbs(
      names=[u'トップ', u'メールマガジン', mailmag.name],
      urls=[request.route_path('index'), request.route_path('mailmags.index')]
  )}
</div>

<div class="page-header">
  <h3>メールマガジン</h3>
</div>

<div class="content">
  ${flash_messages(request)}
</div>

<div class="row-fluid">
  <div class="span9">
    <p>
      <a href="${request.route_path('mailmags.edit', id=mailmag.id)}" class="btn"><i class="icon-pencil"></i>編集</a>
    </p>
    <table class="table table-bordered">
      <tbody>
        <tr>
          <th>メールマガジン名称</th>
          <td>${mailmag.name}</td>
        </tr>
        <tr>
          <th>説明</th>
          <td>${mailmag.description|n}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
<div class="subscribers">
  ${pager(mail_subscriptions)}
  <form action="${request.route_path('mailmags.subscriptions.edit', id=mailmag.id)}" method="post" style="margin-top: 1em">
    <input type="hidden" name="page" value="${request.params.get('page') or 1}" />
    <div class="well">
      状態を
      <select name="status">
        % for status in MailSubscriptionStatus:
        <option value="${status.v}">${h.subscription_status(status.v)}</option>
        % endfor
      </select>に
      <input type="submit" name="do_set_status" value="変更" class="btn" />
    </div>
    <table class="table table-condensed">
      <thead>
        <tr>
          <th>&check;</th>
          <th>メールアドレス</th>
          <th>状態</th>
          <th>登録日時</th>
          <th>データ更新日時</th>
        </tr>
      </thead>
      <tbody>
      <input type="hidden" name="mail_subscription_id" value="0" />
        % for subscription in mail_subscriptions:
        <tr>
          <td><input type="checkbox" name="mail_subscription_id" value="${subscription.id}" /></td>
          <td>${subscription.email}</td>
          <td>${h.subscription_status(subscription.status) or u'-'}</td>
          <td>${subscription.created_at}</td>
          <td>${subscription.updated_at}</td>
        </tr>
        % endfor
      </tbody>
    </table>
  </form>
  ${pager(mail_subscriptions)}
</div>
