<%page args="performance" />

% if performance:
<script type="text/javascript">
  function new_product_item(product_id) {
    var product = '#product-' + product_id;
    var modal = $('#modal-product_item');
    modal.find('#product #name').text($(product).find('#name').text());
    modal.find('#product #price').text(Math.floor($(product).find('#price').attr('value')));
    modal.find('#product #sales_segment_id').text($(product).find('#sales_segment').text());
    modal.find('#id').val('');
    modal.find('#performance_id').val(${performance.id});
    modal.find('#product_id').val($(product).find('#id').text());
    modal.find('#stock_holders').removeAttr('disabled');
    modal.find('#stock_id').removeAttr('disabled');
    modal.find('#product-item #price').val('');
    modal.find('#quantity').val(1);
    modal.modal('toggle');
  }

  function edit_product_item(product_id, product_item_id) {
    var product = '#product-' + product_id;
    var modal = $('#modal-product_item');
    modal.find('#product #name').text($(product).find('#name').text());
    modal.find('#product #price').text(Math.floor($(product).find('#price').attr('value')));
    modal.find('#product #sales_segment_id').text($(product).find('#sales_segment').text());
    var product_item = '#product_item-' + product_item_id;
    modal.find('#id').val(product_item_id);
    modal.find('#performance_id').val(${performance.id});
    modal.find('#product_id').val(product_id);
    modal.find('#stock_holders').val($(product_item).find('#stock_holder').attr('value')).change();
    modal.find('#stock_holders').attr('disabled', 'disabled');
    modal.find('#stock_id').val($(product_item).find('#stock').attr('value'));
    modal.find('#stock_id').attr('disabled', 'disabled');
    modal.find('#product-item #price').val(Math.floor($(product_item).find('#price').attr('value')));
    modal.find('#quantity').val($(product_item).find('#quantity').text());
    modal.modal('toggle');
  }

  function delete_product_item(product_item_id) {
    var modal = $('#modal-delete');
    modal.find('#delete').attr('href', '/products/items/delete/' + product_item_id);
    modal.find('#message').text('選択した在庫を削除します。よろしいですか？');
    modal.modal('toggle');
  }

  function save_product_item() {
    var modal = '#modal-product_item';
    var form = '#product_items-form';
    var id = $(modal + ' #id').val();
    var url = id ? '/products/items/edit/' + id : '/products/items/new';
    post_modal_form(modal, form, url);
  }
</script>
% endif
