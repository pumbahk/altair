<%page args="performance" />

% if performance:
<script type="text/javascript">
  function new_product_item(product_id) {
    var product = '#product-' + product_id;
    var modal = $('#modal-product_item');
    var product_name = $(product).find('#name').text();
    var product_price = Math.floor($(product).find('#price').attr('value'));
    modal.find('#product #name').text(product_name);
    modal.find('#product #price').text(product_price);
    modal.find('#product #sales_segment_id').val($(product).find('#sales_segment_id').attr('value')).change();
    modal.find('#product #seat_stock_type_id').val($(product).find('#seat_stock_type_id').attr('value'));
    modal.find('#id').val('');
    modal.find('#performance_id').val(${performance.id});
    modal.find('#product_id').val($(product).find('#id').text());
    modal.find('#stock_holders').removeAttr('disabled').change();
    modal.find('#stock_id').removeAttr('disabled');
    modal.find('#product-item #name').val(product_name);
    modal.find('#product-item #price').val(product_price);
    modal.find('#quantity').val(1);
    modal.modal('toggle');
  }

  function edit_product_item(product_id, product_item_id) {
    var product = '#product-' + product_id;
    var modal = $('#modal-product_item');
    modal.find('#product #name').text($(product).find('#name').text());
    modal.find('#product #price').text(Math.floor($(product).find('#price').attr('value')));
    modal.find('#product #sales_segment_id').val($(product).find('#sales_segment_id').attr('value')).change();
    modal.find('#product #seat_stock_type_id').val($(product).find('#seat_stock_type_id').attr('value'));
    modal.find('#id').val(product_item_id);
    modal.find('#performance_id').val(${performance.id});
    modal.find('#product_id').val(product_id);
    modal.find('#stock_holders').val($('#stock_holder-' + product_item_id).attr('value')).change();
    modal.find('#stock_holders').attr('disabled', 'disabled');
    modal.find('#stock_id').val($('#stock-' + product_item_id).attr('value'));
    modal.find('#stock_id').attr('disabled', 'disabled');
    modal.find('#product-item #name').val($('#item_name-' + product_item_id).attr('value'));
    modal.find('#product-item #price').val(Math.floor($('#item_price-' + product_item_id).attr('value')));
    modal.find('#quantity').val($('#quantity-' + product_item_id).text());
    modal.find('#ticket_bundle_id').val($('#ticket_bundle_id-' + product_item_id).attr('value'));
    modal.modal('toggle');
  }

  function delete_product_item(product_item_id) {
    var modal = $('#modal-delete');
    modal.find('#delete').attr('href', '/products/items/delete/' + product_item_id);
    modal.find('#message').text('選択した在庫を削除します。よろしいですか？');
    modal.modal('toggle');
  }

  function save_product_item() {
    var modal = '#modal-product_item';
    var form = '#product_items-form';
    var id = $(modal + ' #id').val();
    var url = id ? '/products/items/edit/' + id : '/products/items/new';
    post_modal_form(modal, form, url);
  }
</script>
% endif
