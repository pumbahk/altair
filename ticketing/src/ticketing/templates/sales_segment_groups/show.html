<%inherit file="/layout_2cols.html"/>
<%namespace file="/common/helpers.html" name="h"/>
<script type="text/javascript">
function get_selected_sales_segment_group_id() {
  return ${sales_segment_group.id};
}
</script>
<div class="breadcrumbs">
  ${h.breadcrumbs(
    names=[u'イベント', sales_segment_group.event.title, u'販売区分グループ', sales_segment_group.name],
    urls=[
      request.route_path('events.index'),
      request.route_path('events.show', event_id=sales_segment_group.event.id),
      request.route_path('sales_segment_groups.index', event_id=sales_segment_group.event.id),
    ]
  )}
</div>

<div class="page-header">
  <h1>販売区分グループ</h1>
</div>

<div class="content">
  ${h.flash_messages(request)}
</div>

<%include file="/sales_segment_groups/_detail.html", args="form=form_ss, sales_segment_group=sales_segment_group"/>

<%include file="/sales_segment_groups/_action_button.html" args="order=['edit', 'copy', 'delete']" />
<div id="sales_segment_groups-form">
  <%include file="./_modal.html" args="modal_id='modal-sales_segment_group', event=sales_segment_group.event" />
</div>

<hr />

<%include file="/payment_delivery_method_pairs/_list.html" args="sales_segment_group=sales_segment_group, form=form_pdmp" />
<%include file="/payment_delivery_method_pairs/_action_button.html" args="sales_segment_group=sales_segment_group" />

<hr />

<h4 style="margin-bottom:10px;">結び付けられている会員種別の情報</h4>

<div class="row-fluid">
  <div class="span12">
  <%include file="/memberships/groups/_list.html" args="member_groups=member_groups, form=form_mg" />
  </div>
</div>

<div class="btn-group">
  <a href="${request.route_path("sales_segment_groups.bind_membergroup", sales_segment_group_id=sales_segment_group.id)}" class="btn">
    <i class="icon-pencil"></i> membergroupの結びつきを変更
  </a>
  <button class="btn dropdown-toggle" data-toggle="dropdown">
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
  </ul>
</div>

<hr />

<h4 style="margin-bottom:10px;">紐づいている販売区分</h4>

<div class="row-fluid">
  <div class="span12">
    <form>
      <table class="table table-striped table-bordered table-condensed" style="margin-bottom: 10px;">
        <thead>
          <tr>
            <th class="minwidth"></th>
            <th class="minwidth">id</th>
            <th>パフォーマンス</th>
            <th>販売開始日時</th>
            <th>販売終了日時</th>
            <th>配券元</th>
            <th>上限枚数</th>
            <th>座席選択可</th>
            <th>公開</th>
          </tr>
        </thead>
        <tbody>
        % for i, sales_segment in enumerate(sales_segment_group.sales_segments):
          <tr>
            <td><input type="radio" name="sales_segment_id" value="${sales_segment.id}" /></td>
            <td>${sales_segment.id}</td>
            <td>
              % if sales_segment.performance:
                <a href="${request.route_path('performances.show_tab', performance_id=sales_segment.performance_id, tab='sales_segment')}">${sales_segment.performance.name}</a>
              % else:
                -
              % endif
            </td>
            <td>${h.safe_strftime(sales_segment.start_at)}</td>
            <td>${h.safe_strftime(sales_segment.end_at)}</td>
            <td>${sales_segment.account.name if sales_segment.account else u'(未設定)'}</td>
            <td>${sales_segment.upper_limit or u''}</td>
            <td>${u'○' if sales_segment.seat_choice else u'×'}</td>
            <td>${u'○' if sales_segment.public else u'×'}</td>
          </tr>
        % endfor
        </tbody>
      </table>
      <script type="text/javascript">
        (function (form) {
          get_selected_sales_segment_id = function get_selected_sales_segment_id() {
            return form.find('input:radio[name="sales_segment_id"]:checked').val();
          }
        })($('script:last').closest('form'));
      </script>
    </form>
    <%include file="../sales_segments/_action_button.html" />
    <%include file="../sales_segments/_modal.html" args="modal_id='modal-sales_segment'" />
  </div>
</div>
