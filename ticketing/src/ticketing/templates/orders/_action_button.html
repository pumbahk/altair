<%page args="order, sort=None" />
<%namespace file="/common/helpers.html" name="h" />
<%namespace file="/common/modal.html" name="m" />

<script type="text/javascript">
  function cancel_order(id) {
    modal = $('#modal-delete');
    modal.find('#delete').attr('href', '/orders/cancel/' + id);
    modal.find('#message').text("${u'選択した受注をキャンセルします。よろしいですか？'}");
    modal.modal('toggle');
  }
  function edit_shipping_address() {
    var modal = $('#modal-edit-shipping_address');
    modal.modal('toggle');
  }
  function save_shipping_address() {
    var modal = '#modal-edit-shipping_address';
    var form = '#shipping_address-form';
    var url = '${request.route_path('orders.edit.shipping_address', order_id=order.id)}';
    post_modal_form(modal, form, url);
  }
  function edit_product() {
    var modal = $('#modal-edit-product');
    modal.modal('toggle');
  }
  function save_product() {
    var modal = '#modal-edit-product';
    var form = '#product-form';
    var url = '${request.route_path('orders.edit.product', order_id=order.id)}';
    post_modal_form(modal, form, url);
  }
</script>

<%
actions = {
  'delivered':dict(
    label=u'配送済みにする',
    url=request.route_path('orders.delivered', order_id=order.id),
    icon='icon-ok',
  ),
  'print':dict(
    label=u'発券する',
     url=request.route_path('orders.print.queue', order_id=order.id),
    icon='icon-print',
  ),
  'cancel':dict(
    label=u'キャンセル',
    url='javascript:cancel_order(%d);' % order.id,
    icon='icon-remove',
  ),
  'edit_shipping_address':dict(
    label=u'編集',
    url='javascript:edit_shipping_address(%d);' % order.id,
    icon='icon-edit',
  ),
  'edit_product':dict(
    label=u'編集',
    url='javascript:edit_product(%d);' % order.id,
    icon='icon-edit',
  ),
  'note':dict(
    label=u'メモを保存',
    url='javascript:$("#note-form").submit();',
    icon='icon-pencil',
  ),
}
sort = iter(sort or ['delivered','cancel'])
%>
${h.action_button(actions, sort, vertical=False)}

${m.delete_modal(label_delete=u'キャンセル', label_cancel=u'戻る')}
