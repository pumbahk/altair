<%inherit file="/layout.html" />
<%namespace file="/common/helpers.html" import="flash_messages" />
<%namespace file="/common/helpers.html" import="safe_strftime" />
<%namespace file="/common/helpers.html" import="price_format" />
<%namespace file="/common/helpers.html" import="breadcrumbs" />

<div class="row-fluid">
  <%include file="/parts/_menu.html" />

  <div class="span10">
    ${breadcrumbs(
      names=[u'トップ', u'購入情報', order.id],
      urls=[request.route_path('index'), request.route_path('orders.index')]
    )}
  </div>

  <span class="span10">
    <div class="page-header">
      <h3>購入情報</h3>
    </div>

    <div class="content">
      ${flash_messages(request)}
    </div>

    <div class="span5">
      <div class="page-header">
        <h3>購入者</h3>
      </div>

      <table class="table table-striped table-bordered">
        <tr>
          <th class="span2">受注番号</th>
          <td class="span3">${order.id}</td>
        </tr>
        <tr>
          <th>購入日時</th>
          <td>${safe_strftime(order.created_at)}</td>
        </tr>
        <tr>
          <th>ニックネーム</th>
          <td>${order.user.user_profile.nick_name}</td>
        </tr>
        <tr>
          <th>ステータス</th>
          <td></td>
        </tr>
      </table>
    </div>

    <div class="span5 offset1">
      <div class="page-header">
        <h3>配送情報</h3>
      </div>

      <% sa = order.shipping_address %>
      <table class="table table-striped table-bordered">
        <tr>
          <th class="span2">氏名</th>
          <td class="span3">${sa.last_name} ${sa.first_name} (${sa.last_name_kana} ${sa.first_name_kana})</td>
        </tr>
        <tr>
          <th>住所</th>
          <td>${sa.zip} ${sa.country} ${sa.prefecture} ${sa.city} ${sa.address_1} ${sa.address_2}</td>
        </tr>
        <tr>
          <th>Tel</th>
          <td>${sa.tel_1}</td>
        </tr>
        <tr>
          <th>Fax</th>
          <td>${sa.fax}</td>
        </tr>
      </table>
    </div>

    <div class="span5">
      <div class="page-header">
        <h3>決済情報</h3>
      </div>

      <table class="table table-striped table-bordered">
        <tr>
          <th class="span2">決済方法</th>
          <td class="span3"></td>
        </tr>
        <tr>
          <th></th>
          <td></td>
        </tr>
        <tr>
          <th></th>
          <td></td>
        </tr>
        <tr>
          <th></th>
          <td></td>
        </tr>
      </table>
    </div>

    <div class="span11">
      <div class="page-header">
        <h3>商品</h3>
      </div>

      % for i, ordered_product in enumerate(order.ordered_products):
        % if i == 0:
          <table class="table table-striped table-bordered">
            <tr>
              <th class="span2">イベント</th>
              <td class="span6">${ordered_product.product.event.title}</td>
            </tr>
            <tr>
              <th>開始日時</th>
              <td>${ordered_product.ordered_product_items[0].product_item.performance.start_on}</td>
            </tr>
            <tr>
              <th>会場</th>
              <td>${ordered_product.ordered_product_items[0].product_item.performance.venue.name}</td>
            </tr>
          </table>

          <table class="table table-striped table-bordered">
            <tr>
              <th class="span10" colspan="2">商品名</th>
              <th class="span2">金額</th>
            </tr>
        % endif
            <tr>
              <td colspan="3">${ordered_product.product.name}</td>
            </tr>
        % for i, ordered_product_item in enumerate(ordered_product.ordered_product_items):
            <tr>
              <td class="span6"></td>
              <td class="span4">${ordered_product_item.product_item.stock_type.name}</td>
              <td class="span2">${price_format(ordered_product_item.product_item.price)}円</td>
            </tr>
        % endfor
      % else:
            <tr>
              <td colspan="2"><strong>合計</strong></td>
              <td class="span2">${price_format(order.total_amount)}円</td>
            </tr>
          </table>
      % endfor
    </div>

  </span>
</div>
