<%inherit file="/layout.html"/>
<%namespace file="/common/helpers.html" import="flash_messages" />
<%namespace file="/common/helpers.html" import="safe_strftime" />
<%namespace file="/common/helpers.html" import="price_format" />
<%namespace file="/common/helpers.html" import="breadcrumbs" />
<%namespace file="/common/helpers.html" import="pager"/>
<%namespace file="/common/helpers.html" import="sortable"/>

<style>
  .ordered-item {
    text-decoration: none;
    background-color: #EEE;
    display: inline-block;
    border: 1px solid #DDD;
    text-align: center;
    -webkit-border-radius: 15px;
    -moz-border-radius: 15px;
    border-radius: 15px;
    min-height: 20px;
    line-height: 20px;
    padding: 5px 14px 5px 14px
  }
</style>

<div class="row-fluid">
  <%include file="/parts/_menu.html" />

  <div class="span10">
    ${breadcrumbs(
      names=[u'トップ', u'購入情報'],
      urls=[request.route_path('index')]
    )}
  </div>

  <span class="span10">
    <div class="page-header">
      <h3>購入情報</h3>
    </div>

    <div class="content">
      ${flash_messages(request)}
    </div>

    <table class="table table-striped table-bordered">
      <thead>
      <tr>
        <th class="minwidth"></th>
        <th class="minwidth">${sortable(form.id)}</th>
        <th class="span2">${sortable(form.created_at)}</th>
        <th class="span2">${sortable(form.total_amount)}</th>
        <th class="span2">ユーザー</th>
        <th>イベント</th>
        <th class="span2">日時</th>
        <th>会場</th>
      </tr>
      </thead>
      <tbody>
      % for order in orders:
      <tr>
        <td></td>
        <td>${order.id}</td>
        <td><a href="${request.route_path('orders.show', order_id=order.id)}">${safe_strftime(order.created_at)}</a></td>
        <td>${price_format(order.total_amount)}円</td>
        <td>${order.user.user_profile.nick_name}</td>
        <td>${order.ordered_products[0].product.event.title}</td>
        <td>${order.ordered_products[0].ordered_product_items[0].product_item.performance.start_on}</td>
        <td>${order.ordered_products[0].ordered_product_items[0].product_item.performance.venue.name}</td>
      </tr>
      <tr>
        <td colspan="8">
          % for ordered_product in order.ordered_products:
          <span class="ordered-item">${ordered_product.product.name} ${price_format(ordered_product.product.price)}円</span>
          % endfor
        </td>
      </tr>
      % endfor
      </tbody>
    </table>
  </span>
  ${pager(orders)}
</div>
