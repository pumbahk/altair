<%inherit file="/layout_2cols.html"/>
<%namespace file="/common/helpers.html" name="h" />

<div class="breadcrumbs">
  ${h.breadcrumbs(
    names=[u'トップ', u'購入情報'],
    urls=[request.route_path('index')]
  )}
</div>

<div class="page-header">
  <h1>購入情報</h1>
</div>

<div class="content">
  ${h.flash_messages(request)}
  ${h.alert_message(form_search)}
</div>

<div style="float: left;">
  <%include file="/orders/_search.html" args="form=form_search" />
</div>
<div style="clear: both;"></div>

## todo move 
<script type="text/javascript">
  <%include file="/orders/_printstatus.js"/>
  $.event.add(window, "load", function(){
  var model = new PrintStatus(0);
  var view = new PrintStatusAppView($("#printstatus_count"), $("input.printstatus"));
  var urls = {
    load: "${request.route_url('orders.api.printstatus', action='load')}", 
    add: "${request.route_url('orders.api.printstatus', action='add')}", 
    addall: "${request.route_url('orders.api.printstatus', action='addall')}", 
    remove: "${request.route_url('orders.api.printstatus', action='remove')}", 
    removeall: "${request.route_url('orders.api.printstatus', action='removeall')}", 
    reset: "${request.route_url('orders.api.printstatus', action='reset')}"
  }

  var presenter = new PrintStatusPresenter(model, view, urls);
  $("input.printstatus[type='checkbox']").on("change", presenter.on_check.bind(presenter));
  $("#printstatus_reset").click(presenter.on_reset.bind(presenter));
  $("#addall").click(presenter.on_addall.bind(presenter));
  $("#removeall").click(presenter.on_removeall.bind(presenter));
  presenter.on_load();

  // selectable check
  $("table").selectable({
  filter: "td.printstatus-wrap",
  distance: 1,
  stop: function(){
      $(".ui-selected input[type='checkbox']", this).each(function(_,e){
          $(e).click();
       });
      $(".ui-selected").removeClass("ui-selected");
    }
  })
});
</script>
<div class="area">
  <dl>
	<dt>チェックされた数</dt><dd id="printstatus_count"></dd>
  </dl>

  %if request.matched_route.name == "orders.checked.index":
    <a href="${request.route_path("orders.index")}">全部の購入情報を表示</a>
  %else:
    <a href="${request.route_path("orders.checked.index")}">チェックした購入情報だけ表示</a>
  %endif
  <!-- <button type="button" class="btn" id="printstatus_save">save</button> -->
  <button type="button" class="btn" id="printstatus_reset">reset</button>
  <form style="display:inline" action="${request.route_path("orders.checked.queue")}" method="POST">
	   <button class="btn" type="submit"><i class="icon-print"></i> チェックしている注文をキューに入れる</button>
  </form>
   <a type="button" class="btn" id="addall">全部ON</a>
   <a type="button" class="btn" id="removeall">全部OFF</a>
</div>

<p> ${max(orders.items_per_page * (orders.page-1) + 1,0)}～${min(orders.items_per_page * orders.page, orders.item_count)} / ${orders.item_count}件</p>
<div class="orders">
  <%include file="/orders/_list.html" args="form=form, orders=orders" />
</div>

<script type="text/javascript">
  $(function(){
    // ajax modal
    $("a.ajax-modal[data-toggle=modal]").click(function(){
        var wrap = $($(this).attr("data-target"));
        wrap.empty();
        $(wrap).load($(this).attr("href"));
    });
  });
</script>

