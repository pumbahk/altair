<%page args="stock_types, performance=None, limit=None" />
<%namespace file="/common/helpers.html" name='h' />

<% paging = False if limit else True %>
<%
seat_stock_types = []
non_seat_stock_types = []
for stock_type in stock_types:
  if stock_type.is_seat:
    seat_stock_types.append(stock_type)
  else:
    non_seat_stock_types.append(stock_type)
%>
<style>
  .swatch {
    display: inline-block;
    width: 20px;
    height: 20px;
    margin: -6px 2px;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
  }
</style>

<div class="row-fluid">
  % if seat_stock_types:
  <div class="span6">
    <h4>席種</h4>

    <table class="table table-striped table-bordered table-condensed">
      <thead>
        <tr>
          <th style="width:30px"></th>
          <th style="width:20px"></th>
          <th>名称</th>
          <th>席数</th>
          <th style="width:40px">表示順</th>
        </tr>
      </thead>
      <tbody>
      % for i, stock_type in enumerate(seat_stock_types):
        <%
          if limit and i >= limit: break
          conditions = {'performance_id':performance.id} if performance else {}
          quantity = stock_type.num_seats(**conditions) or 0
        %>
        <tr>
          <td>
            <input type="radio" name="stock_type_id" value=${stock_type.id} />
          </td>
          <td>
            ${h.seat_style(stock_type.style)}
          </td>
          <td>
            <a href="javascript:edit_stock_type(${stock_type.id});"
               id="stock_type-${stock_type.id}"
               name="${stock_type.name}"
               type="${stock_type.type}"
               quantity_only="${1 if stock_type.quantity_only else 0}"
               quantity="${quantity}"
               order_no="${stock_type.order_no}"
               data="${h.json(stock_type.style)}">
              ${stock_type.name}
            </a>
          </td>
          <td style="width: 60px">
            ${quantity}
          </td>
          <td>
            ${stock_type.order_no}
          </td>
        </tr>
      % endfor
      </tbody>
    </table>
  </div>
  %endif

  %if non_seat_stock_types:
  <div class="span6">
    <h4>その他</h4>

    <table class="table table-striped table-bordered table-condensed">
      <thead>
        <tr>
          <th style="width:30px"></th>
          <th>名称</th>
          <th>在庫数</th>
          <th style="width:40px">表示順</th>
        </tr>
      </thead>
      <tbody>
      % for i, stock_type in enumerate(non_seat_stock_types):
        <%
          if limit and i >= limit: break
          conditions = {'performance_id':performance.id} if performance else {}
          quantity = stock_type.num_seats(**conditions) or 0
        %>
        <tr>
          <td>
            <input type="radio" name="stock_type_id" value=${stock_type.id} />
          </td>
          <td>
            <a href="javascript:edit_stock_type(${stock_type.id});"
               id="stock_type-${stock_type.id}"
               name="${stock_type.name}"
               type="${stock_type.type}"
               quantity_only="${1 if stock_type.quantity_only else 0}"
               quantity="${quantity}"
               order_no="${stock_type.order_no}"
               data='${h.json(stock_type.style)}'>
              ${stock_type.name}
            </a>
          </td>
          <td style="width: 60px">
            ${quantity}
          </td>
          <td>
            ${stock_type.order_no}
          </td>
        </tr>
      % endfor
      </tbody>
    </table>
  </div>
  % endif
</div>

% if paging:
  ${h.pager(stock_types)}
% endif
