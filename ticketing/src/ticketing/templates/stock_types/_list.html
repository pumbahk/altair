<%page args="stock_types, performance=None, limit=None" />
<%namespace file="/common/helpers.html" name='h' />

<% paging = False if limit else True %>

<style>
  .swatch {
    display: inline-block;
    width: 20px;
    height: 20px;
    margin: -6px 2px;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
  }
</style>

% if stock_types:
  % if performance:
  <h4>席種</h4>
  % endif
  <table class="table table-striped table-bordered">
    <tbody>
    <tr>
      <th></th>
      <th>名称</th>
      <th>席数</th>
    </tr>
    % for i, stock_type in enumerate(stock_types):
      <% if limit and i >= limit: break %>
      % if stock_type.is_seat or not performance:
      <%
        conditions = {'performance_id':performance.id} if performance else {}
        quantity = stock_type.num_seats(**conditions) or 0
        allocated = 0
      %>
    <tr>
      <td style="width: 40px">
        <input type="radio" name="stock_type_id" value=${stock_type.id} />
      </td>
      <td>
        <a href="javascript:edit_stock_type(${stock_type.id});"
           id="stock_type-${stock_type.id}"
           name="${stock_type.name}"
           type="${stock_type.type}"
           quantity="${quantity}"
           data="${h.json(stock_type.style)}">
          ${h.seat_style(stock_type.style)}
          ${stock_type.name}
        </a>
      </td>
      <td style="width: 60px">
        ${quantity}
      </td>
    </tr>
      % endif
    % endfor
    </tbody>
  </table>

  % if performance:
  <h4>その他</h4>
  <table class="table table-striped table-bordered">
    <tbody>
    <tr>
      <th></th>
      <th>名称</th>
      <th>在庫数</th>
    </tr>
    % for stock_type in stock_types:
      % if not stock_type.is_seat:
      <%
        conditions = {'performance_id':performance.id} if performance else {}
        quantity = stock_type.num_seats(**conditions) or 0
      %>
    <tr>
      <td style="width: 40px">
        <input type="radio" name="stock_type_id" value=${stock_type.id} />
      </td>
      <td>
        <a href="javascript:edit_stock_type(${stock_type.id});"
           id="stock_type-${stock_type.id}"
           name="${stock_type.name}"
           type="${stock_type.type}"
           quantity="${quantity}"
           data='${h.json(stock_type.style)}'>
          ${h.seat_style(stock_type.style)}
          ${stock_type.name}
        </a>
      </td>
      <td style="width: 60px">
        ${quantity}
      </td>
    </tr>
      % endif
    % endfor
    </tbody>
  </table>
  % endif
% endif

% if paging:
  ${h.pager(stock_types)}
% endif
