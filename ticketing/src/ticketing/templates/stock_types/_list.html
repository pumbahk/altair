<%page args="stock_types, performance=None, limit=None" />
<%namespace file="/common/helpers.html" name='h' />

<% paging = False if limit else True %>
<%
seat_stock_types = []
non_seat_stock_types = []
for stock_type in stock_types:
  if stock_type.is_seat:
    seat_stock_types.append(stock_type)
  else:
    non_seat_stock_types.append(stock_type)
%>
<style>
  .swatch {
    display: inline-block;
    width: 20px;
    height: 20px;
    margin: -6px 2px;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
  }
</style>

<div class="row-fluid" style="margin-top: 20px;">
  % if seat_stock_types:
  <div class="span6">
    <h4>席種</h4>

    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th style="width:20px"></th>
          <th>名称</th>
          <th>席数</th>
        </tr>
      </thead>
      <tbody>
      % for stock_type in seat_stock_types:
        <%
          conditions = {'performance_id':performance.id} if performance else {}
          quantity = stock_type.num_seats(**conditions) or 0
        %>
        <tr>
          <td>
            ${h.seat_style(stock_type.style)}
          </td>
          <td>
            <a href="javascript:edit_stock_type(${stock_type.id});"
               id="stock_type-${stock_type.id}"
               name="${stock_type.name}"
               type="${stock_type.type}"
               quantity="${quantity}"
               data="${h.json(stock_type.style)}">
              ${stock_type.name}
            </a>
          </td>
          <td style="width: 60px">
            ${quantity}
          </td>
        </tr>
      % endfor
      </tbody>
    </table>
  </div>
  %endif

  %if non_seat_stock_types:
  <div class="span6">
    <h4>その他</h4>

    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th style="width:20px"></th>
          <th>名称</th>
          <th>在庫数</th>
        </tr>
      </thead>
      <tbody>
      % for stock_type in non_seat_stock_types:
        <%
          conditions = {'performance_id':performance.id} if performance else {}
          quantity = stock_type.num_seats(**conditions) or 0
        %>
        <tr>
          <td>
            ${h.seat_style(stock_type.style)}
          </td>
          <td>
            <a href="javascript:edit_stock_type(${stock_type.id});"
               id="stock_type-${stock_type.id}"
               name="${stock_type.name}"
               type="${stock_type.type}"
               quantity="${quantity}"
               data='${h.json(stock_type.style)}'>
              ${stock_type.name}
            </a>
          </td>
          <td style="width: 60px">
            ${quantity}
          </td>
        </tr>
      % endfor
      </tbody>
    </table>
  </div>
  % endif
</div>

% if paging:
  ${h.pager(stock_types)}
% endif
