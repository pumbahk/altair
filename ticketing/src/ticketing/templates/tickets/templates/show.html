<%inherit file="../../layout_2cols.html" />
<%namespace file="/common/helpers.html" import="breadcrumbs,pager,flash_messages"/>
<% import json %>
<div class="breadcrumbs">
${breadcrumbs(
  names=[u'トップ', u'チケット券面', u'テンプレート: %s' % template.name],
  urls=[request.route_path('index'), request.route_path('tickets.index')]
)}
</div>
<div class="page-header">
  <h1>チケットテンプレート</h1>
</div>
<div class="content">
  ${flash_messages(request)}
</div>

<div class="row-fluid">
  <div class="span6">
    <h3>詳細</h3>
    <table class="table table-striped table-bordered">
      <tbody>
        <tr>
          <th class="span2">名称</th>
          <td class="span3">${template.name}</td>
        </tr>
        <tr>
          <th class="span2">チケット様式</th>
          <td class="span3"><a href="${request.route_path("tickets.ticketformats.show",id=template.ticket_format_id)}">
			  ${template.ticket_format.name}
		  </td>
        </tr>
        <tr>
          <th class="span2">作成日時</th>
          <td class="span3">${template.created_at}</td>
        </tr>
        <tr>
          <th class="span2">更新日時</th>
          <td class="span3">${template.updated_at}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="span6"></div>
</div>

<div class="row-fluid">
  <div  id="ticket-viewer"></div>
  <script type="text/javascript" src="${request.static_url("ticketing:static/js/spin.js")}"></script>
  <script type="text/javascript" src="${request.static_url("ticketing:static/js/altair/spinner.js")}"></script>
  <script type="text/javascript" src="${request.static_url("ticketing:static/js/tickets/modal/api.js")}"></script>
  <script type="text/javascript">
    $(function(){
      var modalView = false;
      var modelname = "Ticket";

      // preview component
      $("a.#preview_btn").on("click", function(){

        var $el = $(this);
        var pk = $el.attr("data-pk");
        if(!!modalView){
          modalView.onClick();
          apps["loadsvg"].model.changeHolder({pk: pk, name: modelname})
          return true;
        }

        modalView = new modal.api.AjaxModalView({
          el: $el,
          href: "${request.route_path('tickets.preview.dialog', model="Ticket")}",
          modalArea: $("#ticket-viewer"), 
          option: {backdrop: false, stretch: true}, 
          header: "チケット券面のpreview",
          callback: function(modalview){
           // append select
            apps["loadsvg"] = new preview.SVGFromModelView({el: modalview.$modalArea, model: apps["preview"].models["params"], modelname: modelname});
            apps["loadsvg"].model.changeHolder({pk: ${template.id}, name: modelname})
          }
        });
        modalView.onClick();
        return true;
      });
    });
</script>
</div>

<div class="row-fluid well">
  <div class="btn-group">
    <a href="${request.route_path("tickets.templates.edit",id=template.id)}" class="btn">
      <i class="icon-pencil"></i> 編集
    </a>
    <button class="btn dropdown-toggle" data-toggle="dropdown">
      <span class="caret"></span>
    </button>
    <ul class="dropdown-menu">
      <li><a href="#deleteModal" data-toggle="modal"><i class="icon-minus"></i> 削除</a></li>
		  <li><a href="${request.route_path("tickets.templates.download",id=template.id)}"><i class="icon-minus"></i> 登録されている内容をdownload</a></li>
      <li><a id="preview_btn"> <i class="icon-eye-open"></i> preview</a></li>
<%doc>
          <li>
            <a href="${request.route_path("tickets.templates.new",_query=dict(id=template.id))}">
              <i class="icon-plus"></i> コピーして新規作成
            </a>
          </li>
</%doc>
        </ul>
  </div>
</div>

<div class="modal hide" id="deleteModal">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h3>確認</h3>
  </div>
  <div class="modal-body">
    このチケットテンプレートを削除します。よろしいですか？
  </div>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">キャンセル</a>
    <form action="${request.route_path("tickets.templates.delete",id=template.id)}" method="POST">
      <button type="submit" class="btn">削除する</button>
    </form>
  </div>
</div>
