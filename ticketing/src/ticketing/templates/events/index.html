<%inherit file="../layout.html"/>
<%namespace file="/common/helpers.html" import="pager"/>                                               
<%namespace file="/common/helpers.html" import="flash_messages" />

<script type="text/javascript">
  $('.new-performance').click(function(e) {
    e.preventDefault();
    var href = $(e.target).attr('href');
    if (href.indexOf('#') == 0) {
      $(href).modal('open');
    } else {
      $.get(href, function(data) {
          $('<div class="modal fade" >' + data + '</div>').modal();
      });
    }
  });
</script>

<div class="modal fade" id="modal-search">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>検索条件設定</h3>
  </div>

  <div class="modal-body">
    <form action="">
      <label>イベント</label>
        <input type="text" class="span3" placeholder="イベント名">
        <label>パフォーマンス</label>
        <input type="text" class="span3" placeholder="パフォーマンスコード">
        <label>公演日</label>
        <input type="text" class="span3" placeholder="2012/07/01 18:00">
    </form>
  </div>

  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">閉じる</a>
    <a href="#" class="btn btn-primary">検索</a>
  </div>
</div>

<div class="row-fluid">
  <%include file="_menu.html" /> 

  <span class="span10">
    <div class="page-header">
      <h3>イベント一覧</h3>
    </div>

    <div class="content">
      ${flash_messages(request)}
    </div>

    <ul class="nav nav-pills">
      <li class="dropdown" id="top-event">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#top-even1t">
          イベント
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a data-toggle="modal" href="${request.route_path('events.new')}" >新規イベント</a></li>
          <li><a data-toggle="modal" href="#modal-new-stock-group-send" >イベントをコピー</a></li>
          <li class="divider"></li>
        </ul>
      </li>
      <li class="dropdown" id="top-search">
        <a data-toggle="modal" href="#modal-search">
        検索条件設定
        </a>
      </li>
      <li class="dropdown" id="top-search-text">
        <input type="text" class="search-query span2" placeholder="Search">
      </li>
    </ul>

    % for event in events.items:
    <div class="well">
      <h4 style="float: left">${event.title}</h4>
      <div class="btn-group" style="float: right; margin-right: 60px">
        <a href="${request.route_path('events.edit', event_id=event.id)}" class="btn" ><i class="icon-pencil"></i> 編集</a>
        <button class="btn dropdown-toggle" data-toggle="dropdown">
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
          <li><a href=""><i class="icon-plus"></i> コピー</a></li>
          <li><a href="${request.route_path('performances.new', event_id=event.id)}" class="new-performance">
            <i class="icon-plus"></i> パフォーマンス追加</a>
          </li>
          <li class="divider"></li>
          <li><a href=""><i class="icon-minus"></i> 料率設定</a></li>
          <li class="divider"></li>
          <li><a href=""><i class="icon-minus"></i> 削除</a></li>
        </ul>
      </div>
      <br style="clear: both" />
      <span class="label label-important">先行</span>
      <span class="label label-success">一般</span>
      <%include file="/performances/_list.html" args="performances=event.performances" /> 
      <div style="float: right"><a href="${request.route_path('events.show', event_id=event.id)}">このイベントの他の公演を見る</a></div>
      <br style="clear: both" />
    </div>
    % endfor
  </span>
  ${pager(events)}
</div>
