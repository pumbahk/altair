<%page args="event, order=None" />
<%namespace file="/common/helpers.html" name="ch" />
<%namespace file="/common/modal.html" import="delete_modal" />

<script type="text/javascript">
  function delete_event(id) {
    modal = $('#modal-delete');
    modal.find('#delete').attr('href', '/events/delete/' + id);
    modal.find('#message').text("${u'選択したイベントを削除します。よろしいですか？'}");
    modal.modal('toggle');
  }
  function send_event(id) {
    modal = $('#modal-send_event');
    modal.find('#send_event').attr('href', '/events/send/' + id);
    modal.modal('toggle');
  }
  function copy_event(id) {
    $(location).attr('href', '/events/copy/' + id);
  }
</script>

<%
  actions = {
    'new':dict(
      label=u'新規',
      url=request.route_path('events.new'),
      icon='icon-plus',
      route_name='events.new',
    ),
    'edit':dict(
      label=u'編集',
      url=request.route_path('events.edit', event_id=event.id),
      icon='icon-pencil',
      route_name='events.edit',
    ),
    'delete':dict(
      label=u'削除',
      url='javascript:delete_event(%d);' % event.id,
      icon='icon-minus',
      route_name='events.delete',
    ),
    'show':dict(
      label=u'詳細',
      url=request.route_path('events.show', event_id=event.id),
      icon='icon-th-list',
      route_name='events.show',
    ),
    'copy':dict(
      label=u'コピーして新規作成',
      url='javascript:copy_event(%d);' % event.id,
      icon='icon-plus',
      route_name='events.copy',
    ),
  }

  order = iter(order or ['new', 'show', 'edit', 'delete', 'copy'])
%>
<div style="float: left;">
  ${ch.action_button(actions, order)}
</div>

<div class="btn-group" style="float: left;">
  % if event.cms_send_at:
    % if event.updated_at > event.cms_send_at:
      <a class="btn btn-warning" href="javascript:send_event(${event.id});" style="margin-left: 10px;">
        <i class="icon-refresh icon-white"></i> CMSへ送信
      </a>
    % else:
      <a class="btn btn-inverse" href="javascript:send_event(${event.id});" style="margin-left: 10px;">
        <i class="icon-refresh icon-white"></i> CMSへ送信
      </a>
    % endif
  % else:
    <a class="btn btn-warning" href="javascript:send_event(${event.id});" style="margin-left: 10px;">
        <i class="icon-refresh icon-white"></i> CMSへ送信
    </a>
  % endif
</div>

<div class="btn-group" style="float: left;">
  <a class="btn" href="${request.route_path('reports.index', event_id=event.id)}" style="margin-left: 10px;">
    帳票
  </a>
</div>

<div class="btn-group" style="float: left;">
  <a class="btn" href="${request.route_path('events.tickets.index', event_id=event.id)}" style="margin-left: 10px;">
	券面
  </a>
</div>

<div class="btn-group" style="float: left;">
  <a class="btn" href="${request.route_path('events.mailinfo.index', event_id=event.id)}" style="margin-left: 10px;">
	メール
  </a>
</div>
<div class="btn-group" style="float: left;">
  <a class="btn" href="${request.route_path('orders.index', _query=dict(event_id=event.id))}" style="margin-left: 10px;">
	このイベントの商品情報
  </a>
</div>
<div class="btn-group" style="float: left;">
  <a class="btn" href="${request.route_path('lots.index', event_id=event.id)}" style="margin-left: 10px;">
	抽選
  </a>
</div>

<div style="clear: left;"></div>

<div id="modal-send_event" class="modal hide">
  <div class="modal-header">
    <a href="#" class="close">&times;</a>
    <h3>確認</h3>
  </div>

  <div class="modal-body">
    <p>CMSへイベントを送信します。よろしいですか？</p>
  </div>
  <div class="modal-footer">
    <a href="javascript:void(0);" onclick="$('#modal-send_event').modal('hide');" class="btn secondary">キャンセル</a>
    <a id="send_event" href="" class="btn danger">送信</a>
  </div>
</div>

${delete_modal()}
