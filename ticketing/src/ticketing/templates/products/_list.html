<%page args="event=None, performance=None" />
<%namespace file="/common/helpers.html" import="safe_strftime" />

% if event and len(event.products) > 0:
  <table class="table table-striped table-bordered table-condensed">
    <thead>
      <tr>
        <th class="minwidth"></th>
        <th class="minwidth">ID</th>
        <th><a href="#" class="sortable">商品名</a></th>
        <th><a href="#" class="sortable">価格</a></th>
        <th><a href="#" class="sortable">販売区分</a></th>
        <th><a href="#" class="sortable">販売開始日時</a></th>
        <th><a href="#" class="sortable">販売終了日時</a></th>
      </tr>
    </thead>
    <tbody>
    % for product in event.products:
      <tr id="product-${product.id}">
        <th class="minwidth"><input type="radio" name="product_id" value="${product.id}" /></th>
        <td id="id">${product.id}</td>
        <td><a href="javascript:edit_product('${product.id}');" id="name">${product.name}</a></td>
        <td id="price">${product.price}</td>
        % if product.sales_segment:
        <td>
          <a href="${request.route_path('sales_segments.show', sales_segment_id=product.sales_segment.id)}">
            <div id="sales_segment" value="${product.sales_segment.id}">${product.sales_segment.name}</div >
          </a>
        </td>
        <td>${safe_strftime(product.sales_segment.start_at)}</td>
        <td>${safe_strftime(product.sales_segment.end_at)}</td>
        % else:
        <td></td>
        <td></td>
        <td></td>
        % endif
      </tr>
      % if performance:
      <tr>
        <td colspan="7">
          <table class="table table-bordered table-condensed" style="width:500px">
            <tr>
              <th></td>
              <th>枠名</td>
              <th>席種</td>
              <th>席数</td>
              <th>単価</td>
            </tr>
            % for item in product.items_by_performance_id(performance.id):
            <tr id="product_item-${item.id}">
              <td>
                <input class="btn-mini btn-primary" type="button" value="編集" onclick="javascript:edit_product_item('${product.id}', '${item.id}');">
                <input class="btn-mini btn-primary" type="button" value="削除" onclick="javascript:delete_product_item('${item.id}');">
              </td>
              <td><div id="stock_holder" value="${item.stock.stock_holder.id}">${item.stock.stock_holder.name}</div></td>
              <td><div id="stock" value="${item.stock.id}">${item.stock.seat_type.name}</div></td>
              <td>${item.stock.quantity}</td>
              <td id="price">${item.price}</td>
            </tr>
            % endfor
          </table>
          <input class="btn-mini btn-primary" type="button" value="追加" onclick="javascript:add_product_item('${product.id}');">
        </td>
      </tr>
      % endif
    % endfor
    </tbody>
  </table>
% endif
