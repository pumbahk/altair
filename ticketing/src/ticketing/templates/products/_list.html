<%page args="form, products=None, performance=None, limit=None" />
<%namespace file="/common/helpers.html" import="safe_strftime" />
<%namespace file="/common/helpers.html" import="price_format" />
<%namespace file="/common/helpers.html" import="pager"/>
<%namespace file="/common/helpers.html" import="sortable" />

<% paging = False if limit else True %>

<style>
  .product-item-group > .product-item {
    position: relative;
    float: left;
    margin-left: -1px;
    -webkit-border-radius: 0;
    -moz-border-radius: 0;
    border-radius: 0;
  }

  .product-item-group > .product-item:first-child {
    margin-left: 0;
    -webkit-border-bottom-left-radius: 15px;
    border-bottom-left-radius: 15px;
    -webkit-border-top-left-radius: 15px;
    border-top-left-radius: 15px;
    -moz-border-radius-bottomleft: 15px;
    -moz-border-radius-topleft: 15px;
  }

  .product-item-group > .product-item:last-child {
    -webkit-border-top-right-radius: 15px;
    border-top-right-radius: 15px;
    -webkit-border-bottom-right-radius: 15px;
    border-bottom-right-radius: 15px;
    -moz-border-radius-topright: 15px;
    -moz-border-radius-bottomright: 15px;
  }

  .product-item {
    text-decoration: none;
    background-color: #0074CC;
    display: inline-block;
    border: 0px solid #DDD;
    text-align: center;
    color: white;
    -webkit-border-radius: 15px;
    -moz-border-radius: 15px;
    border-radius: 15px;
    min-height: 20px;
    line-height: 20px;
    padding: 5px 14px 5px 14px;
    mergin-left:-1px;
  }
</style>

% if products:
<table class="table table-striped table-bordered table-condensed">
  <thead>
    <tr>
      <th class="minwidth"></th>
      <th class="minwidth">${sortable(form.id, paging)}</th>
      <th>${sortable(form.name, paging)}</th>
      <th>${sortable(form.price, paging)}</th>
      <th>販売区分</th>
      <th>販売開始日時</th>
      <th>販売終了日時</th>
    </tr>
  </thead>
  <tbody>
  % for i, product in enumerate(products):
    <% if limit and i >= limit: break %>
    <tr id="product-${product.id}">
      <th><input type="radio" name="product_id" value="${product.id}" /></th>
      <td id="id">${product.id}</td>
      <td><a href="javascript:edit_product('${product.id}');" id="name">${product.name}</a></td>
      <td id="price" value="${product.price}">${price_format(product.price)}円</td>
      % if product.sales_segment:
      <td>
        <a href="${request.route_path('sales_segments.show', sales_segment_id=product.sales_segment.id)}">
          <div id="sales_segment" value="${product.sales_segment.id}">${product.sales_segment.name}</div >
        </a>
      </td>
      <td>${safe_strftime(product.sales_segment.start_at)}</td>
      <td>${safe_strftime(product.sales_segment.end_at)}</td>
      % else:
      <td></td>
      <td></td>
      <td></td>
      % endif
    </tr>

    % if performance:
    <tr>
      <td colspan="7">
        % for item in product.items_by_performance_id(performance.id):
        <div class="product-item-group" id="product_item-${item.id}">
          <div class="product-item" id="stock_holder" value="${item.stock.stock_holder.id}">${item.stock.stock_holder.name}</div>
          <div class="product-item" id="stock" value="${item.stock.id}">${item.stock.stock_type.name}</div>
          <div class="product-item">${item.stock.quantity}席</div>
          <div class="product-item" id="price" value="${item.price}">${price_format(item.price)}円</div>
          <div class="product-item" id="quantity">${item.quantity}</div>
          <div class="product-item">
            <a style="color: white;" href="javascript:edit_product_item('${product.id}', '${item.id}');">編集</a>
            <a style="color: white;" href="javascript:delete_product_item('${item.id}');">削除</a>
          </div>
        </div>
        % endfor
        <input class="btn btn-primary pull-right" type="button" value="追加" onclick="javascript:new_product_item('${product.id}');">
      </td>
    </tr>
    % endif

  % endfor
  </tbody>
</table>
% endif

% if paging:
  ${pager(products)}
% endif
