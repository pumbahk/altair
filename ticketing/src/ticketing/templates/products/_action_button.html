<%page args="event, order=None" />
<%namespace file="/common/helpers.html" import="action_button" />
<%namespace file="/common/modal.html" import="delete_modal" />

<script type="text/javascript">
  function show_product() {
    var id = get_id('product_id');
    if (!id) return;
    $(location).attr('href', '/products/show/' + id);
  }
  function new_product() {
    var modal = $('#modal-product');
    reset_form(modal, "#event_id");
    modal.modal('toggle');
  }
  function edit_product(id) {
    id = id || get_id('product_id');
    if (!id) return;
    var el = '#product-' + id;
    var modal = $('#modal-product');
    modal.find('#id').val($(el).find('#id').text());
    modal.find('#name').val($(el).find('#name').text());
    modal.find('#price').val(Math.floor($(el).find('#price').attr('value')));
    modal.find('#display_order').val($(el).find('#display_order').text());
    modal.find('#sales_segment_id').val($(el).find('input[name=sales_segment_id]').attr('value'));
    modal.find('#seat_stock_type_id').val($(el).find('#seat_stock_type_id').attr('value'));
    modal.modal('toggle');
  }
  function delete_product() {
    var id = get_id('product_id');
    if (!id) return;
    var modal = $('#modal-delete');
    modal.find('#delete').attr('href', '/products/delete/' + id);
    modal.find('#message').text('選択した商品を削除します。よろしいですか？');
    modal.modal('toggle');
  }
  function save_product() {
    var modal = '#modal-product';
    var form = '#products-form';
    var id = $(modal).find('#id').val();
    var url = id ? '/products/edit/' + id : '/products/new/' + $(modal).find('#event_id').val();
    post_modal_form(modal, form, url);
  }
</script>

<%
  actions = {
    'new':dict(
      label=u'新規',
      url='javascript:new_product();',
      icon='icon-plus',
    ),
    'edit':dict(
      label=u'編集',
      url='javascript:edit_product();',
      icon='icon-pencil',
    ),
    'delete':dict(
      label=u'削除',
      url='javascript:delete_product();',
      icon='icon-minus',
    ),
  }
  order = iter(order or ['new', 'edit', 'delete'])
%>
${action_button(actions, order)}

${delete_modal()}
