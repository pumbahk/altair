<%inherit file="../layout_2cols.html" />
<%namespace file="/common/helpers.html" name="h" />
<%namespace file="_entries_tabs.html" name="tabs" />
<%
from ticketing.cart.helpers import format_currency
%>
<%block name="style">
<link rel="stylesheet" type="text/css" href="/static/css/decentcolorpicker.css" />
<link rel="stylesheet" type="text/css" href="/static/css/performance.css" />
</%block>
<%block name="fulltitle">
Altair Backend -- ${lot.event.title}[${lot.name}]
</%block>
<%block name="javascript">
</%block>
<div class="breadcrumbs">
  ${h.breadcrumbs(
      names=[u'イベント', lot.event.title, u'抽選', lot.name, u'申し込み状況'],
      urls=[
        request.route_path('events.index'),
        request.route_path('events.show', event_id=lot.event.id),
        request.route_path('lots.index', event_id=lot.event.id),
        request.route_path('lots.show', lot_id=lot.id),
      ]
  )}
</div>
<div class="page-header">
  <h1>
    ${lot.event.title}<br />
    <small>${lot.name}</small>
  </h1>
</div>
<div class="content">
  ${h.flash_messages(request)}
</div>
${tabs.tabs(request)}
<div>
<h3>当選予定状況</h3>
<div>
<table class="table">
<tr>
<th>公演</th>
<th>在庫種別(席種)</th>
<th>当選予定の合計在庫数</th>
<th>現在庫数</th>
<th>申込件数</th>
</tr>
%for s in electing.required_stocks:
<tr>
<td>${s[3].name} ${s[3].start_on}</td>
<td>${s[0].stock_type.name}</td>
<td>${s[4]}</td>
<td>${s[1].quantity}</td>
<td>${s[5]}</td>
</tr>
%endfor
</table>
</div>
<h3>当選確定処理</h3>
<p>
<ul>
%for blocker in electing.blockers:
<li>${blocker}</li>
%endfor
</ul>
</p>
<form method="POST" action="${request.route_url('lots.entries.elect', lot_id=lot.id)}">
    <button ${"disabled" if electing.blockers else ""} class="btn">当選確定処理を実行する</button>
</form>
</div>

<div>
<h3>ファイル</h3>
<fieldset>
<legend>抽選申込情報のエクスポート</legend>
<a href="${request.route_url('lots.entries.export', lot_id=lot.id)}" class="btn">エクスポート</a>
</fieldset>

<form enctype="multipart/form-data" method="POST" action="${request.route_url('lots.entries.import', lot_id=lot.id)}">
  <fieldset>
    <legend>当選予定情報のインポート</legend>

    <input type="file" name="entries"/><br/>
    <button type="submit" class="btn">当選データインポート</button>
  </fieldset>
</form>

</div>
