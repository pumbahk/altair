<script type="text/javascript" src="/static/js/ticketing.ticket-designer.js"></script>
  <style type="text/css">
.view {
    position: relative;
    width: 100%;
    height: 100%;
}

#view .viewport {
  position: absolute;
  left: 20px;
  top: 20px;
  width: 320px;
  height: 320px;
  overflow: scroll;
}

#view .renderable-vertical_ruler {
  position: absolute;
  left: 0px;
  top: 19px;
  height: 308px;
}

#view .renderable-horizontal_ruler {
  position: absolute;
  left: 19px;
  top: 0px;
  width: 320px;
}

#view .canvas {
  margin: 0 0;
  padding: 0 0;
  background-color: #eef;
  position: relative;
  width: 2000px;
  height: 2000px;
  overflow: hidden;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  -o-user-select: none;
  user-select: none;
}

.canvas .component-text {
  position: absolute;
  border: 1px solid black;
  background-color: #ffe;
  overflow: hidden;
  /* cursor: pointer; */
}

.canvas .component-horizontal_guide,
.canvas .component-vertical_guide {
  position: absolute;
  border: 1px rgba(0, 0, 0, .5);
}

.canvas .component-horizontal_guide {
  border-top-style: solid;
  /* cursor: crosshair; */
}

.canvas .component-vertical_guide {
  border-left-style: solid;
  /* cursor: crosshair; */
}

.component-resize_box {
    position: absolute;
    margin: -1px -1px;
    padding: 0 0;
    border: 1px solid #cccccc;
    z-index: 101;
    opacity: 0.5;
}

.component-resize_box .corner {
    position: absolute;
    background: white;
    width: 5px;
    height: 5px;
    padding: 0 0;
    margin: 0 0;
    border: 1px solid #000000;
    z-index: 102;
}

.component-resize_box .corner .ui-icon {
    margin-left: -4px;
    margin-top: -4px;
}

.component-resize_box .nw {
    left: -4px;
    top: -4px;
    cursor: nw-resize;
}

.component-resize_box .sw {
    left: -4px;
    bottom: -4px;
    cursor: sw-resize;
}

.component-resize_box .ne {
    right: -4px;
    top: -4px;
    cursor: ne-resize;
}

.component-resize_box .se {
    right: -4px;
    bottom: -4px;
    cursor: se-resize;
}

  </style>
  <div>
    <div class="toolbar ui-widget-header">
      <span class="ui-button-set toolbar-function">
        <span class="toggle-button"><input class="ui-action-function ui-button ui-no-text ui-icon-arrow-1-ne" type="radio" name="function" value="cursor" id="toolbar-function-cursor" checked="checked" /><label for="toolbar-function-cursor">Cursor</label></span>
        <span class="toggle-button"><input class="ui-action-function ui-button ui-no-text ui-icon-arrow-4" type="radio" name="function" value="move" id="toolbar-function-move" /><label for="toolbar-function-move">Move</label></span>
        <span class="toggle-button"><input class="ui-action-function ui-button ui-no-text ui-icon-pencil" type="radio" name="function" value="text" id="toolbar-function-text" /><label for="toolbar-function-text">Text</label></span>
        <span class="toggle-button"><input class="ui-action-function ui-button ui-no-text ui-icon-image" type="radio" name="function" value="image" id="toolbar-function-image" /><label for="toolbar-function-image">Image</label></span>
      </span>
      <button class="ui-button ui-action-zoom_in ui-icon-zoomin ui-no-text" id="toolbar-function-zoom_in">Zoom-in</button>
      <button class="ui-button ui-action-zoom_out ui-icon-zoomout ui-no-text" id="toolbar-function-zoom_out">Zoom-out</button>
    </div>
    <div id="view" class="view">
      <div class="renderable-vertical_ruler"></div>
      <div class="renderable-horizontal_ruler"></div>
      <div class="viewport">
        <div class="canvas">
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    $('.ui-button').each(function(i, n) {
      n = $(n);
      var params = {};
      var rex = /ui-icon-\S+/, g;
      if ((g = rex.exec(n.attr('class')))) {
        params['icons'] = { primary: g[0] };
      }
      if (n.hasClass('ui-no-text')) {
        params['text'] = false;
      }
      n.button(params);
    });
    $('.ui-button-set').buttonset();
  </script>
  <script type="text/javascript">
  if (!window.console) console = { log: function() {} };
  var TicketDesigner_adjustViewSize = function() {};
  (function() {
    var canvasNode = $('#view .canvas')
    var viewportNode = $('#view .viewport');
    var td = new TicketDesigner(
      new views.rendering.js.dom.JSDOMView(canvasNode, viewportNode)
    );
    $('#view .renderable-horizontal_ruler').replaceWith(td.horizontalRuler.renderer.n);
    $('#view .renderable-vertical_ruler').replaceWith(td.verticalRuler.renderer.n);

    function getBodyClientSize() {
      var firstChildNode = $("body > :first").get(0);
      return {
        width: document.documentElement.clientWidth - firstChildNode.offsetLeft * 2,
        height: document.documentElement.clientHeight - firstChildNode.offsetTop * 2
      };
    }

    TicketDesigner_adjustViewSize = function adjustViewSize() {
      var n = $("#view");
      var size = { width: n.innerWidth(), height: n.innerHeight() };
      var margin = { x: td.verticalRuler.renderer.n.outerWidth(), y: td.horizontalRuler.renderer.n.outerHeight() };
      td.view.get_viewport().n
        .css({ width: (size.width - margin.x) + "px",
               height: (size.height - margin.y) + "px" });
      td.horizontalRuler.renderer.n
        .css({ width: (size.width - margin.x) + "px" });
      td.verticalRuler.renderer.n
        .css({ height: (size.height - margin.y) + "px" });
      td.refresh();
    };

    // $(window).resize(adjustViewSize);
    $('.ui-action-zoom_in').click(function() {
      td.shell.zoomIn();
    });
    $('.ui-action-zoom_out').click(function() {
      td.shell.zoomOut();
    });

    function toggleToolbarButton(item) {
      $(".ui-action-function[value='" + item + "']")[0].checked = true;
    }

    td.shell.operationModeCallback = function operationModeCallback(operationMode) {
      switch (operationMode[0]) {
      case 'CURSOR':
        toggleToolbarButton('cursor');
        break;
      case 'MOVE':
        toggleToolbarButton('move');
        break;
      case 'PLACE':
        if (operationMode[2] == views.TextComponent)
          toggleToolbarButton('text');
        else if (operationMode[2] == views.TextComponent)
          toggleToolbarButton('text');
        break;
      }
    }

    function selectFunction(f) {
      switch (f) {
      case 'cursor':
        td.shell.set_operationMode(OperationMode.CURSOR);
        break;
      case 'move':
        td.shell.set_operationMode(OperationMode.MOVE);
        break;
      case 'text':
        td.shell.set_operationMode(OperationMode.PLACE(views.TextComponent));
        break;
      case 'image':
        td.shell.set_operationMode(OperationMode.PLACE(views.TextComponent));
        break;
      }
    }

    $('.ui-action-function').click(function() {
      selectFunction(this.value);
    }).each(function(i, n) {
      if (n.checked)
        selectFunction(n.value);
    });
    td.refresh();
  })();
  </script>


