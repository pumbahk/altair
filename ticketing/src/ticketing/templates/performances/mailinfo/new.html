<%inherit file="/layout_2cols.html" />
<%namespace file="/common/helpers.html" name="ch" />

<style type="text/css">
  .controls select{width: 80%;}
  .controls input{width: 80%;}
  .controls textarea{width: 80%; min-height:100px;}
  .controls table{width: 95%;}
</style>

<%block name="breadcrumbs">
${ch.breadcrumbs(
    names=[u'イベント', performance.event.title, u'パフォーマンス', performance.name, u"メール付加情報"] ,
    urls=[
      request.route_path('events.index'),
      request.route_path('events.show', event_id=performance.event.id),
      request.route_path('performances.index', event_id=performance.event.id),
      request.route_path('performances.show', performance_id=performance.id),
    ]
)}
</%block>

<div class="page-header">
  <h2>${mutil.get_mailtype_description()}付加情報 ${performance.name}</h2>
  <span class="label">取引先<a href="${request.route_path("organizations.mails.new", organization_id=performance.event.organization.id, mailtype=mailtype)}">に移動</a></span> &gt;
  <span class="label">イベント<a href="${request.route_path("events.mailinfo.edit", event_id=performance.event.id, mailtype=mailtype)}">に移動</a></span> &gt;
  <span class="label label-warning">パフォーマンス</span>
</div>

<pre>
メールの付加情報は以下のようにして取得されます
  1. 購入されたチケットの公演(パフォーマンス)に紐づく設定を取得。
  2. 購入されたチケットの公演が所属しているイベントに紐づく設定を取得。
  3. 購入されたチケットの公演が所属しているイベントが所属している取引先に紐づく設定を取得。
</pre>

<div class="btn-group" style="margin-bottom:20px;">
  <a class="btn btn-info" href="#PreviewModal" data-toggle="modal"><i class="icon-eye-open"></i> preview</a>
</div>

<ul class="nav nav-tabs">
  %for i, label in choices:
    %if unicode(mailtype) == unicode(i):
  <li class="active"><a href="#">${label}</a></li>
    %else:
  <li><a href="${request.current_route_path(organization_id=organization.id, mailtype=i)}">${label}</a></li>
    %endif
  %endfor
</ul>

<div class="well">
  <form id="submitForm" class="form-horizontal" action="#" method="POST">
	<fieldset>
	  %for field in form:
	  <div class="${field.description}">
	    ${form_item(field)}
	  </div>
	  %endfor
	</fieldset>
	<div class="form-actions">
	  <input class="btn btn-primary" type="submit" name="submit" value="登録">
	</div>
  </form>
</div>

<div class="modal hide" id="PreviewModal">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h3>メールpreview</h3>
  </div>

  <form class="inline" action="${request.route_path("mails.preview.performance", performance_id=performance.id, mailtype=mailtype)}" method="GET"  target="_blank">
  <div class="modal-body">
	${choice_form["payment_methods"].label} ${choice_form["payment_methods"]}
	${choice_form["delivery_methods"].label} ${choice_form["delivery_methods"]}
  </div>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">キャンセル</a>
    <button type="submit" class="btn">preview</button>
  </div>
  </form>
</div>

<script type="text/javascript">
  $(function(){$('.modal button[type="submit"]').click(function(e){$(e.currentTarget).parents('.modal').data('modal').toggle(); return true;});});
</script>
