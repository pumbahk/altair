<%namespace file="/common/helpers.html" import="seat_style" />

<style>
  .swatch {
    display: inline-block;
    width: 30px;
    height: 20px;
    margin: -6px 2px;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
  }
</style>

<script type="text/javascript">
  function add_stock_holder() {
    $('#modal-new-stock-group-own').modal('toggle');
    $('#modal-new-stock-group-own #edit').attr('action', '/events/performances/stock_holder/' + ${performance.id} + '/new');
  }

  $('#modal-edit').on('hidden', function () {
    // do something…
  })

  $(window).resize(function(api){
    $("#seat-map").height($(window).height()-230);
    $("#allocated-list").height($(window).height()-230);
  });

  $(document).ready(function(){
    $("#seat-map").height($(window).height()-230);
    $("#allocated-list").height($(window).height()-230);
  });
</script>

<div class="tabbable tabs-below tabs-above" id="seat-allocation-tab">
  <div class="tab-content"  id="seat-allocation-tab-content">
    <div class="tab-pane active" id="map">
      <div class="container-fluid">
        <div class="row-fluid">
          <div class="span8" style="background-color: #999999">
            <div style="width:100%;  margin: 0 0 0 5px;" id="seat-map"></div>
          </div>
          <div class="span4">
            <ul class="nav nav-pills">
              <li class="dropdown" id="menu1">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#menu1">
                  枠/押さえ
                  <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                  <li><a data-toggle="modal" href="javascript:add_stock_holder()" >新規配券先</a></li>
                </ul>
              </li>
              <li class="dropdown" id="menu2">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#menu2">
                  配券
                  <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                  <li class="divider"></li>
                  <li><a data-toggle="modal" href="#modal-new-stock-group-send" >返券</a></li>
                  <li><a data-toggle="modal" href="#modal-new-stock-group-send" >追券</a></li>
                </ul>
              </li>
              </li>
              <li class="dropdown" id="report">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#report">
                  明細
                  <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                  <li><a data-toggle="modal" href="#modal-report" >座席明細（すべて）</a></li>
                  <li><a data-toggle="modal" href="#modal-report" >配券明細（すべて）</a></li>
                  <li class="divider"></li>
                  <li><a data-toggle="modal" href="#modal-report" >座席明細（選択）</a></li>
                  <li><a data-toggle="modal" href="#modal-report" >配券明細（選択）</a></li>
                </ul>
              </li>
            </ul>

            % for account in performance.accounts:
            <table class="table table-striped table-bordered table-condensed">
              <h4>${account.name}</h4>
              <tbody>
              % for stock_holder in performance.stock_holders:
                % if stock_holder.account.user.id == account.user.id:
                  <tr>
                    <th style="width:10px" rowspan="${len(stock_holder.stocks)}"><input type="checkbox"></th>
                    <th class="span2" rowspan="${len(stock_holder.stocks)}">${seat_style(stock_holder.style)}${stock_holder.name}</th>
                  % if len(stock_holder.stocks) == 0:
                    <th style="width:80px"></th>
                    <td class="span1"></td>
                  % endif
                  % for i, stock in enumerate(stock_holder.stocks):
                    % if i != 0:
                  <tr>
                    % endif
                    <th style="width:80px">
                      ${seat_style(stock.seat_type.style)}${stock.seat_type.name}
                    </th>
                    <td class="span1">${stock.quantity}席</td>
                  </tr>
                  % endfor
                % endif
              % endfor
              <tbody>
            </table>
            % endfor

          </div>
        </div>
      </div>
    </div>
  </div>

  <ul class="nav nav-tabs"id="seat-allocation-tab-content-navi">
    <li class="active"><a href="#map" data-toggle="tab">会場図</a></li>
    <li><a href="#detail" data-toggle="tab">詳細</a></li>
  </ul>
</div>

<div class="modal fade" id="modal-new-stock-group-own">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>新規配券先</h3>
  </div>

  <form id="edit" action="" method="POST">
    <div class="modal-body">
      <label>枠名</label>
      <input id="name" name="name" type="text" class="span3" placeholder="先行">
      <label>配券先</label>
      <select name="account_id">
        % for account in accounts:
        <option value="${account.id}">${account.name}</option>
        % endfor
      </select>

      <label>記号</label>
      <input id="text" name="text" type="text" class="span3" value="">
      <label>記号色</label>
      <input id="text_color" name="text_color" type="text" class="kolorPicker span3" value="">
      <label>塗りつぶし色</label>
      <input id="fill_color" name="fill_color" type="text" class="kolorPicker span3" value="">
      <label>塗りつぶしパターン</label>
      <div class="controls">
        <select name="fill_type">
          <option value="FloodFill">べた塗り</option>
          <option value="LinearGradientFill">グラデーション（線形）</option>
          <option value="RadialGradientFill">グラデーション（放射状）</option>
          <option value="ImageTileFill">画像パターン</option>
        </select>
      </div>
      <label>塗りつぶしイメージ</label>
      <input id="fill_image" name="fill_image" type="text" class="span3" value="">
      <label>線の色</label>
      <input id="stroke_color" name="stroke_color" type="text" class="kolorPicker span3"value="">
      <label>線の太さ</label>
      <div class="controls">
        <select name="stroke_width">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
        </select>
      </div>
      <label class="control-label">線の種類</label>
      <div class="controls">
        <select name="stroke_patten">
          <option value="solid">実線</option>
          <option value="double">2重線</option>
          <option value="dashed">点線</option>
        </select>
      </div>
    </div>

    <div class="modal-footer">
      <a href="#" class="btn" data-dismiss="modal">閉じる</a>
      <input class="btn" type="submit" value="保存"></a>
    </div>
  </form>
</div>

<div class="modal fade" id="modal-new-stock-group-send">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>新規配券先</h3>
  </div>

  <div class="modal-body">
    <label>ラベル</label>
    <input type="text" class="span3" placeholder="ラベル">
    <label>配券先</label>
    <select>
      % for account in accounts:
      <option id="${account.id}">${account.name}</option>
      % endfor
    </select>
  </div>

  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">閉じる</a>
    <a href="#" class="btn btn-primary">保存</a>
  </div>
</div>

<div class="modal fade" id="modal-report">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>帳票</h3>
  </div>

  <div class="modal-body">
    <label class="control-label">帳票の出力タイプを選択</label>
    <div class="controls">
      <label class="radio">
        <input type="radio" name="optionsRadios" id="optionsRadios1" value="option1" checked>
        Excel
      </label>
      <label class="radio">
        <input type="radio" name="optionsRadios" id="optionsRadios2" value="option2">
        Csv
      </label>
      <label class="radio">
        <input type="radio" name="optionsRadios" id="optionsRadios3" value="option2">
        PDF
      </label>
    </div>
  </div>

  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">閉じる</a>
    <a href="#" class="btn btn-primary">出力</a>
  </div>
</div>