<%inherit file="../layout.html" />
<%namespace file="/common/helpers.html" import="validate_errors" />
<%namespace file="/common/helpers.html" import="alert_message" />
<%namespace file="/common/helpers.html" import="flash_messages" />
<%namespace file="/common/helpers.html" import="form_item" />
<%namespace file="/common/helpers.html" import="breadcrumbs" />

<%
  if request.matched_route.name == 'performances.edit':
    route_name = u'編集'
    route_path = request.route_path('performances.edit', performance_id=performance.id)
  else:
    route_name = u'登録'
    route_path = request.route_path('performances.new', event_id=event.id)
%>

<script type="text/javascript">
  $(function() {
    $('#start_on').datetimepicker({dateFormat:'yy-mm-dd', timeFormat:'hh:mm'});
    $('#end_on').datetimepicker({dateFormat:'yy-mm-dd', timeFormat:'hh:mm'});
    $('#open_on').datetimepicker({dateFormat:'yy-mm-dd', timeFormat:'hh:mm'});
    $('#open_on').focusout(function(){
      $('#code').val('${event.code}' + $(this).val().replace(/([0-9]{4})-([0-9]{2})-([0-9]{2}) ([0-9]{2}):([0-9]{2})/g, '$2$3$4'));
    });
  });
</script>

<div class="row-fluid">
  <%include file="../parts/_menu.html" />

  <div class="span10">
    ${breadcrumbs(
        names=[u'イベント', event.title, u'パフォーマンス', route_name],
        urls=[
          request.route_path('events.index'),
          request.route_path('events.show', event_id=event.id),
          request.route_path('performances.index', event_id=event.id),
        ]
    )}
  </div>

  <span class="span10">
    <div class="page-header">
      <h3>パフォーマンス${route_name}</h3>
    </div>

    <div class="content">
      ${flash_messages(request)}
      ${alert_message(form)}
    </div>

    <div class="well">
      <form class="form-horizontal" action="${route_path}" method="POST">
        <fieldset>
          ${form_item(form.name, option={'class':'span8', 'maxlength':255})}
          ${form_item(form.open_on)}
          ${form_item(form.start_on)}
          ${form_item(form.end_on)}
          ${form_item(form.code, option={'class':'span3', 'maxlength':12, 'placeholder':event.code})}
          ${form_item(form.venue_id, option={'class':'span6'})}
        </fieldset>
        <div class="form-actions">
          <input class="btn btn-primary" type="submit" name="submit" value="${route_name}">
        </div>
      </form>
    </div>
  </span>
</div>
