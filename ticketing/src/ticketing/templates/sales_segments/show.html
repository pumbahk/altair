<%inherit file="/layout.html"/>
<%namespace file="/common/helpers.html" import="pager"/>                                               
<%namespace file="/common/helpers.html" import="flash_messages" />
<%namespace file="/common/helpers.html" import="safe_strftime" />

<script type="text/javascript">
  $(function() {
    $('#start_at').datetimepicker({dateFormat:'yy-mm-dd', timeFormat:'hh:mm'});
    $('#end_at').datetimepicker({dateFormat:'yy-mm-dd', timeFormat:'hh:mm'});
    $('#edit-pdmp').click(function(){
      $(location).attr('href', '/events/payment_delivery_method_pair/edit/' + $('input[name=checked_id]:checked').val());
    });
  });

  function delete_pdmp() {
    $('#delete-modal').modal('toggle');
    $('#delete-modal #delete').attr('href', '/events/payment_delivery_method_pair/delete/' + $('input[name=checked_id]:checked').val());
  }
</script>

<div class="row-fluid">
  <%include file="/parts/_menu.html" args="event=sales_segment.event" />

  <span class="span10">
    <div class="page-header">
      <h3>販売区分</h3>
    </div>

    <div class="content">
      ${flash_messages(request)}
    </div>

    <table class="table table-striped table-bordered table-condensed">
      <input type="hidden" name="sales_segment_id" value="${sales_segment.id}" />
      <tr>
        <th class="span3">${form_ss.name.label.text}</th>
        <td>${sales_segment.name}</td>
      </tr>
      <tr>
        <th>${form_ss.start_at.label.text}</th>
        <td>${safe_strftime(sales_segment.start_at)}</td>
      </tr>
      <tr>
        <th>${form_ss.end_at.label.text}</th>
        <td>${safe_strftime(sales_segment.end_at)}</td>
      </tr>
    </table>
    <%include file="/sales_segments/_action_button.html" args="event=sales_segment.event, form=form_ss" />

    <hr />

    <table class="table table-striped table-bordered table-condensed">
      <tr>
        <th></th>
        <th>${form_pdmp.payment_method_ids.label.text}</th>
        <th>${form_pdmp.delivery_method_ids.label.text}</th>
        <th>${form_pdmp.transaction_fee.label.text}</th>
        <th>${form_pdmp.delivery_fee.label.text}</th>
        <th>${form_pdmp.discount.label.text}</th>
        <th>${form_pdmp.discount_unit.label.text}</th>
        <th>${form_pdmp.discount_type.label.text}</th>
      </tr>
      % for i, payment_delivery_method_pair in enumerate(sales_segment.payment_delivery_method_pair):
      <tr>
        <td><input name="checked_id" type="radio" value=${payment_delivery_method_pair.id} /></td>
        <td>${payment_delivery_method_pair.payment_method.name}</td>
        <td>${payment_delivery_method_pair.delivery_method.name}</td>
        <td>${payment_delivery_method_pair.transaction_fee}</td>
        <td>${payment_delivery_method_pair.delivery_fee}</td>
        <td>${payment_delivery_method_pair.discount}</td>
        <td>${payment_delivery_method_pair.discount_unit}</td>
        <td>${payment_delivery_method_pair.discount_type}</td>
      </tr>
      % endfor
    </table>
    <a href="${request.route_path('payment_delivery_method_pair.new', sales_segment_id=sales_segment.id)}" class="btn">
      <i class="icon-pencil"></i> 決済・配送方法を追加
    </a>
    <button class="btn">
      <a id="edit-pdmp"><i class="icon-pencil"></i> 編集</a>
    </button>
    <a href="javascript:delete_pdmp()" class="btn">
      <i class="icon-minus"></i> 削除
    </a>
  </span>
</div>
