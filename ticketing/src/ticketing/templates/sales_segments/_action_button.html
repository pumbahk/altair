<%page args="event, form" />
<%namespace file="/common/helpers.html" import="form_item" />
<%namespace file="/common/modal.html" import="delete_modal" />

<script type="text/javascript">
  $(function() {
    $('#start_at').datetimepicker({dateFormat:'yy-mm-dd', timeFormat:'hh:mm'});
    $('#end_at').datetimepicker({dateFormat:'yy-mm-dd', timeFormat:'hh:mm'});
  });
  function get_sales_segment_id() {
    return $('input[name=sales_segment_id]:checked').val() || $('#sales_segment_id').val();
  }
  function show_sales_segment() {
    var id = get_sales_segment_id();
    if (!id) return;
    $(location).attr('href', '/events/sales_segments/show/' + id);
  }
  function new_sales_segment() {
    $('#modal-edit-sales_segment #edit').attr('action', '/events/${event.id}/sales_segments/new');
    $('#modal-edit-sales_segment').modal('toggle');
  }
  function edit_sales_segment() {
    var id = get_sales_segment_id();
    if (!id) return;
    $('#modal-edit-sales_segment #edit').attr('action', '/events/sales_segments/edit/' + id);
    $('#modal-edit-sales_segment').modal('toggle');
  }
  function delete_sales_segment() {
    var id = get_sales_segment_id();
    if (!id) return;
    $('#modal-delete #delete').attr('href', '/events/sales_segments/delete/' + id);
    $('#modal-delete #message').text("${u'選択した販売区分を削除します。よろしいですか？'}");
    $('#modal-delete').modal('toggle');
  }
</script>

<div class="btn-group">
  <a href="javascript:new_sales_segment()" class="btn">
    <i class="icon-pencil"></i> 新規
  </a>
  <button class="btn dropdown-toggle" data-toggle="dropdown">
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li>
      <a href="javascript:show_sales_segment()">
        <i class="icon-th-list"></i> 詳細
      </a>
    </li>
    <li>
      <a href="javascript:edit_sales_segment()">
        <i class="icon-pencil"></i> 編集
      </a>
    </li>
    <li>
      <a href="javascript:delete_sales_segment()" data-controls-modal="delete-modal" data-backdrop="true" data-keyboard="true">
        <i class="icon-minus"></i> 削除
      </a>
    </li>
  </ul>
</div>

<div class="modal fade" id="modal-edit-sales_segment">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>販売方法の編集</h3>
  </div>

  <form id="edit" action="" method="POST">
    <div class="modal-body">
      ${form_item(form.name)}
      ${form_item(form.start_at)}
      ${form_item(form.end_at)}
    </div>

    <div class="modal-footer">
      <a href="#" class="btn" data-dismiss="modal">閉じる</a>
      <input class="btn" type="submit" value="保存"></a>
    </div>
  </form>
</div>

${delete_modal()}
