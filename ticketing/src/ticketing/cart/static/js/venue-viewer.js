(function(){var a={};a.F30NHJ2336J_VQY1=function(a){return function(){a.eventKey=function(b){var c,d;return b!=null?(keycode=b.which,d=typeof b.modifiers=="undefined"?b.ctrlKey:b.modifiers&Event.CONTROL_MASK,c=typeof b.modifiers=="undefined"?b.shiftKey:b.modifiers&Event.SHIFT_MASK):(keycode=event.keyCode,d=event.ctrlKey,c=event.shiftKey),keychar=String.fromCharCode(keycode).toUpperCase(),{ctrl:!!d||keycode===17,shift:!!c||keycode===16,keycode:keycode,keychar:keychar}},a.convertToFashionStyle=function(b,c){var d=function(a){switch(a.type){case"flood":default:return c?new Fashion.LinearGradientFill([[0,new Fashion.Color("#fff")],[1,new Fashion.Color(a.color||"#fff")]],.125):a.color?new Fashion.FloodFill(new Fashion.Color(a.color)):null;case"linear":return new Fashion.LinearGradientFill(_map(a.colors,function(a){return new Fashion.Color(a)}),a.angle);case"radial":return new Fashion.LinearGradientFill(_map(a.colors,function(a){return new Fashion.Color(a)}),a.focus);case"tile":return new Fashion.ImageTileFill(a.imageData)}return null},e=function(a){return new Fashion.Stroke([b.stroke.color||"#000",b.stroke.width?b.stroke.width:1,b.stroke.pattern||"solid"].join(" "))};return{fill:b.fill?d(b.fill):null,stroke:b.stroke?e(b.stroke):null}},a.convertFromFashionStyle=function(a){return{text:null,text_color:null,fill:a.fill instanceof Fashion.FloodFill?{type:"flood",color:a.fill.color._toString()}:a.fill instanceof Fashion.LinearGradientFill?{type:"linear",colors:_map(a.fill.colors,function(a){return a._toString()}),angle:a.fill.angle}:a.fill instanceof Fashion.RadialGradientFill?{type:"radial",colors:_map(a.fill.colors,function(a){return a._toString()}),focus:a.fill.focus}:a.fill instanceof Fashion.ImageTileFill?{type:"tile",imageData:a.imageData}:null,stroke:a.stroke?{color:a.stroke.color._toString(),width:a.stroke.width,pattern:a.stroke.pattern}:null}},a.allAttributes=function(b){var c={},d=b.attributes;for(var e=0,f=d.length;e<f;e++){var g=d[e];c[g.namespaceURI?"{"+g.namespaceURI+"}"+g.nodeName.replace(/^[^:]*:/,""):g.nodeName]=g.nodeValue}return c},a.makeHitTester=function(b){var c=b.position(),d=b.size(),e={x:c.x+d.x,y:c.y+d.y};return b.transform()&&(c=b.transform().apply(c),e=b.transform().apply(e)),function(a){var b=a.position(),d=a.size(),f={x:b.x+d.x,y:b.y+d.y};return a.transform()&&(b=a.transform().apply(b),f=a.transform().apply(f)),(c.x<b.x&&b.x<e.x||c.x<f.x&&f.x<e.x||b.x<c.x&&e.x<f.x)&&(c.y<b.y&&b.y<e.y||c.y<f.y&&f.y<e.y||b.y<c.y&&e.y<f.y)}}}(),a}({}),a.rYQ7TBB4IREFPGHX=function(a){return function(){a.DEFAULT={ZOOM_RATIO:.8,STYLES:{label:{fill:new Fashion.Color("#000"),stroke:null},seat:{fill:new Fashion.Color("#fff"),stroke:new Fashion.Color("#000")},glayout:{fill:new Fashion.FloodFill(new Fashion.Color("#ccc")),stroke:new Fashion.Stroke(new Fashion.Color("#999"),2)}},MASK_STYLE:{fill:new Fashion.FloodFill(new Fashion.Color("#0064ff80")),stroke:new Fashion.Stroke(new Fashion.Color("#0080FF"),2)},SEAT_STYLE:{text_color:"#000",fill:{color:"#fff"}},OVERLAYS:{highlighted:{fill:null,stroke:{color:"#F63",width:3,pattern:"solid"}},highlighted_block:{fill:null,stroke:{color:"#F44",width:5,pattern:"solid"}}},AUGMENTED_STYLE:{selected:{text_color:"#FFF",fill:{color:"#009BE1"},stroke:{color:"#FFF",width:3}},unselectable:{text_color:"#888",fill:{color:"#eee"},stroke:{color:"#ccc"}}}}}(),a}({}),a.o4HA4D34OPL2BBZW=function(b){return function(){function e(a){return $.extend({},a)}function f(a,b){return{text:(b.text?b.text:a.text)||null,text_color:(b.text_color?b.text_color:a.text_color)||null,fill:(b.fill?b.fill:a.fill)||null,stroke:(b.stroke?b.stroke:a.stroke)||null}}function g(a){return a instanceof Fashion.Path?new Fashion.Path({points:a.points(),style:a.style(),transform:a.transform()}):a instanceof Fashion.Rect?new Fashion.Rect({position:a.position(),size:a.size(),transform:a.transform()}):null}var c=a.F30NHJ2336J_VQY1,d=a.rYQ7TBB4IREFPGHX,h=b.Seat=function(){this.id=null,this.editor=null,this.type=null,this.floor=null,this.gate=null,this.block=null,this.events={},this._styleTypes=[],this.mata=null,this.shape=null,this.originalStyle=null,this._highlightedSeats=[],this._selected=!1,this.label=null,this._overlays={},this.init.apply(this,arguments)};h.prototype.init=function(b,c,d,e){var f=this;this.id=b,this.parent=d,this.meta=c,this.type=this.parent.stockTypes[c.stock_type_id],this.originalStyle=this.defaultStyle();if(e)for(var g in e)(function(a){f.events[a]=function(b){if(f.parent.dragging||f.parent.animating)return;e[a].apply(f,arguments)}}).call(this,g);this.refresh()},h.prototype.defaultStyle=function(){var b=d.DEFAULT.SEAT_STYLE;return this.shape&&(b=f(b,c.convertFromFashionStyle(this.shape.style()))),this.type&&(b=f(b,this.type.style)),b},h.prototype.attach=function(b){this.shape||(this.shape=b,this.originalStyle=this.defaultStyle(),this.refresh(),b.addEvent(this.events))},h.prototype.detach=function(b){this.shape&&this.shape.removeEvent()},h.prototype.stylize=function(){if(!this.shape)return;var b=this.originalStyle;for(var e=0;e<this._styleTypes.length;e++){var g=this._styleTypes[e];b=f(b,d.DEFAULT.AUGMENTED_STYLE[g])}this.shape.style(c.convertToFashionStyle(b));if(b.text)if(!this.label){var h=this.shape.position(),i=this.shape.size();this.label=this.parent.drawable.draw(new Fashion.Text({position:{x:h.x,y:h.y+i.y*.75},fontSize:i.y*.75,text:b.text,style:{fill:new Fashion.FloodFill(new Fashion.Color(b.text_color))}})),this.label.addEvent(this.events)}else this.label.text(b.text),this.label.style({fill:new Fashion.FloodFill(new Fashion.Color(b.text_color))});else this.label&&(this.parent.drawable.erase(this.label),this.label=null)},h.prototype.addOverlay=function(b){if(!(b in this._overlays)){var e=g(this.shape);e.style(c.convertToFashionStyle(d.DEFAULT.OVERLAYS[b])),this._overlays[b]=e,this.parent.drawable.draw(e)}},h.prototype.removeOverlay=function(b){var c=this._overlays[b];c!==void 0&&(this.parent.drawable.erase(c),delete this._overlays[b])},h.prototype.addStyleType=function(b){this._styleTypes.push(b),this.stylize()},h.prototype.removeStyleType=function(b){for(var c=0;c<this._styleTypes.length;)this._styleTypes[c]==b?this._styleTypes.splice(c,1):c++;this.stylize()},h.prototype.refreshDynamicStyle=function(){this.selectable()?this.removeStyleType("unselectable"):this.addStyleType("unselectable")},h.prototype.refresh=function(){this.refreshDynamicStyle(),this.stylize()},h.prototype.__selected=function(){this.addStyleType("selected"),this._selected=!0},h.prototype.__unselected=function(){this.removeStyleType("selected"),this._selected=!1},h.prototype.selected=function(b){return b!==void 0&&this.parent._select(this,b),this._selected},h.prototype.selectable=function(){return!this.parent.callbacks.selectable||this.parent.callbacks.selectable(this.parent,this)};var i=b.SeatAdjacencies=function(b){this.tbl=[],this.src=b.dataSource.seatAdjacencies,this.availableAdjacencies=b.availableAdjacencies,this.callbacks=b.callbacks};i.prototype.getCandidates=function(b,c,d,e){if(c==1)return d([[b]]);var f=this.tbl[c];if(f!==void 0){d(f[b]||[]);return}this.callbacks.loadstart&&this.callbacks.loadstart("seatAdjacencies");var g=this;this.src(function(a){var h;if(a===void 0||(h=a[c])===void 0){e("Invalid adjacency data");return}f=g.tbl[c]=g.convertToTable(c,h),d(f[b]||[])},e,c)},i.prototype.convertToTable=function(b,c){var d={};for(var e=0,f=c.length;e<f;e++){c[e]=c[e].sort();for(var g=0;g<b;g++){var h=c[e][g];d[h]||(d[h]=[]),d[h].push(c[e])}}for(var e in d)d[e].sort().reverse();return d}}(),b}({}),function(b){function c(a){var b;return a===null||a===void 0||(b=typeof a)==="number"||b==="string"||b==="boolean"||a.valueOf!==Object.prototype.valueOf&&!(a instanceof Date)}function d(a,b){if(c(a))return a;var e,f;if(a instanceof Date){e=new Date(a.getTime());if(b instanceof Date)for(f in b)b.hasOwnProperty(f)&&(e[f]=d(b[f],e[f]))}else if(typeof a=="function"){e=function(){return a.apply(this,arguments)};if(typeof b=="function")for(f in b)b.hasOwnProperty(f)&&(e[f]=d(b[f],e[f]))}else e=!c(b)&&typeof b!="function"?b:new a.constructor;for(f in a)a.hasOwnProperty(f)&&(e[f]=d(a[f],e[f]));return e}function e(a,b){var c=parseInt(a,b);if(isNaN(c))throw new ValueError("Invalid numeric string: "+a);return c}function f(a,b){var c="";while(b)b&1&&(c+=a),a+=a,b>>=1;return c}function g(a,b,c){return f(c,b-a.length)+a}function h(a,b,c){if(typeof BROWSER=="undefined")return;BROWSER.identifier=="ie"&&BROWSER.version<9?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)}function i(a,b,c){if(typeof BROWSER=="undefined")return;BROWSER.identifier=="ie"&&BROWSER.version<9?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)}function k(a,b,c){return Math.min(Math.max(a,b),c)}function l(a,b,c){return{x:k(a.x,b.x,c.x),y:k(a.y,b.y,c.y)}}function m(a,b){return{x:a.x+b.x,y:a.y+b.y}}function n(a,b){return{x:a.x-b.x,y:a.y-b.y}}function o(a,b,c){if(a instanceof Array&&"indexOf"in Array.prototype)return a.indexOf(b,c);for(var d=Math.max(c||0,0);d<a.length;d++)if(a[d]===b)return d;return-1}function r(a,b){function c(a){var b=typeof a.getAttributeNS=="function"?a.getAttributeNS("http://www.w3.org/1999/xlink","href"):a.getAttribute("xlink:href");b&&(typeof a.ownerDocument.getElementById=="function"?a=a.ownerDocument.getElementById(b.substring(1)):a=a.ownerDocument.selectSingleNode("*//*[@id='"+b.substring(1)+"']"));var c=a.childNodes,d=[];for(var e=0;e<c.length;e++){var f=c[e];if(f.nodeType!=1)continue;if(f.nodeName=="stop"){var g=q(f.getAttribute("style"));d.push([parseFloat(f.getAttribute("offset")),new Fashion.Color(g["stop-color"][0])])}}return d}var d=a.childNodes;for(var e=0;e<d.length;e++){var f=d[e];if(f.nodeType!=1)continue;var g=f.getAttribute("id");switch(f.nodeName){case"linearGradient":var h=parseFloat(f.getAttribute("x1")),i=parseFloat(f.getAttribute("y1")),j=parseFloat(f.getAttribute("x2")),k=parseFloat(f.getAttribute("y2")),l=Math.acos((j-h)/Math.sqrt(Math.pow(j-h,2)+Math.pow(k-i,2)))+(k-i<0?Math.PI:0);b[g]=new Fashion.LinearGradientFill(c(f),l/(Math.PI*2));break;case"radialGradient":b[g]=new Fashion.RadialGradientFill(c(f),{x:f.getAttribute("fx")||"50%",y:f.getAttribute("fy")||"50%"})}}}function s(a,b){return t(q(a),b)}function t(a,b){var c=null,d=a.fill,e=null,f=a["fill-opacity"],g=null,h=a.stroke,i=null,j=a["stroke-width"],k=null,l=a["stroke-opacity"],m=null,n=a["stroke-dasharray"],o=null,p=a["font-size"],q=null,r=a["text-anchor"];if(d){d instanceof Array&&(d=d[0]);if(d=="none")c=!1;else{var s=/url\(#([^)]*)\)/.exec(d);if(s){c=b[s[1]];if(!c)throw new Error}else c=new Fashion.Color(d)}}return f&&(f instanceof Array&&(f=f[0]),e=parseFloat(f)),h&&(h instanceof Array&&(h=h[0]),h=="none"?g=!1:g=new Fashion.Color(h)),j&&(j instanceof Array&&(j=j[0]),i=parseFloat(j)),l&&(l instanceof Array&&(l=l[0]),k=parseFloat(l)),n&&(n instanceof Array&&(n=n[0]),n.indexOf(",")!=-1&&(m=n.split(/,/))),p&&(p instanceof Array&&(p=p[0]),o=parseFloat(p)),r&&(r instanceof Array&&(r=r[0]),q=r),{fill:c,fillOpacity:e,stroke:g,strokeWidth:i,strokeOpacity:k,strokeDashArray:m,fontSize:o,textAnchor:q}}function u(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)b[d]!==null&&(c[d]=b[d]);return c}function v(a){return{fill:a.fill?a.fill instanceof Fashion.Color?new Fashion.FloodFill(a.fill.replace(null,null,null,a.fillOpacity?a.fillOpacity*255:255)):a.fill:null,stroke:a.stroke?new Fashion.Stroke(a.stroke.replace(null,null,null,a.fillOpacity?a.fillOpacity*255:255),a.strokeWidth?a.strokeWidth:1,a.strokeDashArray?a.strokeDashArray:a.strokePattern?a.strokePattern:null):null,visibility:!0}}function w(a){var b=a.childNodes;for(var c=0,d=b.length,e="";c<d;c++){var f=b[c],g=f.nodeName;g==="#text"?e+=f.nodeValue:e+=w(f)}return e}function x(a){return a instanceof Fashion.Rect?new Fashion.Rect({position:a.position(),size:a.size(),transform:a.transform()}):a instanceof Fashion.Path?new Fashion.Path({points:a.points(),transform:a.transform()}):null}function y(a,b){var c=new Array(a.length);for(var d=0;d<a.length;d++)c[d]=b(a[d]);return c}function z(a){var b=/\s*([A-Za-z_-][0-9A-Za-z_-]*)\s*\(\s*((?:[^\s,]+(?:\s*,\s*|\s+))*[^\s,]+)\s*\)\s*/.exec(a),c=b[1],d=b[2].replace(/(?:^\s+|\s+$)/,"").split(/\s*,\s*|\s+/);switch(c){case"matrix":if(d.length!=6)throw new Error("invalid number of arguments for matrix()");return new Fashion.Matrix(parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]),parseFloat(d[4]),parseFloat(d[5]));case"translate":if(d.length!=2)throw new Error("invalid number of arguments for translate()");return Fashion.Matrix.translate({x:parseFloat(d[0]),y:parseFloat(d[1])});case"scale":if(d.length!=2)throw new Error("invalid number of arguments for scale()");return new Fashion.Matrix(parseFloat(d[0]),0,0,parseFloat(d[1]),0,0);case"rotate":if(d.length!=1)throw new Error("invalid number of arguments for rotate()");return Fashion.Matrix.rotate(parseFloat(d[0])*Math.PI/180);case"skewX":if(d.length!=1)throw new Error("invalid number of arguments for skewX()");var e=parseFloat(d[0])*Math.PI/180,f=Math.tan(e);return new Fashion.Matrix(1,0,f,1,0,0);case"skewY":if(d.length!=1)throw new Error("invalid number of arguments for skewX()");var e=parseFloat(d[0])*Math.PI/180,f=Math.tan(e);return new Fashion.Matrix(1,f,0,1,0,0)}throw new Error("invalid transform function: "+c)}var j=function(){var a=new RegExp("[<>&'\"]"),b=["","&lt;","&gt;","&amp;","&apos;","&quot;",""];return function(c){return typeof c!="string"&&(c=c.toString()),c.replace(a,function(a){return b[special.source.indexOf(a)]})}}(),p=function(){function a(){return this.constructor.__super__.prototype}function b(b,c){b.__super__=c;var d=function(){};d.prototype=c.prototype,d.prototype.constructor=c,b.prototype=new d,b.prototype.__super__=a;var e=b["%%INIT_INSTANCE_ORIGIN_PROPS"];return b["%%INIT_INSTANCE_ORIGIN_PROPS"]=function(a){var b=c["%%INIT_INSTANCE_ORIGIN_PROPS"];b&&b(a),e(a)},b}function c(a,b,c){c.__class__=a,a.prototype[b]=c}function f(a,b){var c=b.prototype;for(var d in c)d=="init"?a.prototype["init%%"+b["%%CLASSNAME%%"]]=c[d]:d!=="__super__"&&d!=="constructor"&&(a.prototype[d]=c[d]);var e=a["%%INIT_INSTANCE_ORIGIN_PROPS"];a["%%INIT_INSTANCE_ORIGIN_PROPS"]=function(a){var c=b["%%INIT_INSTANCE_ORIGIN_PROPS"];c&&c(a),e(a)}}function g(a,b){for(var c in b.prototype)if(b.prototype.hasOwnProperty(c)&&!a.prototype.hasOwnProperty(c))throw new DeclarationError("The class '"+a["%%CLASSNAME%%"]+"' must provide property or method '"+c+"' imposed by '"+b["%%CLASSNAME%%"]+'".')}var e=function(){var a=0;return function(){var c="%%ANONYMOUS_CLASS_"+a+"%%";return++a,c}}();return function(h,i){var j,k,l,m,n,o,p,q={},r={},s={},t={},u=Object,v=[],w=[];for(k in i)switch(k){case"props":o=i[k];for(l in o)o.hasOwnProperty(l)&&(q[l]=o[l]);break;case"class_props":r=i[k];break;case"methods":s=i[k];break;case"class_methods":t=i[k];break;case"parent":u=i[k];break;case"interfaces":w=i[k];break;case"mixins":v=i[k];break;default:throw new ArgumentError("You gave '"+k+"' as definition, but the _class() excepts"+" only 'props','class_props','methods','class_methods','parent','interfaces','mixins'.")}j=function(b){j["%%INIT_INSTANCE_ORIGIN_PROPS"](this),this.init?this.init.apply(this,arguments):d(b,this)},j["%%INIT_INSTANCE_ORIGIN_PROPS"]=function(a){for(var b in q)a[b]=d(q[b])},b(j,u);for(l=0,m=v.length;l<m;l++)f(j,v[l]);for(k in s)s.hasOwnProperty(k)&&c(j,k,s[k]);j.prototype.constructor=j,j["%%CLASSNAME%%"]=h||e();for(k in t)j[k]=t[k];for(l=0,m=w.length;l<m;l++)g(j,w[l]);for(k in r)j[k]=r[k];return t.init&&t.init.call(j),j}}(),q=function(){function c(a){return a.replace(/(?:\\(0{0,2}d[89ab][0-9A-Fa-f]{2})(?:\r\n|[ \n\r\t\f])?)?\\([0-9A-Fa-f]{1,6})(?:\r\n|[ \n\r\t\f])?|\\([^\n\r\f0-9A-Fa-f])/g,function(a,b,c,d){if(b!==void 0){var e=parseInt(c,16);if(e<56320||e>57343)throw new ValueError("Invalid surrogate pair");return String.fromCharCode(((parseInt(b,16)&1023)<<10|e&1023)+65536)}if(c!==void 0)return String.fromCharCode(parseInt(c,16));if(d!==void 0)return d})}var a=/\s*(-?(?:[_a-z\u00a0-\u10ffff]|\\[^\n\r\f#])(?:[\-_A-Za-z\u00a0-\u10ffff]|\\[^\n\r\f])*)\s*:\s*((?:(?:(?:[^;\\ \n\r\t\f"']|\\[0-9A-Fa-f]{1,6}(?:\r\n|[ \n\r\t\f])?|\\[^\n\r\f0-9A-Fa-f])+|"(?:[^\n\r\f\\"]|\\(?:\n|\r\n|\r|\f)|\\[^\n\r\f])*"|'(?:[^\n\r\f\\']|\\(?:\n|\r\n|\r|\f)|\\[^\n\r\f])*')(?:\s+|(?=;|$)))+)(?:;|$)/g,b=/(?:((?:[^;\\ \n\r\t\f"']|\\[0-9A-Fa-f]{1,6}(?:\r\n|[ \n\r\t\f])?|\\[^\n\r\f0-9A-Fa-f])+)|"((?:[^\n\r\f\\"]|\\(?:\n|\r\n|\r|\f)|\\[^\n\r\f])*)"|'((?:[^\n\r\f\\']|\\(?:\n|\r\n|\r|\f)|\\[^\n\r\f])*)')(?:\s+|$)/g;return function(e){var f={},g=e.replace(a,function(a,d,g){var h=[],i=g.replace(b,function(a,b,d,e){return b!==void 0?h.push(c(b)):d!==void 0?h.push(c(d)):e!==void 0&&h.push(c(e)),""});if(i!="")throw new ValueError("Invalid CSS rule string: "+e);return f[d]=h,""});if(g!="")throw new ValueError("Invalid CSS rule string: "+e);return f}}(),A=a.rYQ7TBB4IREFPGHX,B=a.o4HA4D34OPL2BBZW,C=a.F30NHJ2336J_VQY1,D=p("StoreObject",{props:{store:{}},methods:{save:function(a,b){this.store[a]||(this.store[a]=b)},restore:function(a){var b=this.store[a];return delete this.store[a],b},clear:function(){for(var a in this.store)delete this.store[a]}}}),E=p("VenueViewer",{props:{canvas:null,callbacks:{uimodeselect:null,load:null,loadPartStart:null,loadPartEnd:null,loadAbort:null,click:null,selectable:null,select:null,pageChanging:null,message:null,messageBoard:null,zoomRatioChanging:null,zoomRatioChange:null},dataSource:null,zoomRatio:A.DEFAULT.ZOOM_RATIO,contentOriginPosition:{x:0,y:0},dragging:!1,startPos:{x:0,y:0},rubberBand:new Fashion.Rect({position:{x:0,y:0},size:{x:0,y:0}}),drawable:null,availableAdjacencies:[1],originalStyles:new D,overlayShapes:new D,shift:!1,keyEvents:null,uiMode:"select",shapes:null,link_pairs:null,seats:null,selection:{},selectionCount:0,highlighted:{},animating:!1,_adjacencyLength:1,currentPage:null,rootPage:null,_history:[],seatTitles:{},optionalViewportSize:null,loading:!1,loadAborted:!1,loadAbortionHandler:null,_smallTextsShown:!0,nextSingleClickAction:null,doubleClickTimeout:400,mouseUpHandler:null,onMouseUp:null,onMouseMove:null,deferSeatLoading:!1},methods:{init:function(c,d){this.canvas=c,this.stockTypes=null;if(d.callbacks)for(var e in this.callbacks)this.callbacks[e]=d.callbacks[e]||function(){};this.dataSource=d.dataSource,d.zoomRatio&&zoom(d.zoomRatio),this.rubberBand.style(A.DEFAULT.MASK_STYLE),c.empty(),this.optionalViewportSize=d.viewportSize,this.deferSeatLoading=!!d.deferSeatLoading;var f=this;this.mouseUpHandler=function(){f.onMouseUp&&f.onMouseUp.call(f)},b(document.body).bind("mouseup",this.mouseUpHandler),this.mouseMoveHandler=function(a){if(f.onMouseMove){var b=new Fashion.MouseEvt,c={x:a.pageX,y:a.pageY},d=Fashion._lib.subtractPoint(c,f.drawable.impl.getViewportOffset()),e=Fashion._lib.addPoint(f.drawable.impl.convertToPhysicalPoint(f.drawable.impl.scrollPosition()),d);return b.logicalPosition=f.drawable.impl.convertToLogicalPoint(e),f.onMouseMove.call(f,b),a.stopImmediatePropagation(),a.stopPropagation(),a.preventDefault(),!1}},b(document.body).bind("mousemove",this.mouseMoveHandler)},load:function(){this.loading=!0,this.seatAdjacencies=null;var b=this;b.callbacks.loadPartStart.call(b,b,"pages"),b.initBlocks(b.dataSource.pages,function(){b.loading=!1;if(b.loadAborted){b.loadAborted=!1,b.loadAbortionHandler&&b.loadAbortionHandler.call(b),b.callbacks.loadAbort&&b.callbacks.loadAbort.call(b,b);return}b.callbacks.loadPartEnd.call(b,b,"pages"),b.currentPage=b.rootPage,b.loading=!0,b.callbacks.loadPartStart.call(b,b,"stockTypes"),b.dataSource.stockTypes(function(a){b.loading=!1;if(b.loadAborted){b.loadAborted=!1,b.loadAbortionHandler&&b.loadAbortionHandler.call(b),b.callbacks.loadAbort&&b.callbacks.loadAbort.call(b,b);return}b.loading=!0,b.callbacks.loadPartEnd.call(b,b,"stockTypes"),b.stockTypes=a,b.callbacks.loadPartStart.call(b,b,"info"),b.dataSource.info(function(a){b.loading=!1;if(b.loadAborted){b.loadAborted=!1,b.loadAbortionHandler&&b.loadAbortionHandler.call(b),b.callbacks.loadAbort&&b.callbacks.loadAbort.call(b,b);return}b.loading=!0,b.callbacks.loadPartEnd.call(b,b,"info");if(!1 in a){b.callbacks.message.call(b,"Invalid data"),b.loading=!1;return}b.availableAdjacencies=a.available_adjacencies,b.seatAdjacencies=new B.SeatAdjacencies(b);var c;(function(){var a={drawing:!1,seats:!1};c=function(d){a[d]=!0;if(d=="drawing"&&a.seats)for(var e in b.seats){var f=b.shapes[e];f&&b.seats[e].attach(f)}}})(),b.currentPage?b.loadDrawing(b.currentPage,function(){c("drawing"),b.callbacks.load.call(b,b),b.zoomAndPan(b.zoomRatioMin,{x:0,y:0})}):b.callbacks.load.call(b,b),b.deferSeatLoading||b.loadSeats(function(){c("seats")})},b.callbacks.message)},b.callbacks.message)})},loadDrawing:function(a,b){var c=this;this.callbacks.loadPartStart.call(c,c,"drawing"),this.initDrawable(a,function(){c.callbacks.pageChanging.call(c,a),c.callbacks.loadPartEnd.call(c,c,"drawing"),b.call(c)})},cancelLoading:function(b){this.loading?(this.loadAborted=!0,this.loadAbortionHandler=b):b.call(this)},dispose:function(c){var d=this;this.cancelLoading(function(){b(document.body).unbind("mouseup",d.mouseUpHandler),d.removeKeyEvent(),d.drawable&&(d.drawable.dispose(),d.drawable=null),d.seats=null,d.selection=null,d.highlighted=null,d.availableAdjacencies=[1],d.shapes=null,d.small_texts=[],d.link_pairs=null,d.selection={},d.selectionCount=0,d.highlighted={},d.animating=!1,d._adjacencyLength=1,d.currentPage=null,d.rootPage=null,d._history=[],d.seatTitles={},c&&c.call(d)})},initDrawable:function(c,d){if(this.link_pairs)for(var e=this.link_pairs.length;--e>=0;)this.link_pairs[e][0].removeEvent();this.drawable&&this.drawable.dispose(),this.originalStyles.clear(),this.overlayShapes.clear(),this.currentPage=c;var f=this,g=function(){var a={},b=f.pages[c].focused_ids;if(b)for(var d=b.length;--d>=0;)a[b[d]]=!0;return a}(),h=function(b){return g[b]},i=this.dataSource.drawing(c);i(function(a){function M(a){var b=[];for(var c=f.link_pairs.length;--c>=0;){var d=f.link_pairs[c];d[1]==a&&b.push(d[0])}return b}f.loading=!1;if(f.loadAborted){f.loadAborted=!1,f.loadAbortionHandler&&f.loadAbortionHandler.call(f),f.callbacks.loadAbort&&f.callbacks.loadAbort.call(f,f);return}var c=C.allAttributes(a.documentElement),e=parseFloat(c.width),g=parseFloat(c.height),i=null;if(c.viewBox){var j=c.viewBox.split(/\s+/);i=new Array(j.length);for(var k=0;k<j.length;k++)i[k]=parseFloat(j[k])}var l=i||e||g?{x:i&&i[2]||e||g,y:i&&i[3]||g||e}:null,m=new Fashion.Drawable(f.canvas[0],{contentSize:l?{x:l.x,y:l.y}:null,viewportSize:f.optionalViewportSize}),n={},o=[],p=[],q=A.DEFAULT.STYLES,y=null,B=null;(function(b,c){a:for(var d=0;d<c.length;d++){var e=c[d];if(e.nodeType!=1)continue;var g=C.allAttributes(e),i=b.xlink,j=b.focused||g.id&&h(g.id),k=parseFloat(g.x),l=parseFloat(g.y),x=!isNaN(k)&&!isNaN(l)?{x:k,y:l}:b.position,A=g.transform?b.transform.multiply(z(g.transform)):b.transform,D=null,E=b.svgStyle;if(g["class"]){var F=q[g["class"]];F&&(E=u(E,F))}g.style&&(E=u(E,s(g.style,b.defs))),E=u(E,t(g));switch(e.nodeName){case"defs":r(e,b.defs);break;case"a":i=g["{http://www.w3.org/1999/xlink}href"];case"g":arguments.callee.call(f,{svgStyle:E,transform:A,defs:b.defs,focused:j,xlink:i},e.childNodes);continue a;case"path":if(!g.d)throw new Error("Pathdata is not provided for the path element");D=new Fashion.Path({points:new Fashion.PathData(g.d)});break;case"text":case"tspan":if(e.childNodes.length==1&&e.firstChild.nodeType==3)D=new Fashion.Text({text:w(e),anchor:E.textAnchor,position:x||null,transform:A||null});else if(e.nodeName=="text"){arguments.callee.call(f,{svgStyle:E,position:x,transform:A,defs:b.defs,focused:j,xlink:i},e.childNodes);continue a}break;case"symbol":break;case"rect":D=new Fashion.Rect({size:{x:parseFloat(g.width),y:parseFloat(g.height)},corner:{x:parseFloat(g.rx||0),y:parseFloat(g.ry||0)},transform:A||null,zIndex:-10});for(var G=0,H=e.childNodes.length;G<H;G++)if(e.childNodes[G].nodeName=="title"){f.seatTitles[g.id]=e.childNodes[G].childNodes[0].nodeValue;break}break;default:continue a}if(D!==null){var I=parseFloat(g.x),J=parseFloat(g.y);!isNaN(I)&&!isNaN(J)&&(j&&(y=y?{x:Math.min(y.x,I),y:Math.min(y.y,J)}:{x:I,y:J},B=B?{x:Math.max(B.x,I),y:Math.max(B.y,J)}:{x:I,y:J}),D.position({x:I,y:J})),D.style(v(E)),D.transform(A),D instanceof Fashion.Text&&(D.fontSize(E.fontSize),E.fontSize<=10&&(f._smallTextsShown||D.visibility(!1),p.push(D))),m.draw(D)}g.id&&(n[g.id]=D),i&&o.push([D,i])}}).call(f,{svgStyle:{fill:!1,fillOpacity:!1,stroke:!1,strokeOpacity:!1,strokeDashArray:!1,fontSize:10,textAnchor:!1},position:null,transform:new Fashion.Matrix,defs:{},focused:!1,xlink:null},a.documentElement.childNodes),f.drawable=m,f.shapes=n,f.small_texts=p,f.link_pairs=o,y||(y={x:i&&i[0]||0,y:i&&i[1]||0}),B||(B={x:y.x+l.x,y:y.y+l.y});var D={x:(y.x+B.x)/2,y:(y.y+B.y)/2},E={x:B.x-y.x,y:B.y-y.y},F={x:D.x-E.x/2,y:D.y-E.y/2},G={x:20,y:20},H=m.viewportSize();H={x:H.x-G.x,y:H.y-G.y};var I=H.x/E.x*.9,J=H.y/E.y*.9,K=I<J?I:J,L={x:D.x-(H.x/2+G.x)/K,y:D.y-(H.y/2+G.y)/K};f.zoomRatioMin=K,f.contentOriginPosition=L,m.transform(Fashion.Matrix.scale(f.zoomRatioMin).translate({x:-L.x,y:-L.y})),m.contentSize({x:L.x+H.x/K,y:L.y+H.y/K});var N=!1,O=0;for(var k=0;k<f.link_pairs.length;k++)(function(a,b){var c=M(b);a.addEvent({mouseover:function(a){if(f.pages){for(var d=c.length;--d>=0;){var e=x(c[d]);e&&(e.style(C.convertToFashionStyle(A.DEFAULT.OVERLAYS.highlighted_block)),f.drawable.draw(e),f.overlayShapes.save(c[d].id,e))}var g=b.split("#"),h=g[0];h==""&&(h=f.currentPage),f.callbacks.messageBoard.up.call(f,f.pages[h].name),f.canvas.css({cursor:"pointer"})}},mouseout:function(a){if(f.pages){f.canvas.css({cursor:"default"});for(var b=c.length;--b>=0;){var d=f.overlayShapes.restore(c[b].id);d&&f.drawable.erase(d)}f.callbacks.messageBoard.down.call(f)}},mousedown:function(a){},mouseup:function(a){f.pages&&f.navigate(b)}})}).apply(f,f.link_pairs[k]);(function(){function c(){f.onMouseUp=null,f.onMouseMove=null,b(f.canvas[0]).find("div").css({overflow:"scroll"}),N=!1,f.dragging&&(f.drawable.releaseMouse(),f.dragging=!1)}function d(c){O&&e();if(f.animating)return;if(!f.dragging){if(!N)return;f.dragging=!0,f.drawable.captureMouse(),b(f.canvas[0]).find("div").css({overflow:"hidden"}),f.callbacks.messageBoard.down.call(f)}var d=Fashion._lib.subtractPoint(a,Fashion._lib.subtractPoint(c.logicalPosition,f.startPos));return f.drawable.scrollPosition(d),a=d,!1}function e(){clearTimeout(O),O=0;var a=f.nextSingleClickAction;f.nextSingleClickAction=null,a&&a.call(f)}var a=null;f.drawable.addEvent({mousedown:function(b){if(f.animating)return;switch(f.uiMode){case"zoomin":case"zoomout":break;default:N=!0,f.onMouseUp=c,f.onMouseMove=d;if(!O)a=f.drawable.scrollPosition(),f.startPos=b.logicalPosition,O=setTimeout(e,f.doubleClickTimeout);else if(!f.dragging){clearTimeout(O),O=0,f.drawableMouseDown=!1;var g=f.zoomRatio*2;f.zoom(g,b.logicalPosition)}}},mouseup:function(a){c(a);if(f.animating)return;switch(f.uiMode){case"zoomin":f.zoom(f.zoomRatio*1.2,a.logicalPosition);break;case"zoomout":f.zoom(f.zoomRatio/1.2,a.logicalPosition);break;default:}},mouseout:function(a){f.canvas.css({cursor:"default"}),f.callbacks.messageBoard.down.call(f)},mousemove:function(a){d(a)}})})(),f.changeUIMode(f.uiMode),d.call(this)},f.callbacks.message)},zoomOnShape:function(a){if(!this.drawable)return;var b=a.position(),c=a.size(),d=a._transform.apply(b),e=a._transform.apply({x:b.x,y:b.y+c.y}),f=a._transform.apply({x:b.x+c.x,y:b.y}),g=a._transform.apply({x:b.x+c.x,y:b.y+c.y}),h={x:Math.min(d.x,e.x,f.x,g.x),y:Math.min(d.y,e.y,f.y,g.y)},i={x:Math.max(d.x,e.x,f.x,g.x)-h.x,y:Math.max(d.y,e.y,f.y,g.y)-h.y},j=this.drawable.viewportSize(),k=.1,l=Math.min(j.x*(1-k)/i.x,j.y*(1-k)/i.y),m={x:Math.max(h.x-(j.x/l-i.x)/2,0),y:Math.max(h.y-(j.y/l-i.y)/2,0)};this.zoomAndPan(l,m)},navigate:function(a){var b={page:this.currentPage,zoomRatio:this.zoomRatio,scrollPosition:this.drawable?this.drawable.scrollPosition():null},c=this;if(typeof a=="string"||a instanceof String){var d=a.split("#"),e=null;page=d[0],d.length>1&&(e=d[1]),page==""&&(page=this.currentPage);var f=function(){c._history.push(b);if(e=="__FIXED__")c.zoomAndPan(b.zoomRatio,b.scrollPosition);else{var a=c.shapes[e];a!==void 0&&a instanceof Fashion.Rect?c.zoomOnShape(a):c.zoomAndPan(c.zoomRatioMin,{x:0,y:0})}};this._loadPage({page:page},f)}else this._loadPage(a,function(){c._history.push(b)})},_loadPage:function(a,b){var c=this,d=function(){a.zoomRatio&&a.scrollPosition&&c.zoomAndPan(a.zoomRatio,a.scrollPosition),b&&b.call(c,a)};if(!a)return;if(!(a.page in this.pages))return;this.canvas.css({cursor:"default"}),this.callbacks.messageBoard.down.call(this),this.curentPage!=a.page?this.loadDrawing(a.page,function(){c.callbacks.load.call(c,c),d()}):d()},history:function(){return this._history},initBlocks:function(b,c){var d=this;b(function(a){d.pages=a;for(var b in a)a[b].root&&(d.rootPage=b);c.call(d)},d.callbacks.message)},loadSeats:function(a){var b=this;b.callbacks.loadPartStart.call(b,b,"seats"),b.loading=!0,b.initSeats(b.dataSource.seats,function(){b.loading=!1;if(b.loadAborted){b.loadAborted=!1,b.loadAbortionHandler&&b.loadAbortionHandler.call(b,b),b.callbacks.loadAbort&&b.callbacks.loadAbort.call(b,b);return}b.callbacks.loadPartEnd.call(b,b,"seats"),a&&a()})},initSeats:function(b,c){var d=this;b(function(a){var b={};for(var e in a){var f=b[e]=new B.Seat(e,a[e],d,{mouseover:function(a){d.callbacks.messageBoard.up.call(d,d.seatTitles[this.id]),d.seatAdjacencies.getCandidates(this.id,d.adjacencyLength(),function(a){if(a.length==0)return;var c=null;for(var e=0;e<a.length;e++){c=a[e];for(var f=0;f<c.length;f++)if(!b[c[f]].selectable()){c=null;break}if(c)break}if(!c)return;for(var e=0;e<c.length;e++){var g=b[c[e]];g.addOverlay("highlighted"),d.highlighted[g.id]=g}},d.callbacks.message)},mouseout:function(a){var b=d.highlighted;d.highlighted={};for(var c in b)b[c].removeOverlay("highlighted")},mousedown:function(a){d.nextSingleClickAction=function(){d.callbacks.click(d,d,d.highlighted)}}});d.shapes[e]&&f.attach(d.shapes[e])}d.seats=b,c.call(d)},d.callbacks.message)},refresh:function(){for(var b in this.seats)this.seats[b].refresh()},addKeyEvent:function(){if(this.keyEvents)return;var c=this;this.keyEvents={down:function(a){return C.eventKey(a).shift&&(c.shift=!0),!0},up:function(a){return C.eventKey(a).shift&&(c.shift=!1),!0}},b(document).bind("keydown",this.keyEvents.down),b(document).bind("keyup",this.keyEvents.up)},removeKeyEvent:function(){if(!this.keyEvents)return;b(document).unbind("keydown",this.keyEvents.down),b(document).unbind("keyup",this.keyEvents.up)},changeUIMode:function(b){if(this.drawable){var c=this;switch(b){case"select":case"move":case"zoomin":case"zoomout":break;default:throw new Error("Invalid ui mode: "+b)}}this.uiMode=b,this.callbacks.uimodeselect(this,b)},zoom:function(a,b){if(!this.drawable)return;var c=this.drawable.viewportSize(),d=this.drawable.scrollPosition(),e=this.zoomRatio,f={x:c.x/e,y:c.y/e};b||(b={x:d.x+f.x/2,y:d.y+f.y/2});var g={x:(b.x-d.x)*e,y:(b.y-d.y)*e},h={x:c.x/a,y:c.y/a},i={x:b.x-g.x/a,y:b.y-g.y/a};this.zoomAndPan(a,i)},zoomAndPan:function(a,b){if(isNaN(a))return;var c=this.zoomRatio;if(this.callbacks.zoomRatioChanging){var d=this.callbacks.zoomRatioChanging(a);if(d===!1)return;d&&(a=d)}if(!this.drawable){this.zoomRatio=a,this.callbacks.zoomRatioChange&&this.callbacks.zoomRatioChange(a);return}this.drawable.transform(Fashion.Matrix.scale(a).translate({x:-this.contentOriginPosition.x,y:-this.contentOriginPosition.y})),this.drawable.scrollPosition(b),this.zoomRatio=a,this.callbacks.zoomRatioChange&&this.callbacks.zoomRatioChange(a)},unselectAll:function(){var b=this.selection;this.selection={};for(var c in b)this.seats[c].__unselected();this.selectionCount=0},_select:function(b,c){c?b.id in this.selection||(this.selection[b.id]=b,this.selectionCount++,b.__selected()):b.id in this.selection&&(delete this.selection[b.id],this.selectionCount--,b.__unselected())},adjacencyLength:function(b){return b!==void 0&&(this._adjacencyLength=b),this._adjacencyLength},scrollTo:function(b){if(this.animating)return;var c=this.drawable.scrollPosition();b={x:b.x,y:b.y};var d=this.drawable.contentSize(),e=Fashion._lib.addPoint(b,this.drawable._inverse_transform.apply(this.drawable.viewportInnerSize()));e.x>d.x&&(b.x+=d.x-e.x),e.y>d.y&&(b.y+=d.y-e.y),b.x=Math.max(b.x,0),b.y=Math.max(b.y,0),this.animating=!0;var f=this,g=setInterval(function(){var a=Fashion._lib.subtractPoint(b,c);if(Math.sqrt(a.x*a.x+a.y*a.y)<1){clearInterval(g),f.animating=!1;return}a={x:a.x/2,y:a.y/2},c=Fashion._lib.addPoint(c,a),f.drawable.scrollPosition(c)},50)},back:function(){this._history.length>0&&this._loadPage(this._history.pop())},showSmallTexts:function(){if(!this._smallTextsShown){for(var b=this.small_texts.length;--b>=0;)this.small_texts[b].visibility(!0);this._smallTextsShown=!0}},hideSmallTexts
:function(){if(this._smallTextsShown){for(var b=this.small_texts.length;--b>=0;)this.small_texts[b].visibility(!1);this._smallTextsShown=!1}}}});b.fn.venueviewer=function(a){var c=this.data("venueviewer");if(!a)throw new Error("Options must be given");if(typeof a=="object"){if(!a.dataSource||typeof a.dataSource!="object")throw new Error("Required option missing: dataSource");var d=this;function e(){var e=b.extend({},a),f=function(){var c={},d=null,e=!0;return function(g){return function(h,i){c[g]={next:h,error:i};if(e){b.ajax({url:a.dataSource.metadata,dataType:"json",success:function(a){d=a;var b=c;c={};for(var e in b)b[e].next(a[g])},error:function(a,b,d){var e="Failed to load "+g+" (reason: "+b+" - "+d+")",f=c;c={};for(var h in f)f[h]&&f[h].error(e)}}),e=!1;return}d&&(c[g].next(d[g]),delete c[g])}}}();b.each([["stockTypes","stock_types"],["seats","seats"],["areas","areas"],["info","info"],["seatAdjacencies","seat_adjacencies"],["pages","pages"]],function(b,c){e.dataSource[c[0]]=typeof a.dataSource[c[0]]=="function"?a.dataSource[c[0]]:f(c[1])}),c=new E(d,e),d.data("venueviewer",c),a.uimode&&c.changeUIMode(a.uimode)}c?c.dispose(e):e()}else if(typeof a=="string"||a instanceof String)if(a=="remove")c&&c.dispose(),this.empty(),this.data("venueviewer",null);else{if(!c)throw new Error("Command issued against an uninitialized element");switch(a){case"load":c.load();break;case"uimode":if(!(arguments.length>=2))return c.uiMode;c.changeUIMode(arguments[1]);break;case"selection":return c.selection;case"unselectAll":return c.unselectAll();case"refresh":return c.refresh();case"adjacency":c.adjacencyLength(arguments[1]|0);break;case"root":return c.rootPage;case"back":c.back();break;case"zoom":c.zoom(arguments[1]);break;case"navigate":c.navigate(arguments[1]);break;case"loadSeats":c.loadSeats(arguments[1]);break;case"showSmallTexts":c.showSmallTexts();break;case"hideSmallTexts":c.hideSmallTexts()}}return this}}(jQuery)})();