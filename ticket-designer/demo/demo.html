<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <title></title>
  <link rel="stylesheet" type="text/css" href="js/jquery-ui.css" />
  <link rel="stylesheet" href="css/components.css" />
  <script type="text/javascript" src="js/jquery.min.js" ></script>
  <script type="text/javascript" src="js/jquery-ui.min.js"></script>
  <script type="text/javascript" src="js/ticket-designer.js"></script>
  <style type="text/css">
.view {
  position: relative;
}

.viewport {
  position: absolute;
  left: 20px;
  top: 20px;
  width: 320px;
  height: 320px;
  overflow: scroll;
}

.renderable-vertical_ruler {
  position: absolute;
  left: 0px;
  top: 19px;
  height: 308px;
}

.renderable-horizontal_ruler {
  position: absolute;
  left: 19px;
  top: 0px;
  width: 320px;
}

.canvas {
  margin: 0 0;
  padding: 0 0;
  background-color: #eef;
  position: relative;
  width: 2000px;
  height: 2000px;
  overflow: hidden;
}

  </style>
  <script type="text/javascript">
  if (!window.console) console = { log: function() {} };
  $(function() {
    var canvasNode = $('#view .canvas')
    var viewportNode = $('#view .viewport');
    var td = new TicketDesigner(
      new views.rendering.js.dom.JSDOMView(canvasNode, viewportNode)
    );
    $('#view .renderable-horizontal_ruler').replaceWith(td.horizontalRuler.renderer.n);
    $('#view .renderable-vertical_ruler').replaceWith(td.verticalRuler.renderer.n);

    function getBodyClientSize() {
      var firstChildNode = $("body > :first").get(0);
      return {
        width: document.documentElement.clientWidth - firstChildNode.offsetLeft * 2,
        height: document.documentElement.clientHeight - firstChildNode.offsetTop * 2
      };
    }

    function adjustViewSize() {
      var n = $("#view");
      var size = { width: n.innerWidth(), height: n.innerHeight() };
      var margin = { x: td.verticalRuler.renderer.n.outerWidth(), y: td.horizontalRuler.renderer.n.outerHeight() };
      td.view.get_viewport().n
        .css({ width: (size.width - margin.x) + "px",
               height: (size.height - margin.y) + "px" });
      td.horizontalRuler.renderer.n
        .css({ width: (size.width - margin.x) + "px" });
      td.verticalRuler.renderer.n
        .css({ height: (size.height - margin.y) + "px" });
      td.refresh();
    }

    adjustViewSize();
    $(window).resize(adjustViewSize);
    $('.ui-action-zoom_in').click(function() {
      td.shell.zoomIn();
    });
    $('.ui-action-zoom_out').click(function() {
      td.shell.zoomOut();
    });

    function toggleToolbarButton(item) {
      $(".ui-action-function[value='" + item + "']")[0].checked = true;
    }

    td.shell.operationModeCallback = function operationModeCallback(operationMode) {
      switch (operationMode[0]) {
      case 'CURSOR':
        toggleToolbarButton('cursor');
        break;
      case 'MOVE':
        toggleToolbarButton('move');
        break;
      case 'PLACE':
        if (operationMode[2] == views.TextComponent)
          toggleToolbarButton('text');
        else if (operationMode[2] == views.TextComponent)
          toggleToolbarButton('text');
        break;
      }
    }

    function selectFunction(f) {
      switch (f) {
      case 'cursor':
        td.shell.set_operationMode(OperationMode.CURSOR);
        break;
      case 'move':
        td.shell.set_operationMode(OperationMode.MOVE);
        break;
      case 'text':
        td.shell.set_operationMode(OperationMode.PLACE(views.TextComponent));
        break;
      case 'image':
        td.shell.set_operationMode(OperationMode.PLACE(views.ImageComponent));
        break;
      }
    }

    $('.ui-action-function').click(function() {
      selectFunction(this.value);
    }).each(function(i, n) {
      if (n.checked)
        selectFunction(n.value);
    });
  });
  </script>
</head>
<body>
  <div class="page">
    <div class="ui-toolbar ui-state-default ui-corner-all">
      <span class="ui-button-set toolbar-function">
        <span class="toggle-button"><input class="ui-action-function ui-button ui-no-text ui-icon-primary-arrow-1-ne" type="radio" name="function" value="cursor" id="toolbar-function-cursor" checked="checked" /><label for="toolbar-function-cursor">Cursor</label></span>
        <span class="toggle-button"><input class="ui-action-function ui-button ui-no-text ui-icon-primary-arrow-4" type="radio" name="function" value="move" id="toolbar-function-move" /><label for="toolbar-function-move">Move</label></span>
        <span class="toggle-button"><input class="ui-action-function ui-button ui-no-text ui-icon-primary-pencil" type="radio" name="function" value="text" id="toolbar-function-text" /><label for="toolbar-function-text">Text</label></span>
        <span class="toggle-button"><input class="ui-action-function ui-button ui-no-text ui-icon-primary-image" type="radio" name="function" value="image" id="toolbar-function-image" /><label for="toolbar-function-image">Image</label></span>
      </span>
      <button class="ui-button ui-action-zoom_in ui-icon-primary-zoomin ui-no-text" id="toolbar-function-zoom_in">Zoom-in</button>
      <button class="ui-button ui-action-zoom_out ui-icon-primary-zoomout ui-no-text" id="toolbar-function-zoom_out">Zoom-out</button>
    </div>
    <div id="main">
    <div id="view" class="view">
      <div class="renderable-vertical_ruler"></div>
      <div class="renderable-horizontal_ruler"></div>
      <div class="viewport">
        <div class="canvas">
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    $(".ui-button").each(function (i, n) {
      n = $(n);
      n.removeClass('ui-button');
      var cssClass = n.attr("class").split(/\s+/);
      var options = { icons: {} };
      for (var i = 0; i < cssClass.length; i++) {
        var g;
        if ((g = /ui-icon-primary-(.+)/.exec(cssClass[i])))
          options.icons.primary = 'ui-icon-' + g[1];
        if ((g = /ui-icon-secondary-(.+)/.exec(cssClass[i])))
          options.icons.secondary = 'ui-icon-' + g[1];
        if (cssClass[i] == 'ui-no-text')
          options.text = false;
      }
      n.button(options);
    });
    $('.ui-button-set').buttonset();
  </script>
</body>
</html>
