<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <title></title>
  <link rel="stylesheet" type="text/css" href="lib/jquery-ui.css" />
  <link rel="stylesheet" href="../components.css" />
  <script type="text/javascript" src="lib/jquery.min.js" ></script>
  <script type="text/javascript" src="lib/jquery-ui.min.js"></script>
  <script type="text/javascript" src="../build/out.js"></script>
  <style type="text/css">
.view {
  position: relative;
}

.viewport {
  position: absolute;
  left: 20px;
  top: 20px;
  width: 320px;
  height: 320px;
  overflow: scroll;
}

.renderable-vertical_ruler {
  position: absolute;
  left: 0px;
  top: 19px;
  height: 308px;
}

.renderable-horizontal_ruler {
  position: absolute;
  left: 19px;
  top: 0px;
  width: 320px;
}

.canvas {
  margin: 0 0;
  padding: 0 0;
  background-color: #eef;
  position: relative;
  width: 2000px;
  height: 2000px;
  overflow: hidden;
}
  </style>
  <script type="text/javascript">
  if (!window.console) console = { log: function() {} };
  $(function() {
    var canvasNode = $('#view .canvas')
    var viewportNode = $('#view .viewport');
    var td = new TicketDesigner(
      new rendering.js.dom.JSDOMView(canvasNode, viewportNode)
    );
    for (var i = 0; i < 100; i++) {
      var tc = td.componentFactory.create(TextComponent);
      tc.on.click.do_(function(a) { console.log(a); });
      tc.position.x = Math.random() * 8;
      tc.position.y = Math.random() * 6;
      tc.text = "test";
      tc.refresh();
    }
    $('#view .renderable-horizontal_ruler').replaceWith(td.horizontalRuler.renderer.n);
    $('#view .renderable-vertical_ruler').replaceWith(td.verticalRuler.renderer.n);

    // tc.on.dragstart.do_(function(a) {});
    // tc.on.dragend.do_(function(a) {});

    function getBodyClientSize() {
      var firstChildNode = $("body > :first").get(0);
      return {
        width: document.documentElement.clientWidth - firstChildNode.offsetLeft * 2,
        height: document.documentElement.clientHeight - firstChildNode.offsetTop * 2
      };
    }

    function adjustViewSize() {
      var n = $("#view");
      var size = { width: n.innerWidth(), height: n.innerHeight() };
      var margin = { x: td.verticalRuler.renderer.n.outerWidth(), y: td.horizontalRuler.renderer.n.outerHeight() };
      td.view.get_viewport().n
        .css({ width: (size.width - margin.x) + "px",
               height: (size.height - margin.y) + "px" });
      td.horizontalRuler.renderer.n
        .css({ width: (size.width - margin.x) + "px" });
      td.verticalRuler.renderer.n
        .css({ height: (size.height - margin.y) + "px" });
      td.refresh();
    }

    adjustViewSize();
    $(window).resize(adjustViewSize);
    $('.ui-action-zoom_in').click(function() {
      td.shell.zoomIn();
    });
    $('.ui-action-zoom_out').click(function() {
      td.shell.zoomOut();
    });

    function toggleToolbarButton(item) {
      $(".ui-action-function[value='" + item + "']")[0].checked = true;
    }

    td.shell.operationModeCallback = function operationModeCallback(operationMode) {
      switch (operationMode[0]) {
      case 'CURSOR':
        toggleToolbarButton('cursor');
        break;
      case 'MOVE':
        toggleToolbarButton('move');
        break;
      case 'PLACE':
        if (operationMode[2] == TextComponent)
          toggleToolbarButton('text');
        else if (operationMode[2] == TextComponent)
          toggleToolbarButton('text');
        break;
      }
    }

    function selectFunction(f) {
      switch (f) {
      case 'cursor':
        td.shell.set_operationMode(OperationMode.CURSOR);
        break;
      case 'move':
        td.shell.set_operationMode(OperationMode.MOVE);
        break;
      case 'text':
        td.shell.set_operationMode(OperationMode.PLACE(TextComponent));
        break;
      case 'image':
        td.shell.set_operationMode(OperationMode.PLACE(TextComponent));
        break;
      }
    }

    $('.ui-action-function').click(function() {
      selectFunction(this.value);
    }).each(function(i, n) {
      if (n.checked)
        selectFunction(n.value);
    });
  });
  </script>
</head>
<body>
  <div class="page">
    <div class="toolbar ui-widget-header">
      <span class="ui-button-set toolbar-function">
        <span class="toggle-button"><input class="ui-action-function ui-button ui-no-text ui-icon-arrow-1-ne" type="radio" name="function" value="cursor" id="toolbar-function-cursor" checked="checked" /><label for="toolbar-function-cursor">Cursor</label></span>
        <span class="toggle-button"><input class="ui-action-function ui-button ui-no-text ui-icon-arrow-4" type="radio" name="function" value="move" id="toolbar-function-move" /><label for="toolbar-function-move">Move</label></span>
        <span class="toggle-button"><input class="ui-action-function ui-button ui-no-text ui-icon-pencil" type="radio" name="function" value="text" id="toolbar-function-text" /><label for="toolbar-function-text">Text</label></span>
        <span class="toggle-button"><input class="ui-action-function ui-button ui-no-text ui-icon-image" type="radio" name="function" value="image" id="toolbar-function-image" /><label for="toolbar-function-image">Image</label></span>
      </span>
      <button class="ui-button ui-action-zoom_in ui-icon-zoomin ui-no-text" id="toolbar-function-zoom_in">Zoom-in</button>
      <button class="ui-button ui-action-zoom_out ui-icon-zoomout ui-no-text" id="toolbar-function-zoom_out">Zoom-out</button>
    </div>
    <div id="view" class="view">
      <div class="renderable-vertical_ruler"></div>
      <div class="renderable-horizontal_ruler"></div>
      <div class="viewport">
        <div class="canvas">
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    $('.ui-button').each(function(i, n) {
      n = $(n);
      var params = {};
      var rex = /ui-icon-\S+/, g;
      if ((g = rex.exec(n.attr('class')))) {
        params['icons'] = { primary: g[0] };
      }
      if (n.hasClass('ui-no-text')) {
        params['text'] = false;
      }
      n.button(params);
    });
    $('.ui-button-set').buttonset();
  </script>
</body>
</html>
