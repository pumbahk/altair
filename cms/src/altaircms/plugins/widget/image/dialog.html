<%namespace file="../components.html" name="co"/>
<script src=${request.static_url('altaircms:static/smartphone/js/jquery-ui-1.9.2.custom.min.js')}></script>
<script src=${request.static_url('altaircms:static/js/jquery.form.js')}></script>
<link rel="stylesheet" type="text/css" href=${request.static_url('altaircms:static/smartphone/css/jquery-ui-1.9.2.custom.min.css')} />
<link rel="stylesheet" type="text/css" href="/plugins/static/css/widget/lib/image.css">
<script>
    $('#imgtabs').tabs();

    $(document).ready(function() {
        $('#search_form').ajaxForm({dataType: 'json', success: successSearch});
    });

    function successSearch(data) {
        //$(".items").empty();
        $(".scrollable").empty();
        //$(".scrollable .items").empty();

        console.log(data);
        for (var groupNo in data){
            //$(".items").append("<div class='group' id='group_" + groupNo + "'></div>");


            $(".scrollable").append("<div class='items'></div>");
            $(".scrollable .items").append("<div class='group' id='group_" + groupNo + "'></div>");

            $("#group_" + groupNo).append("<div class='item'></div>");
            for (var itemNo in data[groupNo]) {
                console.log(itemNo)
                var id = data[groupNo][itemNo]['id'];
                var title = data[groupNo][itemNo]['title'];
                var width = data[groupNo][itemNo]['width'];
                var height = data[groupNo][itemNo]['height'];
                var thumbnail_path = data[groupNo][itemNo]['thumbnail_path'];
                $("#group_" + groupNo + " .item").append("<img pk='" + id + "' src='" + thumbnail_path + "' alt='' />");
                $("#group_" + groupNo + " .item").append("<p>title:" + title + "width:" + width + "height:" + height + "</p>");
            }
        }


        $(".scrollable").find("img").click(function(){
            selected = this;
            $(".scrollable").find(".managed").removeClass("managed")
            we.attach_managed(selected);
        });

    }
</script>


## N個ごとに区切られたitreratorを受け取り、divで区切って出力(scrollのため)
<%def name="render(assets)">
  % for i, g in enumerate(assets):
  <div class="group" id="group_${i}">
     % for image in g:
       <div class="item">
         <img pk="${image.id}" src="${h.asset.rendering_object(request,image).thumbnail_path}" alt="" class="${"managed" if widget.asset==image else ""}"/>
         <p>title:${image.title} width:${image.width} height:${image.height} </p>
       </div>
     % endfor          
  </div>
  % endfor 
</%def>

<div class="title">
  <h1>画像(image)</h1>
</div>
<br/>
<div style='clear:both;' id="imgtabs">
  <ul>
    <li><a href="#image_tab">画像の選択</a></li>
    <li><a href="#setting_tab">表示設定</a></li>
  </ul>
  <div id="image_tab" style="height: 350px">
    <form id="search_form" action="${request.route_path('image_widget_search')}" method="POST">
      検索文字列<br/>
      <input type="text" name="search_word" value=""/><input type="submit" value="検索" width="20px">
    </form>
    <button type="button" id="image_submit">登録</button>
    <br/>

    <div class="scrollable" style="width: 550px">
        <div class="items">
          ${render(assets)}
        </div>
    </div>
  </div>
  <div id="setting_tab">
    <table class="table">
      <tbody>
        ${co.formfield(form, "href")}
        ${co.formfield(form, "width")}
        ${co.formfield(form, "height")}
        ${co.formfield(form, "alt")}
        ${co.formfield(form, "align")}
      </tbody>
    </table>
    <button type="button" id="image_submit">登録</button>
  </div>
</div>
