## sizeがwidth,height固定はひどい
% if hasattr(widget, "use_newstyle"):
  % if widget.use_newstyle:
    ${render_newstyle()}
  % else:
    ${render()}
  % endif
% else:
  ${render()}
% endif


<%def name="render_newstyle()">
<%
  genre = ""
  link = ""
  style = "musicList"
  if widget.system_tag:
      if widget.system_tag.label == u'音楽':
        genre = u"音楽"
        link = "/music"
        style = "musicList"
      elif widget.system_tag.label == u'演劇・ステージ・舞台':
        genre = u"演劇･ステージ"
        link = "/stage"
        style = "stageList"
      elif widget.system_tag.label == u'スポーツ':
        genre = u"スポーツ"
        link = "/sports"
        style = "sportsList"
      elif widget.system_tag.label == u'イベント・その他':
        genre = u"イベント"
        link = "/event"
        style = "eventList"
      endif
  endif
%>

<div id="notableEvents">
  <div class="${style} genreTopics clearfix">
    <h3>${genre}</h3>
    <p class="listBtn">
      <a href="${link}">
        <span class="offleft">一覧を見る</span>
      </a>
    </p>
    <ul>
      % for content in h.chunk(qs, 1):
      <li>
        <dl>
          <dt class="tileImg">
            <a href="${h.link.get_link_from_topcontent(request, content[0])}">
              <img src="${getattr(h.asset.rendering_object(request, content[0].image_asset), widget.rendering_image_attribute)}" alt="${content[0].title}" width="150" height="150" style="border:solid 1px #ccc;padding:0px;"/>
            </a>
          </dt>
          <dd>
            <p class="tileTitle">
              <a href="${h.link.get_link_from_topcontent(request, content[0])}">${h.truncate(content[0].title, 35) }</a>
            </p>
            <p class="tileText">
              ${h.truncate(content[0].text, 57)}
                %if content[0].linked_page and content[0].linked_page.event:
                (${content[0].countdown_type_ja}まであと${h.base.countdown_days_from(request, content[0].countdown_limit)}日)
              %endif
            </p>
          </dd>
        </dl>
      </li>
      % endfor
    </ul>
  </div>
</div>
</%def>

<%def name="render()">
<div id="notableEvents">
  <table>
    <tbody>
  % for pair in h.chunk(qs, 2):
      <tr>
    % for t in pair:
        <td class="event">
          <a href="${h.link.get_link_from_topcontent(request, t)}"><img src="${getattr(h.asset.rendering_object(request, t.image_asset), widget.rendering_image_attribute)}" alt="${t.title}" width="80" height="80" /></a>
          <a href="${h.link.get_link_from_topcontent(request, t)}">${h.truncate(t.title, 35) }</a>
          <p>${h.truncate(t.text, 57)}
          %if t.linked_page and t.linked_page.event:
          <span class="subdescribe">(${t.countdown_type_ja}まであと${h.base.countdown_days_from(request, t.countdown_limit)}日)</span>
          %endif
          </p>
        </td>
    % endfor
      </tr>
  % endfor
    </tbody>
  </table>
</div>
</%def>
