<%inherit file='altaircms:templates/layout_2col.html'/>
<%namespace name="nco" file="altaircms:templates/navcomponents.html"/>

<%block name="style">
<style type="text/css">
  .row-fluid h3 { margin-top:20px;  }
  .row-fluid h3.first { margin-top:0px;  }
  .row-fluid .headline { margin-top:20px; margin-bottom:5px;}
</style>
</%block>

<h2>プロモーションリスト</h2>

<div class="row-fluid">
  <div class="span12">
    ${nco.breadcrumbs(
        names=["Top", u"プロモーション枠使用ページ一覧", u"詳細"], 
        urls=[request.route_path("dashboard"), request.route_path("promotion_list")])
    }
  </div>
</div>

<ul class="nav nav-tabs">
   %for widget in widgets:
     %if unicode(widget.id) == unicode(current_widget.id):
        <li class="active"><a href="${request.route_path("promotion_detail", page_id=page.id, _query=dict(widget_id=widget.id))}">${widget.kind.label}</a></li>
     %else:
        <li><a href="${request.route_path("promotion_detail", page_id=page.id, _query=dict(widget_id=widget.id))}">${widget.kind.label}</a></li>
     %endif
   %endfor
</ul>



%if ":all:" in request.GET:
  <a href="${request.current_route_path()}">表示されているプロモーションのみを表示</a>  
%else:
  <a href="${request.current_route_path(_query={":all:": True})}">全てのプロモーションを表示</a>
%endif

<h4 class="headline">表示されるページの情報</h4>
<table class="table table-bordered">
  <tbody>
    <tr>
      <th rowspan="4">ページ情報</th>
      <th>利用しているページ<th></td>${page.name}  (<a href="${request.route_path("page_edit_", page_id=page.id)}">ページの編集画面に飛ぶ</a> )</td>
    </tr>
    <tr>
      <th>ページタイプ<th></td>${page.pagetype}</td>
    </tr>
    <tr>
      <th>URL<th></td>${page.url}</td>
    </tr>
    <tr>
      <th>公開ステータス(公開期間)<th></td>${h.page.show_publish_status(page)}(${h.term(page.publish_begin, page.publish_end)})</td>
    </tr>
    <tr>
      <th rowspan="2">widget情報</th>
      <th>widget id</th><td> ${current_widget.id}</td>
    </tr>
    <tr>
      <th>表示場所</th><td> ${current_widget.kind.label}</td>
    </tr>
  </tbody>
</table>

<pre>
必要なもの
* 表示順序 - ok
** 全てのpromotion(公開期間終了後も含めて)表示 - ok
* 公開期間を表示 - not yet
* 表示順序を表示 - not yet
* リンクを表示 - not yet
* 編集、追加、削除可能 - ok
</pre>
<hr/>
<h4 class="headline">プロモーションの追加</h4>
<a href="${request.route_path("promotion_old_create", action="input", _query=dict(tag_content=current_widget.kind.label))}"  class="btn btn-success btn-large">新しいプロモーションを作成する</a>

<h4 class="headline"> 表示中のプロモーションの一覧</h4>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>id</th>
      <th>表示画像</th>
      <th></th>
    </tr>
  </thead>
    <tbody>
      %for promotion in promotions:
        <tr>
          <td rowspan="3" width="5%">${promotion.id}</td>
          <td rowspan="3" width="45%">${promotion_renderer.render_main_image(promotion)}</td>
          <td>${promotion.text}</td>
        </tr>
        <tr>
          <td>${promotion.linked_page}</td>
        </tr>
        <tr>
          <td>
            <a href="${request.route_path("promotion_old_update", action="input",id=promotion.id)}" class="btn">編集</a>
            <a href="${request.route_path("promotion_old_delete", action="confirm",id=promotion.id)}" class="btn">削除</a>
          </td>
        </tr>
      %endfor
    </tbody>
</table>

<%doc>
<div class="row">
  %for promotion in promotions:
    <div class="span1">
      <td>${promotion.id}</td>
    </div
    <div class="span5">
      <td>${promotion_renderer.render_image(promotion)}</td>
    </div>
  %endfor
</div>
</%doc>
