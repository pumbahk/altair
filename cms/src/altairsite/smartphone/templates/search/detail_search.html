<%namespace file="../common/tags_smartphone.html" name="m" />

<style type="text/css">
#detail_search input[type="text"] {
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  width: 100%;
  display: block;
  height: 34px;
  font-size: 17px;
  padding: 0px 2px;
  margin: 0 0 2px 0;
}

#detail_search select {
  height: 30px;
  font-size: 16px;
  margin: 1px 0 0 0;
  background-color: #fff;
}

#detail_search button {
  height: 28px;
  font-weight: bold;
}

#detail_search input[type="submit"] {
  height: 28px;
  font-weight: bold;
}
</style>



<script type="text/javascript">
$(function () {
  $('*[data-toggle]').each(function (_, n) {
    $(n).on('click', function () {
      var target = $(document.getElementById(n.getAttribute('data-toggle')));
      if (target.hasClass('activated')) {
        target.removeClass('activated');
        target.animate({ height: target.attr('data-prev-height') + 'px' }, {
          duration: 100
        });
      } else {
        var h = 0;
        var targetOffset = target.offset().top;
        target.children().each(function (_, n) {
          h += $(n).height();
        });
        target.attr('data-prev-height', target.height());
        target.animate({ height: h + 'px' }, {
          duration: 100,
          step: function (h) {
            var dest = targetOffset + h - $(window).height();
            if ($(window).scrollTop() < dest) {
              $(window).scrollTop(dest);
            }
          }
        });
        target.addClass('activated');
      }
      return false;
    });
  });
});
</script>

<h2 class="glitter red">地域で絞り込む</h2>
% if areas:
    <form action="${request.route_path('search_genre_area')}" method="GET">
        <input type="hidden" name="genre_id" value=${genre.id}/>
        <ul class="panellist fullwidth expandable">
        % for area in areas:
            <li class="panelgroup" id=${area.name}>
                <span class="panelgroup-label"><a href="#" data-toggle="${area.name}">${helper.get_area_japanese(area.name)}</a></span>
                <ul class="panelgroup-inner">
                    % for pref in area.prefectures:
                        <li class="panel"><label><input name=${pref} type="checkbox" />${helper.get_prefecture_japanese(pref)}</label></li>
                    % endfor
                </ul>
            </li>
        % endfor
        </ul>
        <input type="submit" class="btn-secondary" value="検索"/>
    </form>
% endif

















<div id="detail_search" class="sectionbox inverted">
    詳細検索フォーム<br/>

    <form action="${request.route_path('search_detail')}" method='GET'>
        <fieldset>
            <%m:header>フリーワード</%m:header><br/>
            ${form.word}<br/>
            % for error in form.word.errors:
                <font color="red">${error}</font><br/>
            % endfor
            ${form.cond}<br/>

            <%m:header>さらに条件を指定する</%m:header><br/>
            <%m:header>ジャンルで絞り込む</%m:header><br/>
            ${form.genre_id}

            <%m:header>開催地で絞り込む</%m:header><br/>
            <hr/>
            ${form.prefecture_hokkaido.label}${form.prefecture_hokkaido}<hr/>
            ${form.prefecture_syutoken.label}${form.prefecture_syutoken}<hr/>
            ${form.prefecture_koshinetsu.label}${form.prefecture_koshinetsu}<hr/>
            ${form.prefecture_kinki.label}${form.prefecture_kinki}<hr/>
            ${form.prefecture_chugoku.label}${form.prefecture_chugoku}<hr/>
            ${form.prefecture_kyusyu.label}${form.prefecture_kyusyu}<hr/>

            <%m:header>販売条件で絞り込む</%m:header><br/>
            ${form.sales_segment}

            <%m:header>公演日で絞り込む</%m:header><br/>
            <font color="red">${helper.disp_date_error(form)}</font><br/>
            ${form.since_year}年${form.since_month}月${form.since_day}日〜${form.year}年${form.month}月${form.day}日

            <%m:header>発売日で絞り込む</%m:header><br/>
            ${form.sale_start}日以内に受付・販売開始<br/>
            販売終了まで${form.sale_end}日<br/><br/>
            ${form.closed_perf.label}${form.closed_perf}
            ${form.canceled_perf.label}${form.canceled_perf}<br/>
            <input type="submit" class="btn-secondary" value="検索"/>
        </fieldset>
    </form>
</div>

<script>

    window.onload = function(){
        addCheckBoxEventHandler("prefecture_hokkaido")
        addCheckBoxEventHandler("prefecture_syutoken")
        addCheckBoxEventHandler("prefecture_koshinetsu")
        addCheckBoxEventHandler("prefecture_kinki")
        addCheckBoxEventHandler("prefecture_chugoku")
        addCheckBoxEventHandler("prefecture_kyusyu")
    }

    function addCheckBoxEventHandler(name) {
        checkboxies = document.getElementsByName(name);
        for (var index = 0; index < checkboxies.length; index++) {
            if (checkboxies[index].value == "all_check") {
                checkboxies[index].addEventListener("click", function(){
                    checkedAllPrefectures(name)
                })
                break;
            }
        }
    }

    function checkedAllPrefectures(name){
        check = true
        checkboxies = document.getElementsByName(name);
        for (var index = 0; index < checkboxies.length; index++) {
            if (checkboxies[index].value == "all_check") {
                check = checkboxies[index].checked
                break;
            }
        }

        for (var index = 0; index < checkboxies.length; index++) {
            checkboxies[index].checked = check;
        }
    }
</script>