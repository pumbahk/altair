<%namespace file="../common/tags_smartphone.html" name="m" />

<script type="text/javascript">
$(function () {
  $('*[data-toggle]').each(function (_, n) {
    $(n).on('click', function () {
      var target = $(document.getElementById(n.getAttribute('data-toggle')));
      if (target.hasClass('activated')) {
        target.removeClass('activated');
        target.animate({ height: target.attr('data-prev-height') + 'px' }, {
          duration: 100
        });
      } else {
        var h = 0;
        var targetOffset = target.offset().top;
        target.children().each(function (_, n) {
          h += $(n).height();
        });
        target.attr('data-prev-height', target.height());
        target.animate({ height: h + 'px' }, {
          duration: 100,
          step: function (h) {
            var dest = targetOffset + h - $(window).height();
            if ($(window).scrollTop() < dest) {
              $(window).scrollTop(dest);
            }
          }
        });
        target.addClass('activated');
      }
      return false;
    });
  });
});
</script>

<h2 class="glitter red">地域で絞り込む</h2>
% if areas:
    <form action="${request.route_path('search_genre_area')}" method="GET">
        <input type="hidden" name="genre_id" value=${genre.id}/>
        <ul class="panellist fullwidth expandable">
        % for area in areas:
            <li class="panelgroup" id=${area.name}>
                <span class="panelgroup-label"><a href="#" data-toggle="${area.name}">${helper.get_area_japanese(area.name)}</a></span>
                <ul class="panelgroup-inner">
                    % for pref in area.prefectures:
                        <li class="panel"><label><input name=${pref} type="checkbox" />${helper.get_prefecture_japanese(pref)}</label></li>
                    % endfor
                </ul>
            </li>
        % endfor
        </ul>
        <input type="submit" class="btn-secondary" value="検索"/>
    </form>
% endif















<h2 class="glitter red">詳細検索</h2>


<div id="search" class="sectionbox inverted">

    <form action="${request.route_path('search_detail')}" class="sectionbox-inner" method='GET'>
        <fieldset>
            ${form.word(placeholder=u"アーティスト名、公演名、会場名など")}<br/>
            % for error in form.word.errors:
                <font color="yellow">${error}</font><br/>
            % endfor
            ${form.cond}<input type="submit" class="btn-secondary btn-large" value="検索"/>
        </fieldset>

        <fieldset>
            <ul class="panellist fullwidth expandable" style="color: #000000">
              <li class="panelgroup" id="genre">
                <span class="panelgroup-label"><a href="#" data-toggle="genre">ジャンルで絞り込む</a></span>
                <ul class="panelgroup-inner">
                  <li class="panel">${form.genre_music}</li>
                  <li class="panel">${form.genre_sports}</li>
                  <li class="panel">${form.genre_stage}</li>
                  <li class="panel">${form.genre_event}</li>
                </ul>
              </li>
              <li class="panelgroup" id="area">
                <span class="panelgroup-label"><a href="#" data-toggle="area">開催地で絞り込む</a></span>
                <ul class="panelgroup-inner">
                  <li class="panel">${form.pref_hokkaido}</li>
                  <li class="panel">${form.pref_syutoken}</li>
                  <li class="panel">${form.pref_koshinetsu}</li>
                  <li class="panel">${form.pref_kinki}</li>
                  <li class="panel">${form.pref_chugoku}</li>
                  <li class="panel">${form.pref_kyusyu}</li>
                </ul>
              </li>
            </ul>

            <%m:header>販売条件で絞り込む</%m:header><br/>
            ${form.sales_segment}

            <%m:header>公演日で絞り込む</%m:header><br/>
            <font color="red">${helper.disp_date_error(form)}</font><br/>
            ${form.since_year}年${form.since_month}月${form.since_day}日〜${form.year}年${form.month}月${form.day}日

            <%m:header>発売日で絞り込む</%m:header><br/>
            ${form.sale_start}日以内に受付・販売開始<br/>
            販売終了まで${form.sale_end}日<br/><br/>
            ${form.closed_perf.label}${form.closed_perf}
            ${form.canceled_perf.label}${form.canceled_perf}<br/>
            <input type="submit" class="btn-secondary btn-large" value="検索"/>
        </fieldset>
    </form>
</div>

<script>
    $(function() {
        function checkAll(checkbox_value, checkbox_name) {
            $("input[type=checkbox][value=" + checkbox_value + "][name=" + checkbox_name + "]").click(function(event){
                var checked = $("input[type=checkbox][value=" + checkbox_value + "][name=" + checkbox_name + "]").is(":checked");
                $("input[type='checkbox'][name=" + checkbox_name + "]").prop('checked', checked);
            });
        };
        checkAll('0', 'genre_music');
        checkAll('0', 'genre_sports');
        checkAll('0', 'genre_stage');
        checkAll('0', 'genre_event');
        checkAll('all', 'pref_hokkaido');
        checkAll('all', 'pref_syutoken');
        checkAll('all', 'pref_koshinetsu');
        checkAll('all', 'pref_kinki');
        checkAll('all', 'pref_chugoku');
        checkAll('all', 'pref_kyusyu');
    })();

</script>